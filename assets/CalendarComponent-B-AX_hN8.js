import{S as b,P as N,A as M,d as y}from"./AuthorizationModal-DAS0A9xi.js";import{addNotification as u}from"./NotificationMessage-wywHX-Pl.js";import{_ as z,r as p,o as h,c as d,a as D,b as r,t as S,w as m,F as v,d as _,e as C,f as R,n as k}from"./index-BCp7fnBO.js";const P={name:"CalendarComponent",emits:["update-editing-mode"],components:{ShiftCountWindow:b,PeopleListWindow:N,AuthorizationModal:M},props:{isEditingMode:{type:Boolean,required:!0}},data(){return{selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),monthDays:[],localData:{},syncedChanges:{},daysOfWeek:y,currentDate:new Date,people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0},{id:8,name:"Alina",ratownik:!1},{id:9,name:"Ewelina",ratownik:!1},{id:7,name:"Teresa",ratownik:!1}],madeChanges:!1,showPasswordModal:!1,password:"",locale:"pl",scrollContainer:null}},computed:{monthYear(){return new Date(this.selectedYear,this.selectedMonth).toLocaleString(this.locale,{month:"long",year:"numeric"})}},methods:{handleDrop(n,e){const a=JSON.parse(localStorage.getItem("draggedPerson"));if(!a)return;const o=this.monthDays.find(f=>f.date.toDateString()===n.toDateString()),s={...o,[e]:a.id};if(s.dayShift1!=null&&s.dayShift2!=null&&s.dayShift1===s.dayShift2||s.nightShift1!=null&&s.nightShift2!=null&&s.nightShift1===s.nightShift2){u("Ta sama osoba na obydwu zmianach.","red");return}const i=a.ratownik;let l=!1;switch(e){case"dayShift1":l=o.dayShift2Ratownik;break;case"dayShift2":l=o.dayShift1Ratownik;break;case"nightShift1":l=o.nightShift2Ratownik;break;case"nightShift2":l=o.nightShift1Ratownik;break}if(i&&l){u("Nie można przypisać dwóch ratowników na jedną zmianę.","red");return}o[e]=a.id,o[`${e}Name`]=a.name,o[`${e}Ratownik`]=a.ratownik,o[`${e}UserChanged`]=!0;const g={dayShift1:o.dayShift1,dayShift2:o.dayShift2,nightShift1:o.nightShift1,nightShift2:o.nightShift2};this.localData[n.toDateString()]=g,localStorage.setItem(n.toDateString(),JSON.stringify(g)),this.madeChanges=!0,localStorage.removeItem("draggedPerson")},handleClickResetShift(n,e){if(n[e]!==null){n[e]=null,n[e+"Name"]="Usunięto",n[e+"Ratownik"]=null,n[e+"UserChanged"]=!0;const a={dayShift1:n.dayShift1,dayShift2:n.dayShift2,nightShift1:n.nightShift1,nightShift2:n.nightShift2};this.localData[n.date.toDateString()]=a,localStorage.setItem(n.date.toDateString(),JSON.stringify(a)),n[e]="Usunięto",this.madeChanges=!0}},resolvePersonName(n){const e=this.people.find(a=>a.id===n);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const n=this.selectedYear,e=this.selectedMonth,a=new Date(n,e+1,0).getDate();this.monthDays=[];for(let o=1;o<=a;o++)this.monthDays.push({date:new Date(n,e,o),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage()},changeMonth(n){this.madeChanges&&!confirm("You have unsaved changes. Are you sure you want to switch the month? Your changes will be discarded.")||(this.selectedMonth=this.selectedMonth+n,this.generateMonthDays())},emitEditingMode(n){this.$emit("update-editing-mode",n)},async fetchServerShiftData(){this.syncedChanges={};try{const n=await fetch("https://mc.kot.li/?key=shiftData.json",{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw n.status===404&&u("Data not found on server","red"),new Error(`Failed to fetch data from server: ${n.status}`);return await n.json()}catch(n){return console.error("Error fetching data from server:",n),u("Failed to fetch data from server","red"),null}},async checkShiftDataSync(){this.resetSyncedChangesSessionStorage();const n=await this.fetchServerShiftData();if(!n){console.log("No remote data fetched.");return}const e={};for(const[a,o]of Object.entries(n)){const s=localStorage.getItem(a),i=s?JSON.parse(s):null,l={};if(!i)e[a]={...o},localStorage.setItem(a,JSON.stringify(o));else{for(const[g,f]of Object.entries(o)){const t=i[g]||null;t!==f&&(l[g]={from:t||"Empty",to:f||"Empty"})}Object.keys(l).length>0&&(e[a]=l),localStorage.setItem(a,JSON.stringify(o))}}this.generateMonthDays(),this.syncedChanges=e,console.log("Updated syncedChanges:",this.syncedChanges),sessionStorage.setItem("syncedChanges",JSON.stringify(this.syncedChanges)),setTimeout(()=>{console.log("Clearing syncedChanges."),this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3)},loadFromLocalStorage(){const n=this.selectedYear,e=this.selectedMonth;for(let a=1;a<=31;a++){const o=new Date(n,e,a).toDateString();if(this.syncedChanges[o])continue;const s=localStorage.getItem(o);if(s)try{const i=JSON.parse(s),l=this.monthDays.find(g=>g.date.toDateString()===o);if(l){l.dayShift1=i.dayShift1,l.dayShift2=i.dayShift2,l.nightShift1=i.nightShift1,l.nightShift2=i.nightShift2;const g=this.resolvePersonName(l.dayShift1);l.dayShift1Name=g.name,l.dayShift1Ratownik=g.isRatownik;const f=this.resolvePersonName(l.dayShift2);l.dayShift2Name=f.name,l.dayShift2Ratownik=f.isRatownik;const t=this.resolvePersonName(l.nightShift1);l.nightShift1Name=t.name,l.nightShift1Ratownik=t.isRatownik;const w=this.resolvePersonName(l.nightShift2);l.nightShift2Name=w.name,l.nightShift2Ratownik=w.isRatownik}}catch(i){u("Failed to load local data: "+i,"red")}}},resetSyncedChangesSessionStorage(){const n=sessionStorage.getItem("syncedChanges");n&&(this.syncedChanges=JSON.parse(n),setTimeout(()=>{this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3))},resetUserChanges(){for(const n in localStorage)if(localStorage.hasOwnProperty(n)){const e=JSON.parse(localStorage.getItem(n)||"{}");(e.dayShift1UserChanged||e.dayShift2UserChanged||e.nightShift1UserChanged||e.nightShift2UserChanged)&&localStorage.removeItem(n)}this.localData={},this.madeChanges=!1},handleScroll(n){this.scrollContainer&&(n.preventDefault(),this.scrollContainer.scrollLeft+=n.deltaY)},getDayClass(n){return y[n]==="Nd"?"nd-color":y[n]==="Sob"?"sob-color":"normal-color"},showPasswordPrompt(){this.showPasswordModal=!0},handleAuthorization(){this.showPasswordModal=!1,this.madeChanges=!1},getShiftAriaLabel(n,e){const a=n[e],o=e.includes("day")?"Zmiana dzienna":"Zmiana nocna",s=n[`${e}Name`];return a?`${o}: ${s}. Kliknij aby usunąć zmianę.`:`${o}: Pusta zmiana. Przeciągnij członka zespołu by nadać im zmianę.`},getShiftTooltip(n,e){const a=n[e],o=e.includes("day")?"Zmiana dzienna":"Zmiana nocna";return a?`${o}: ${n[`${e}Name`]} (Kliknij by usunąć)`:`Przeciągnij członka zespołu by nadać im - ${o.toLowerCase()}`}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer},watch:{isEditingMode(n){localStorage.setItem("isEditingMode",JSON.stringify(n))}}},E=["disabled"],O={class:"monthChange"},j={style:{"font-weight":"bold",width:"200px !important"},role:"heading","aria-level":"2"},L={class:"top-right-buttons compact-toggle",title:"Przełącz tryb edytowania"},x=["checked"],I=["aria-checked"],A={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",class:"pencil-icon"},U={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",class:"pencil-icon"},T={class:"calendar-container"},J={class:"calendar-grid"},W=["onDrop"],Y={class:"day-header"},Z=["onDrop"],F={class:"day-date"},B=["clickable","onDrop","onClick","onTouchend","aria-label","title"],V={key:0,class:"assigned-person"},K={key:1,class:"empty-slot"},q=["clickable","onDrop","onClick","onTouchend","aria-label","title"],G={key:0,class:"assigned-person"},H={key:1,class:"empty-slot"},Q=["clickable","onDrop","onClick","onTouchend","aria-label","title"],X={key:0,class:"assigned-person"},$={key:1,class:"empty-slot"},ee=["clickable","onDrop","onClick","onTouchend","aria-label","title"],te={key:0,class:"assigned-person"},ne={key:1,class:"empty-slot"},ie={key:0,style:{display:"flex","flex-direction":"column","align-items":"center"}};function ae(n,e,a,o,s,i){const l=p("AuthorizationModal"),g=p("PeopleListWindow"),f=p("ShiftCountWindow");return h(),d(v,null,[D(l,{show:s.showPasswordModal,localData:s.localData,onClose:e[0]||(e[0]=t=>s.showPasswordModal=!1),onAuthorized:i.handleAuthorization,"aria-label":"Zapisz zmiany",title:"Zapisz zmiany w harmonogramie"},null,8,["show","localData","onAuthorized"]),r("button",{disabled:!s.madeChanges,onClick:e[1]||(e[1]=(...t)=>i.showPasswordPrompt&&i.showPasswordPrompt(...t)),class:"submit-button","aria-label":"Zapisz zmiany",title:"Zapisz zmiany w harmonogramie"}," Zapisz ",8,E),r("section",null,[r("section",O,[r("button",{class:"buttonMonthChange",onClick:e[2]||(e[2]=t=>i.changeMonth(-1)),"aria-label":"Poprzedni miesiąc",title:"Idź do poprzedniego miesiąca"}," ‹ "),r("span",j,S(i.monthYear.toUpperCase()),1),r("button",{class:"buttonMonthChange",onClick:e[3]||(e[3]=t=>i.changeMonth(1)),"aria-label":"Następny miesiąc",title:"Idź do następnego miesiąca"}," › ")]),r("button",{class:"top-right-buttons buttonRefresh",onClick:e[4]||(e[4]=t=>i.checkShiftDataSync()),"aria-label":"Odśwież harmonogram"},e[12]||(e[12]=[r("img",{src:"/assets/icons/refresh.svg",style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Refresh",role:"presentation",title:"Odśwież harmonogram"},null,-1)])),r("label",L,[r("input",{type:"checkbox",checked:a.isEditingMode,onChange:e[5]||(e[5]=t=>i.emitEditingMode(t.target.checked)),"aria-label":"Przełącz tryb edytowania"},null,40,x),r("span",{class:"slider",role:"switch","aria-checked":a.isEditingMode},[a.isEditingMode?(h(),d("svg",U,e[14]||(e[14]=[r("path",{d:"M12 20h9"},null,-1),r("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"},null,-1)]))):(h(),d("svg",A,e[13]||(e[13]=[r("path",{d:"M12 20h9"},null,-1),r("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"},null,-1)])))],8,I)])]),r("div",T,[r("section",{class:"scrollable-container",onWheel:e[11]||(e[11]=m((...t)=>i.handleScroll&&i.handleScroll(...t),["prevent"])),ref:"scrollContainer"},[r("div",J,[(h(!0),d(v,null,_(s.monthDays,(t,w)=>(h(),d("div",{key:w,class:"day-column",onDragover:e[10]||(e[10]=m(()=>{},["prevent"])),onDrop:c=>i.handleDrop(t.date,"day")},[r("div",null,[r("div",{class:k(["day-cell",{"current-month":t.isCurrentMonth,"nd-color":s.daysOfWeek[t.date.getDay()]==="Nd","sob-color":s.daysOfWeek[t.date.getDay()]==="Sob"}])},[r("div",Y,S(s.daysOfWeek[t.date.getDay()]),1),r("div",{class:"shift",onDrop:c=>i.handleDrop(t.date,"day"),onDragover:e[9]||(e[9]=m(()=>{},["prevent"]))},[r("div",F,S(t.date.getDate()),1),r("div",{class:k(["shift-slot day",{"synced-changed":s.syncedChanges[t.date.toDateString()]?.dayShift1,ratownik:t.dayShift1Ratownik===!0,pielegniarka:t.dayShift1Ratownik===!1,userChanged:t.dayShift1UserChanged===!0}]),clickable:a.isEditingMode,onDragover:e[6]||(e[6]=m(()=>{},["prevent"])),onDrop:c=>i.handleDrop(t.date,"dayShift1"),onClick:c=>i.handleClickResetShift(t,"dayShift1"),onTouchend:c=>i.handleDrop(t.date,"dayShift1"),"aria-label":i.getShiftAriaLabel(t,"dayShift1"),title:i.getShiftTooltip(t,"dayShift1"),role:"button",tabindex:"0"},[t.dayShift1?(h(),d("div",V,S(t.dayShift1Name),1)):(h(),d("div",K,"D"))],42,B),r("div",{class:k(["shift-slot day",{"synced-changed":s.syncedChanges[t.date.toDateString()]?.dayShift2,ratownik:t.dayShift2Ratownik===!0,pielegniarka:t.dayShift2Ratownik===!1,userChanged:t.dayShift2UserChanged===!0}]),clickable:a.isEditingMode,onDrop:c=>i.handleDrop(t.date,"dayShift2"),onClick:c=>i.handleClickResetShift(t,"dayShift2"),onTouchend:c=>i.handleDrop(t.date,"dayShift2"),"aria-label":i.getShiftAriaLabel(t,"dayShift2"),title:i.getShiftTooltip(t,"dayShift2"),role:"button",tabindex:"0"},[t.dayShift2?(h(),d("div",G,S(t.dayShift2Name),1)):(h(),d("div",H,"D"))],42,q),r("div",{class:k(["shift-slot night",{"synced-changed":s.syncedChanges[t.date.toDateString()]?.nightShift1,ratownik:t.nightShift1Ratownik===!0,pielegniarka:t.nightShift1Ratownik===!1,userChanged:t.nightShift1UserChanged===!0}]),clickable:a.isEditingMode,onDragover:e[7]||(e[7]=m(()=>{},["prevent"])),onDrop:c=>i.handleDrop(t.date,"nightShift1"),onClick:c=>i.handleClickResetShift(t,"nightShift1"),onTouchend:c=>i.handleDrop(t.date,"nightShift1"),"aria-label":i.getShiftAriaLabel(t,"nightShift1"),title:i.getShiftTooltip(t,"nightShift1"),role:"button",tabindex:"0"},[t.nightShift1?(h(),d("div",X,S(t.nightShift1Name),1)):(h(),d("div",$,"N"))],42,Q),r("div",{class:k(["shift-slot night",{"synced-changed":s.syncedChanges[t.date.toDateString()]?.nightShift2,ratownik:t.nightShift2Ratownik===!0,pielegniarka:t.nightShift2Ratownik===!1,userChanged:t.nightShift2UserChanged===!0}]),clickable:a.isEditingMode,onDragover:e[8]||(e[8]=m(()=>{},["prevent"])),onDrop:c=>i.handleDrop(t.date,"nightShift2"),onClick:c=>i.handleClickResetShift(t,"nightShift2"),onTouchend:c=>i.handleDrop(t.date,"nightShift2"),"aria-label":i.getShiftAriaLabel(t,"nightShift2"),title:i.getShiftTooltip(t,"nightShift2"),role:"button",tabindex:"0"},[t.nightShift2?(h(),d("div",te,S(t.nightShift2Name),1)):(h(),d("div",ne,"N"))],42,ee)],40,Z)],2)])],40,W))),128))])],544)]),D(g,{people:s.people,isEditingMode:a.isEditingMode},null,8,["people","isEditingMode"]),a.isEditingMode?(h(),d("div",ie,e[15]||(e[15]=[r("h1",{class:"editing-mode-label"},[C(" Tryb edytowania "),r("a",{style:{color:"#4caf50"}},"Włączony"),r("br"),C(" Przeciągaj członków zespołu na miejsca w grafiku."),r("br"),C("Kliknij na zajętą zmianę, aby ją wyczyścić. ")],-1)]))):R("",!0),D(f,{people:s.people,monthDays:s.monthDays},null,8,["people","monthDays"])],64)}const le=z(P,[["render",ae],["__scopeId","data-v-4fe64a4c"]]);export{le as default};
