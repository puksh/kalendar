import{S as p,d as u}from"./ShiftCountWindow-HJ6_alMC.js";import{addNotification as y}from"./NotificationMessage-73EUHIhj.js";import{_ as w,r as D,o as r,c as l,a as n,t as d,d as v,F as m,e as k,g as N,n as S}from"./index-wUNckY3j.js";const _={name:"CalendarComponent",components:{ShiftCountWindow:p},data(){return{selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),monthDays:[],localData:{},changedShifts:{},syncedChanges:{},daysOfWeek:u,currentDate:new Date,people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0},{id:8,name:"Alina",ratownik:!1},{id:9,name:"Ewelina",ratownik:!1},{id:7,name:"Teresa",ratownik:!1}],locale:"pl",scrollContainer:null}},computed:{monthYear(){return new Date(this.selectedYear,this.selectedMonth).toLocaleString(this.locale,{month:"long",year:"numeric"})}},methods:{resolvePersonName(e){const s=this.people.find(i=>i.id===e);return s?{name:s.name,isRatownik:s.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const e=this.selectedYear,s=this.selectedMonth,i=new Date(e,s+1,0).getDate();this.monthDays=[];for(let c=1;c<=i;c++)this.monthDays.push({date:new Date(e,s,c),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage()},changeMonth(e){if(this.madeChanges){if(!confirm("You have unsaved changes. Are you sure you want to switch the month? Your changes will be discarded."))return;this.changedShifts={}}this.selectedMonth=this.selectedMonth+e,this.generateMonthDays()},async fetchServerShiftData(){this.syncedChanges={};try{const e=await fetch("https://vuecalendar.kot.li/?key=shiftData.json",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw e.status===404&&y("Data not found on server","red"),new Error(`Failed to fetch data from server: ${e.status}`);return await e.json()}catch(e){return console.error("Error fetching data from server:",e),y("Failed to fetch data from server","red"),null}},async checkShiftDataSync(){this.resetSyncedChangesSessionStorage();const e=await this.fetchServerShiftData();if(!e){console.log("No remote data fetched.");return}const s={};for(const[i,c]of Object.entries(e)){const o=localStorage.getItem(i),h=o?JSON.parse(o):null,a={};if(!h)s[i]={...c},localStorage.setItem(i,JSON.stringify(c));else{for(const[t,f]of Object.entries(c)){const g=h[t]||null;g!==f&&(a[t]={from:g||"Empty",to:f||"Empty"})}Object.keys(a).length>0&&(s[i]=a),localStorage.setItem(i,JSON.stringify(c))}}this.generateMonthDays(),this.syncedChanges=s,console.log("Updated syncedChanges:",this.syncedChanges),sessionStorage.setItem("syncedChanges",JSON.stringify(this.syncedChanges)),setTimeout(()=>{console.log("Clearing syncedChanges."),this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3)},loadFromLocalStorage(){const e=this.selectedYear,s=this.selectedMonth;for(let i=1;i<=31;i++){const c=new Date(e,s,i).toDateString();if(this.syncedChanges[c])continue;const o=localStorage.getItem(c);if(o)try{const h=JSON.parse(o),a=this.monthDays.find(t=>t.date.toDateString()===c);if(a){a.dayShift1=h.dayShift1,a.dayShift2=h.dayShift2,a.nightShift1=h.nightShift1,a.nightShift2=h.nightShift2;const t=this.resolvePersonName(a.dayShift1);a.dayShift1Name=t.name,a.dayShift1Ratownik=t.isRatownik;const f=this.resolvePersonName(a.dayShift2);a.dayShift2Name=f.name,a.dayShift2Ratownik=f.isRatownik;const g=this.resolvePersonName(a.nightShift1);a.nightShift1Name=g.name,a.nightShift1Ratownik=g.isRatownik;const C=this.resolvePersonName(a.nightShift2);a.nightShift2Name=C.name,a.nightShift2Ratownik=C.isRatownik}}catch(h){y("Failed to load local data: "+h,"red")}}this.calculateAllShiftCounts()},resetSyncedChangesSessionStorage(){const e=sessionStorage.getItem("syncedChanges");e&&(this.syncedChanges=JSON.parse(e),setTimeout(()=>{this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3))},handleScroll(e){this.scrollContainer&&(e.preventDefault(),this.scrollContainer.scrollLeft+=e.deltaY)},getDayClass(e){return u[e]==="Nd"?"nd-color":u[e]==="Sob"?"sob-color":"normal-color"},countShiftsForPerson(e){if(!e)return 0;let s=0;for(let i=0;i<this.monthDays.length;i++)this.monthDays[i].dayShift1===e&&(s+=1),this.monthDays[i].dayShift2===e&&(s+=1),this.monthDays[i].nightShift1===e&&(s+=1),this.monthDays[i].nightShift2===e&&(s+=1);return s},calculateAllShiftCounts(){this.people.forEach(e=>{e.shiftCount=this.countShiftsForPerson(e.id)})}},async mounted(){await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer}},M={class:"monthChange"},b={style:{"font-weight":"bold"}},R={class:"calendar-container"},O={class:"calendar-grid"},F={class:"day-header"},Y={class:"shift"},E={class:"day-date"},P={key:0,class:"assigned-person"},W={key:1,class:"empty-slot"},j={key:0,class:"assigned-person"},J={key:1,class:"empty-slot"},T={key:0,class:"assigned-person"},U={key:1,class:"empty-slot"},A={key:0,class:"assigned-person"},L={key:1,class:"empty-slot"},x={class:"people-list"},z={class:"person-lists"},I={class:"person-lists"};function V(e,s,i,c,o,h){const a=D("ShiftCountWindow");return r(),l(m,null,[n("section",null,[n("section",M,[n("button",{class:"buttonMonthChange",onClick:s[0]||(s[0]=t=>h.changeMonth(-1))}," ‹ "),n("span",b,d(h.monthYear.toUpperCase()),1),n("button",{class:"buttonMonthChange",onClick:s[1]||(s[1]=t=>h.changeMonth(1))},"›")]),n("button",{class:"top-right-buttons buttonRefresh",onClick:s[2]||(s[2]=t=>h.checkShiftDataSync())},s[4]||(s[4]=[n("img",{src:"/assets/icons/refresh.svg",style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Refresh"},null,-1)]))]),n("div",R,[n("section",{class:"scrollable-container",onWheel:s[3]||(s[3]=v((...t)=>h.handleScroll&&h.handleScroll(...t),["prevent"])),ref:"scrollContainer"},[n("div",O,[(r(!0),l(m,null,k(o.monthDays,(t,f)=>(r(),l("div",{key:f,class:"day-column"},[n("div",null,[n("div",{class:S(["day-cell",{"current-month":t.isCurrentMonth,"nd-color":o.daysOfWeek[t.date.getDay()]==="Nd","sob-color":o.daysOfWeek[t.date.getDay()]==="Sob"}])},[n("div",F,d(o.daysOfWeek[t.date.getDay()]),1),n("div",Y,[n("div",E,d(t.date.getDate()),1),n("div",{class:S(["shift-slot day",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.dayShift1,ratownik:t.dayShift1Ratownik===!0,userChanged:t.dayShift1UserChanged===!0}])},[t.dayShift1?(r(),l("div",P,d(t.dayShift1Name),1)):(r(),l("div",W,"D"))],2),n("div",{class:S(["shift-slot day",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.dayShift2,ratownik:t.dayShift2Ratownik===!0,userChanged:t.dayShift2UserChanged===!0}])},[t.dayShift2?(r(),l("div",j,d(t.dayShift2Name),1)):(r(),l("div",J,"D"))],2),n("div",{class:S(["shift-slot night",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.nightShift1,ratownik:t.nightShift1Ratownik===!0,userChanged:t.nightShift1UserChanged===!0}])},[t.nightShift1?(r(),l("div",T,d(t.nightShift1Name),1)):(r(),l("div",U,"N"))],2),n("div",{class:S(["shift-slot night",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.nightShift2,ratownik:t.nightShift2Ratownik===!0,userChanged:t.nightShift2UserChanged===!0}])},[t.nightShift2?(r(),l("div",A,d(t.nightShift2Name),1)):(r(),l("div",L,"N"))],2)])],2)])]))),128))])],544)]),n("section",x,[s[7]||(s[7]=n("h3",{style:{"font-weight":"bold"}},"Zespół",-1)),n("div",null,[s[5]||(s[5]=n("h4",null,"Ratowniczki/cy",-1)),n("div",z,[(r(!0),l(m,null,k(o.people.filter(t=>t.ratownik),t=>(r(),l("div",{key:t.id,class:"person-item ratownik"},d(t.name),1))),128))]),s[6]||(s[6]=n("h4",null,"Pielęgniarki/rze",-1)),n("div",I,[(r(!0),l(m,null,k(o.people.filter(t=>!t.ratownik),t=>(r(),l("div",{key:t.id,class:"person-item"},d(t.name),1))),128))])])]),N(a,{people:o.people,monthDays:o.monthDays},null,8,["people","monthDays"])],64)}const q=w(_,[["render",V],["__scopeId","data-v-31f0078c"]]);export{q as default};
