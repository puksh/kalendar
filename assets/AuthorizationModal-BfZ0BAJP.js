import{c}from"./index-D166wLab.js";import{_ as l,a as s}from"./utils-IDgkbHQc.js";import{o as u,c as h,d as n,k as p,m,i as w}from"./vue-vendor-DJOL9Rss.js";import"./crypto-vendor-BQKGlhCi.js";const y={name:"AuthorizationModal",props:{show:{type:Boolean,required:!0},localData:{type:Object,required:!0}},emits:["close","authorized"],data(){return{password:""}},methods:{async authorize(){if(c.MD5(this.password).toString()==="71d114fc94f6a0badc14cf88cb4b8d98")try{const o=await this.encodeLargeData(this.localData);if(!o){s("Brak zakodowanych danych","red");return}if(!(await fetch("https://mc.kot.li/?key=shiftData.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"shiftData",value:o})})).ok)throw new Error("Nie udało się zaktualizować danych na serwerze");s("Zmiany zapisano!","green"),this.$emit("authorized")}catch(o){s(o.message||"Nie udało się zaktualizować danych","red")}else s("Złe hasło","red");this.closeModal()},closeModal(){this.password="",this.$emit("close")},async encodeLargeData(d){try{localStorage.removeItem("isEditingMode");const e=JSON.stringify(d,null,2),o=new Blob([e],{type:"application/json"}),r=new FileReader,i=await new Promise((a,t)=>{r.onloadend=()=>{a(r.result.split(",")[1])},r.onerror=()=>t(new Error("Failed to read the Blob")),r.readAsDataURL(o)});return localStorage.setItem("isEditingMode",JSON.stringify(!0)),i}catch{return s("Nie udało się zakodować danych","red"),localStorage.setItem("isEditingMode",JSON.stringify(!0)),null}},cancel(){this.closeModal()}}},f={key:0,class:"modal"},g={class:"modal-content"};function z(d,e,o,r,i,a){return o.show?(u(),h("section",f,[n("div",g,[e[3]||(e[3]=n("p",null,"Wpisz hasło:",-1)),p(n("input",{type:"password","onUpdate:modelValue":e[0]||(e[0]=t=>i.password=t)},null,512),[[m,i.password]]),n("button",{onClick:e[1]||(e[1]=(...t)=>a.authorize&&a.authorize(...t))},"Zapisz"),n("button",{onClick:e[2]||(e[2]=(...t)=>a.cancel&&a.cancel(...t))},"Anuluj")])])):w("",!0)}const S=l(y,[["render",z],["__scopeId","data-v-0afe4de4"]]);export{S as default};
