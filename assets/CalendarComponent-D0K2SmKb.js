import{d as u}from"./daysOfWeek-C19XqJ9X.js";import{N as C,a as m,c as b,r as v,_ as w}from"./utils-7_cPcmap.js";import{c as h,d as r,i as p,q as c,F as y,a as N,o as l,n as f,t as S}from"./vue-vendor-DAxx2COs.js";const M={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:C},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:u,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1}},methods:{handleDrop(i,e){const n=JSON.parse(localStorage.getItem("draggedPerson"));if(!n)return;const s=this.monthDays.find(d=>d.date.toDateString()===i.toDateString()),o={...s,[e]:n.id};if(o.dayShift1!=null&&o.dayShift2!=null&&o.dayShift1===o.dayShift2||o.nightShift1!=null&&o.nightShift2!=null&&o.nightShift1===o.nightShift2){m("Ta sama osoba na obydwu zmianach.","red");return}const a=n.ratownik;let t=!1;switch(e){case"dayShift1":t=s.dayShift2Ratownik;break;case"dayShift2":t=s.dayShift1Ratownik;break;case"nightShift1":t=s.nightShift2Ratownik;break;case"nightShift2":t=s.nightShift1Ratownik;break}if(a&&t){m("Nie można przypisać dwóch ratowników na jedną zmianę.","red");return}s[e]=n.id,s[`${e}Name`]=n.name,s[`${e}Ratownik`]=n.ratownik,s[`${e}UserChanged`]=!0;const g={dayShift1:s.dayShift1,dayShift2:s.dayShift2,nightShift1:s.nightShift1,nightShift2:s.nightShift2};this.localData[i.toDateString()]=g,localStorage.setItem(i.toDateString(),JSON.stringify(g)),this.madeChanges=!0,this.$emit("has-changes",!0),localStorage.removeItem("draggedPerson")},isDropTarget(i,e){return this.currentDropTarget.date?this.currentDropTarget.date.toDateString()===i.toDateString()&&this.currentDropTarget.shiftType===e:!1},handleClickResetShift(i,e){if(i[e]!==null){i[e]=null,i[e+"Name"]="Usunięto",i[e+"Ratownik"]=null,i[e+"UserChanged"]=!0;const n={dayShift1:i.dayShift1,dayShift2:i.dayShift2,nightShift1:i.nightShift1,nightShift2:i.nightShift2};this.localData[i.date.toDateString()]=n,localStorage.setItem(i.date.toDateString(),JSON.stringify(n)),this.madeChanges=!0,this.$emit("has-changes",!0)}},resolvePersonName(i){const e=this.people.find(n=>n.id===i);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const i=this.selectedYear,e=this.selectedMonth,n=new Date(i,e+1,0).getDate();this.monthDays=[];for(let s=1;s<=n;s++)this.monthDays.push({date:new Date(i,e,s),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(i){this.madeChanges=i,this.$emit("has-changes",i)},emitEditingMode(i){this.$emit("update-editing-mode",i)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await b(()=>this.generateMonthDays())},loadFromLocalStorage(){const i=this.selectedYear,e=this.selectedMonth;for(let n=1;n<=31;n++){const s=new Date(i,e,n).toDateString();if(this.syncedChanges[s])continue;const o=localStorage.getItem(s);if(o)try{const a=JSON.parse(o),t=this.monthDays.find(g=>g.date.toDateString()===s);if(t){t.dayShift1=a.dayShift1,t.dayShift2=a.dayShift2,t.nightShift1=a.nightShift1,t.nightShift2=a.nightShift2;const g=this.resolvePersonName(t.dayShift1);t.dayShift1Name=g.name,t.dayShift1Ratownik=g.isRatownik;const d=this.resolvePersonName(t.dayShift2);t.dayShift2Name=d.name,t.dayShift2Ratownik=d.isRatownik;const k=this.resolvePersonName(t.nightShift1);t.nightShift1Name=k.name,t.nightShift1Ratownik=k.isRatownik;const D=this.resolvePersonName(t.nightShift2);t.nightShift2Name=D.name,t.nightShift2Ratownik=D.isRatownik}}catch(a){m("Failed to load local data: "+a,"red")}}},resetSyncedChangesSessionStorage(){this.syncedChanges=v()},resetUserChanges(){for(const i in localStorage)if(!(i==="isEditingMode"||i==="currentPage")&&localStorage.hasOwnProperty(i))try{const e=JSON.parse(localStorage.getItem(i)||"{}");(e.dayShift1UserChanged||e.dayShift2UserChanged||e.nightShift1UserChanged||e.nightShift2UserChanged)&&localStorage.removeItem(i)}catch{continue}this.localData={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges),this.editedShifts={}},handleScroll(i){this.scrollContainer&&(i.preventDefault(),this.scrollContainer.scrollLeft+=i.deltaY)},getDayClass(i){return u[i]==="Nd"?"nd-color":u[i]==="Sob"?"sob-color":"normal-color"},getShiftAriaLabel(i,e){const n=i[e],s=e.includes("day")?"Zmiana dzienna":"Zmiana nocna",o=i[`${e}Name`];return this.isEditingMode?n?`${s}: ${o}. Kliknij aby usunąć zmianę.`:`${s}: Pusta zmiana. Przeciągnij członka zespołu by nadać im zmianę.`:n?`${s}: ${o}`:`${s}: Pusta zmiana.`},getShiftTooltip(i,e){const n=i[e],s=e.includes("day")?"Zmiana dzienna":"Zmiana nocna";return this.isEditingMode?n?`${s}: ${i[`${e}Name`]} (Kliknij by usunąć)`:`Przeciągnij członka zespołu by nadać im - ${s.toLowerCase()}`:n?`${s}: ${i[`${e}Name`]}`:`${s}: Nieprzypisana`},checkMobilePlatform(){const i=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(i.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(i){const e=new Date;return i.getDate()===e.getDate()&&i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.checkMobilePlatform()},watch:{isEditingMode(i){localStorage.setItem("isEditingMode",JSON.stringify(i)),i&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays()},selectedYear(){this.generateMonthDays()}}},_={key:0,class:"mobile-warning-overlay"},R={class:"mobile-warning"},z={class:"calendar-container"},U={class:"calendar-grid"},E=["onDrop"],P={class:"day-header"},O=["onDrop"],W={class:"day-date"},L=["clickable","onDrop","onClick","aria-label","title"],j={key:0,class:"assigned-person"},A={key:1,class:"assigned-person deleted"},I={key:2,class:"empty-slot"},F=["clickable","onDrop","onClick","aria-label","title"],Y={key:0,class:"assigned-person"},x={key:1,class:"assigned-person deleted"},J={key:2,class:"empty-slot"},T=["onDrop","onClick","aria-label","title"],q={key:0,class:"assigned-person"},B={key:1,class:"assigned-person deleted"},Z={key:2,class:"empty-slot"},K=["clickable","onDrop","onClick","aria-label","title"],V={key:0,class:"assigned-person"},G={key:1,class:"assigned-person deleted"},H={key:2,class:"empty-slot"};function Q(i,e,n,s,o,a){return l(),h(y,null,[o.showMobileWarning?(l(),h("div",_,[r("div",R,[e[7]||(e[7]=r("h3",null,"!! Urządzenie mobilne wykryte !!",-1)),e[8]||(e[8]=r("p",null," Niestety, tryb edycji w widoku kalendarza nie jest obsługiwany na urządzeniach mobilnych. ",-1)),e[9]||(e[9]=r("p",null,"Proszę przejdź do widoku tabeli lub skorzystaj z komputera.",-1)),r("button",{onClick:e[0]||(e[0]=(...t)=>a.handleMobileWarningClose&&a.handleMobileWarningClose(...t)),class:"warning-button"}," Ok ☹ ")])])):p("",!0),r("div",z,[r("section",{class:"scrollable-container",onWheel:e[6]||(e[6]=c((...t)=>a.handleScroll&&a.handleScroll(...t),["prevent"])),ref:"scrollContainer"},[r("div",U,[(l(!0),h(y,null,N(o.monthDays,(t,g)=>(l(),h("div",{key:g,class:f(["day-column",{"today-column":a.isToday(t.date)}]),onDragover:e[5]||(e[5]=c(()=>{},["prevent"])),onDrop:d=>a.handleDrop(t.date,"day")},[r("div",null,[r("div",{class:f(["day-cell",{"current-month":t.isCurrentMonth,"nd-color":o.daysOfWeek[t.date.getDay()]==="Nd","sob-color":o.daysOfWeek[t.date.getDay()]==="Sob",today:a.isToday(t.date)}])},[r("div",P,S(o.daysOfWeek[t.date.getDay()]),1),r("div",{class:"shift",onDrop:d=>a.handleDrop(t.date,"day"),onDragover:e[4]||(e[4]=c(()=>{},["prevent"]))},[r("div",W,S(t.date.getDate()),1),r("div",{class:f(["shift-slot day",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.dayShift1,ratownik:t.dayShift1Ratownik===!0,pielegniarka:t.dayShift1Ratownik===!1,userChanged:t.dayShift1UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDragover:e[1]||(e[1]=c(()=>{},["prevent"])),onDrop:d=>a.handleDrop(t.date,"dayShift1"),onClick:d=>n.isEditingMode&&a.handleClickResetShift(t,"dayShift1"),"aria-label":a.getShiftAriaLabel(t,"dayShift1"),title:a.getShiftTooltip(t,"dayShift1"),role:"button",tabindex:"0"},[t.dayShift1?(l(),h("div",j,S(t.dayShift1Name),1)):t.dayShift1UserChanged?(l(),h("div",A," Usunięto ")):(l(),h("div",I,"D"))],42,L),r("div",{class:f(["shift-slot day",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.dayShift2,ratownik:t.dayShift2Ratownik===!0,pielegniarka:t.dayShift2Ratownik===!1,userChanged:t.dayShift2UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDrop:d=>a.handleDrop(t.date,"dayShift2"),onClick:d=>n.isEditingMode&&a.handleClickResetShift(t,"dayShift2"),"aria-label":a.getShiftAriaLabel(t,"dayShift2"),title:a.getShiftTooltip(t,"dayShift2"),role:"button",tabindex:"0"},[t.dayShift2?(l(),h("div",Y,S(t.dayShift2Name),1)):t.dayShift2UserChanged?(l(),h("div",x," Usunięto ")):(l(),h("div",J,"D"))],42,F),r("div",{class:f(["shift-slot night",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.nightShift1,ratownik:t.nightShift1Ratownik===!0,pielegniarka:t.nightShift1Ratownik===!1,userChanged:t.nightShift1UserChanged===!0,clickable:n.isEditingMode}]),onDragover:e[2]||(e[2]=c(()=>{},["prevent"])),onDrop:d=>a.handleDrop(t.date,"nightShift1"),onClick:d=>n.isEditingMode&&a.handleClickResetShift(t,"nightShift1"),"aria-label":a.getShiftAriaLabel(t,"nightShift1"),title:a.getShiftTooltip(t,"nightShift1"),role:"button",tabindex:"0"},[t.nightShift1?(l(),h("div",q,S(t.nightShift1Name),1)):t.nightShift1UserChanged?(l(),h("div",B," Usunięto ")):(l(),h("div",Z,"N"))],42,T),r("div",{class:f(["shift-slot night",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.nightShift2,ratownik:t.nightShift2Ratownik===!0,pielegniarka:t.nightShift2Ratownik===!1,userChanged:t.nightShift2UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDragover:e[3]||(e[3]=c(()=>{},["prevent"])),onDrop:d=>a.handleDrop(t.date,"nightShift2"),onClick:d=>n.isEditingMode&&a.handleClickResetShift(t,"nightShift2"),"aria-label":a.getShiftAriaLabel(t,"nightShift2"),title:a.getShiftTooltip(t,"nightShift2"),role:"button",tabindex:"0"},[t.nightShift2?(l(),h("div",V,S(t.nightShift2Name),1)):t.nightShift2UserChanged?(l(),h("div",G," Usunięto ")):(l(),h("div",H,"N"))],42,K)],40,O)],2)])],42,E))),128))])],544)])],64)}const et=w(M,[["render",Q],["__scopeId","data-v-20665c33"]]);export{et as default};
