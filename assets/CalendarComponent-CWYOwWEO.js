import{d as u}from"./daysOfWeek-C19XqJ9X.js";import{_ as y,a as m,c as p,r as b}from"./utils-BY5kvcl7.js";import{o as d,c as g,d as h,i as C,w as l,F as v,a as w,n as S,t as f}from"./vue-vendor-F-eyJ2U6.js";const N={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:u,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1}},methods:{handleDrop(i,t){const n=JSON.parse(localStorage.getItem("draggedPerson"));if(!n)return;const o=this.monthDays.find(s=>s.date.toDateString()===i.toDateString()),r={...o,[t]:n.id};if(r.dayShift1!=null&&r.dayShift2!=null&&r.dayShift1===r.dayShift2||r.nightShift1!=null&&r.nightShift2!=null&&r.nightShift1===r.nightShift2){m("Ta sama osoba na obydwu zmianach.","red");return}const a=n.ratownik;let e=!1;switch(t){case"dayShift1":e=o.dayShift2Ratownik;break;case"dayShift2":e=o.dayShift1Ratownik;break;case"nightShift1":e=o.nightShift2Ratownik;break;case"nightShift2":e=o.nightShift1Ratownik;break}if(a&&e){m("Nie można przypisać dwóch ratowników na jedną zmianę.","red");return}o[t]=n.id,o[`${t}Name`]=n.name,o[`${t}Ratownik`]=n.ratownik,o[`${t}UserChanged`]=!0;const c={dayShift1:o.dayShift1,dayShift2:o.dayShift2,nightShift1:o.nightShift1,nightShift2:o.nightShift2};this.localData[i.toDateString()]=c,localStorage.setItem(i.toDateString(),JSON.stringify(c)),this.madeChanges=!0,this.$emit("has-changes",!0),localStorage.removeItem("draggedPerson")},handlePointerMove(i,t,n){this.currentDropTarget={date:t,shiftType:n},i.preventDefault()},handlePointerEnd(i,t,n){JSON.parse(localStorage.getItem("draggedPerson"))&&(this.handleDrop(t,n),this.currentDropTarget={date:null,shiftType:null})},isDropTarget(i,t){return this.currentDropTarget.date?this.currentDropTarget.date.toDateString()===i.toDateString()&&this.currentDropTarget.shiftType===t:!1},handleClickResetShift(i,t){if(i[t]!==null){i[t]=null,i[t+"Name"]="Usunięto",i[t+"Ratownik"]=null,i[t+"UserChanged"]=!0;const n={dayShift1:i.dayShift1,dayShift2:i.dayShift2,nightShift1:i.nightShift1,nightShift2:i.nightShift2};this.localData[i.date.toDateString()]=n,localStorage.setItem(i.date.toDateString(),JSON.stringify(n)),i[t]="Usunięto",this.madeChanges=!0,this.$emit("has-changes",!0)}},resolvePersonName(i){const t=this.people.find(n=>n.id===i);return t?{name:t.name,isRatownik:t.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const i=this.selectedYear,t=this.selectedMonth,n=new Date(i,t+1,0).getDate();this.monthDays=[];for(let o=1;o<=n;o++)this.monthDays.push({date:new Date(i,t,o),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(i){this.madeChanges=i,this.$emit("has-changes",i)},emitEditingMode(i){this.$emit("update-editing-mode",i)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await p(()=>this.generateMonthDays())},loadFromLocalStorage(){const i=this.selectedYear,t=this.selectedMonth;for(let n=1;n<=31;n++){const o=new Date(i,t,n).toDateString();if(this.syncedChanges[o])continue;const r=localStorage.getItem(o);if(r)try{const a=JSON.parse(r),e=this.monthDays.find(c=>c.date.toDateString()===o);if(e){e.dayShift1=a.dayShift1,e.dayShift2=a.dayShift2,e.nightShift1=a.nightShift1,e.nightShift2=a.nightShift2;const c=this.resolvePersonName(e.dayShift1);e.dayShift1Name=c.name,e.dayShift1Ratownik=c.isRatownik;const s=this.resolvePersonName(e.dayShift2);e.dayShift2Name=s.name,e.dayShift2Ratownik=s.isRatownik;const k=this.resolvePersonName(e.nightShift1);e.nightShift1Name=k.name,e.nightShift1Ratownik=k.isRatownik;const D=this.resolvePersonName(e.nightShift2);e.nightShift2Name=D.name,e.nightShift2Ratownik=D.isRatownik}}catch(a){m("Failed to load local data: "+a,"red")}}},resetSyncedChangesSessionStorage(){this.syncedChanges=b()},resetUserChanges(){for(const i in localStorage)if(localStorage.hasOwnProperty(i)){const t=JSON.parse(localStorage.getItem(i)||"{}");(t.dayShift1UserChanged||t.dayShift2UserChanged||t.nightShift1UserChanged||t.nightShift2UserChanged)&&localStorage.removeItem(i)}this.localData={},this.madeChanges=!1,this.$emit("has-changes",!1)},handleScroll(i){this.scrollContainer&&(i.preventDefault(),this.scrollContainer.scrollLeft+=i.deltaY)},getDayClass(i){return u[i]==="Nd"?"nd-color":u[i]==="Sob"?"sob-color":"normal-color"},getShiftAriaLabel(i,t){const n=i[t],o=t.includes("day")?"Zmiana dzienna":"Zmiana nocna",r=i[`${t}Name`];return this.isEditingMode?n?`${o}: ${r}. Kliknij aby usunąć zmianę.`:`${o}: Pusta zmiana. Przeciągnij członka zespołu by nadać im zmianę.`:n?`${o}: ${r}`:`${o}: Pusta zmiana.`},getShiftTooltip(i,t){const n=i[t],o=t.includes("day")?"Zmiana dzienna":"Zmiana nocna";return this.isEditingMode?n?`${o}: ${i[`${t}Name`]} (Kliknij by usunąć)`:`Przeciągnij członka zespołu by nadać im - ${o.toLowerCase()}`:n?`${o}: ${i[`${t}Name`]}`:`${o}: Nieprzypisana`},checkMobilePlatform(){const i=navigator.userAgent||navigator.vendor||window.opera;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(i.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},handlePointerUp(i){i.pointerType==="touch"&&(this.touchTimer&&(clearTimeout(this.touchTimer),this.touchTimer=null),this.touchedElement&&(this.touchedElement.releasePointerCapture(i.pointerId),this.touchedElement.classList.remove("being-touched")),this.isDragging=!1,this.touchedElement=null,this.touchedPerson=null)}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.checkMobilePlatform()},watch:{isEditingMode(i){localStorage.setItem("isEditingMode",JSON.stringify(i)),i&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays()},selectedYear(){this.generateMonthDays()}}},P={key:0,class:"mobile-warning-overlay"},M={class:"mobile-warning"},R={class:"calendar-container"},_={class:"calendar-grid"},z=["onDrop"],E={class:"day-header"},U=["onDrop"],O={class:"day-date"},L=["clickable","onDrop","onPointerup","onPointermove","onClick","aria-label","title"],W={key:0,class:"assigned-person"},T={key:1,class:"empty-slot"},I=["clickable","onDrop","onPointerup","onPointermove","onClick","aria-label","title"],j={key:0,class:"assigned-person"},A={key:1,class:"empty-slot"},J=["onDrop","onPointerup","onPointermove","onClick","aria-label","title"],x={key:0,class:"assigned-person"},F={key:1,class:"empty-slot"},Y=["clickable","onDrop","onPointerup","onPointermove","onClick","aria-label","title"],q={key:0,class:"assigned-person"},B={key:1,class:"empty-slot"};function Z(i,t,n,o,r,a){return d(),g(v,null,[r.showMobileWarning?(d(),g("div",P,[h("div",M,[t[7]||(t[7]=h("h3",null,"!! Urządzenie mobilne wykryte !!",-1)),t[8]||(t[8]=h("p",null," Niestety, tryb edycji w widoku kalendarza nie jest obsługiwany na urządzeniach mobilnych. ",-1)),t[9]||(t[9]=h("p",null,"Proszę przejdź do widoku tabeli lub skorzystaj z komputera.",-1)),h("button",{onClick:t[0]||(t[0]=(...e)=>a.handleMobileWarningClose&&a.handleMobileWarningClose(...e)),class:"warning-button"}," Ok :( ")])])):C("",!0),h("div",R,[h("section",{class:"scrollable-container",onWheel:t[6]||(t[6]=l((...e)=>a.handleScroll&&a.handleScroll(...e),["prevent"])),ref:"scrollContainer"},[h("div",_,[(d(!0),g(v,null,w(r.monthDays,(e,c)=>(d(),g("div",{key:c,class:"day-column",onDragover:t[5]||(t[5]=l(()=>{},["prevent"])),onDrop:s=>a.handleDrop(e.date,"day")},[h("div",null,[h("div",{class:S(["day-cell",{"current-month":e.isCurrentMonth,"nd-color":r.daysOfWeek[e.date.getDay()]==="Nd","sob-color":r.daysOfWeek[e.date.getDay()]==="Sob"}])},[h("div",E,f(r.daysOfWeek[e.date.getDay()]),1),h("div",{class:"shift",onDrop:s=>a.handleDrop(e.date,"day"),onDragover:t[4]||(t[4]=l(()=>{},["prevent"]))},[h("div",O,f(e.date.getDate()),1),h("div",{class:S(["shift-slot day",{"synced-changed":r.syncedChanges[e.date.toDateString()]?.dayShift1,ratownik:e.dayShift1Ratownik===!0,pielegniarka:e.dayShift1Ratownik===!1,userChanged:e.dayShift1UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDragover:t[1]||(t[1]=l(()=>{},["prevent"])),onDrop:s=>a.handleDrop(e.date,"dayShift1"),onPointerup:l(s=>a.handlePointerUp(s,e.date,"dayShift1"),["prevent"]),onPointermove:l(s=>a.handlePointerMove(s,e.date,"dayShift1"),["prevent"]),onClick:s=>n.isEditingMode&&a.handleClickResetShift(e,"dayShift1"),"aria-label":a.getShiftAriaLabel(e,"dayShift1"),title:a.getShiftTooltip(e,"dayShift1"),role:"button",tabindex:"0"},[e.dayShift1?(d(),g("div",W,f(e.dayShift1Name),1)):(d(),g("div",T,"D"))],42,L),h("div",{class:S(["shift-slot day",{"synced-changed":r.syncedChanges[e.date.toDateString()]?.dayShift2,ratownik:e.dayShift2Ratownik===!0,pielegniarka:e.dayShift2Ratownik===!1,userChanged:e.dayShift2UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDrop:s=>a.handleDrop(e.date,"dayShift2"),onPointerup:l(s=>a.handlePointerUp(s,e.date,"dayShift2"),["prevent"]),onPointermove:l(s=>a.handlePointerMove(s,e.date,"dayShift2"),["prevent"]),onClick:s=>n.isEditingMode&&a.handleClickResetShift(e,"dayShift2"),"aria-label":a.getShiftAriaLabel(e,"dayShift2"),title:a.getShiftTooltip(e,"dayShift2"),role:"button",tabindex:"0"},[e.dayShift2?(d(),g("div",j,f(e.dayShift2Name),1)):(d(),g("div",A,"D"))],42,I),h("div",{class:S(["shift-slot night",{"synced-changed":r.syncedChanges[e.date.toDateString()]?.nightShift1,ratownik:e.nightShift1Ratownik===!0,pielegniarka:e.nightShift1Ratownik===!1,userChanged:e.nightShift1UserChanged===!0,clickable:n.isEditingMode}]),onDragover:t[2]||(t[2]=l(()=>{},["prevent"])),onDrop:s=>a.handleDrop(e.date,"nightShift1"),onPointerup:l(s=>a.handlePointerUp(s,e.date,"nightShift1"),["prevent"]),onPointermove:l(s=>a.handlePointerMove(s,e.date,"nightShift1"),["prevent"]),onClick:s=>n.isEditingMode&&a.handleClickResetShift(e,"nightShift1"),"aria-label":a.getShiftAriaLabel(e,"nightShift1"),title:a.getShiftTooltip(e,"nightShift1"),role:"button",tabindex:"0"},[e.nightShift1?(d(),g("div",x,f(e.nightShift1Name),1)):(d(),g("div",F,"N"))],42,J),h("div",{class:S(["shift-slot night",{"synced-changed":r.syncedChanges[e.date.toDateString()]?.nightShift2,ratownik:e.nightShift2Ratownik===!0,pielegniarka:e.nightShift2Ratownik===!1,userChanged:e.nightShift2UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDragover:t[3]||(t[3]=l(()=>{},["prevent"])),onDrop:s=>a.handleDrop(e.date,"nightShift2"),onPointerup:l(s=>a.handlePointerUp(s,e.date,"nightShift2"),["prevent"]),onPointermove:l(s=>a.handlePointerMove(s,e.date,"nightShift2"),["prevent"]),onClick:s=>n.isEditingMode&&a.handleClickResetShift(e,"nightShift2"),"aria-label":a.getShiftAriaLabel(e,"nightShift2"),title:a.getShiftTooltip(e,"nightShift2"),role:"button",tabindex:"0"},[e.nightShift2?(d(),g("div",q,f(e.nightShift2Name),1)):(d(),g("div",B,"N"))],42,Y)],40,U)],2)])],40,z))),128))])],544)])],64)}const H=y(N,[["render",Z],["__scopeId","data-v-fdfca8ce"]]);export{H as default};
