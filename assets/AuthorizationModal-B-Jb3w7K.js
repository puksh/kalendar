const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pbkdf2-Dyyg270d.js","assets/crypto-vendor-x_riFVyO.js"])))=>i.map(i=>d[i]);
import{_ as w}from"./index-Cph13O-O.js";import{N as p,a as l,_ as g}from"./utils-B-gdOSXq.js";import{c as d,e as h,o as c,d as e,t as u,l as f,u as m,x as z,n as y}from"./vue-vendor-wnm_OC9P.js";const b={name:"AuthorizationModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"save",validator:t=>["save","salary"].includes(t)}},emits:["close","authorized"],components:{NotificationMessage:p},data(){return{password:"",isAuthorizing:!1,showPassword:!1}},methods:{getButtonText(){return this.isAuthorizing?"Weryfikacja...":this.mode==="salary"?"Wyświetl wynagrodzenie":"Zapisz zmiany"},async authorize(){if(!this.isAuthorizing){this.isAuthorizing=!0,this.showPassword=!1;try{if(!await this.verifyPassword()){l("Nieprawidłowe hasło","red"),this.password="";return}this.mode==="salary"?this.handleSalaryMode():await this.handleSaveMode()}catch(t){console.error(t),l("Wystąpił błąd podczas autoryzacji","red")}finally{this.isAuthorizing=!1}}},async verifyPassword(){const t=await w(()=>import("./pbkdf2-Dyyg270d.js").then(a=>a.p),__vite__mapDeps([0,1])),s="asmmRrfFvKrsBgyLzUuiZD9tGQj3LAQj",i=1e5,r=256/32;return t.default(this.password,s,{keySize:r,iterations:i}).toString()==="5fb04c8d929f687dd2baed132f66d67a8a442cab4d2d84cec4a58b08f01f9c6b"},handleSalaryMode(){l("Dostęp przyznany","green"),this.$emit("authorized"),this.closeModal()},async handleSaveMode(){const t=this.collectLocalStorageData();if(Object.keys(t).length===0){l("Brak zmian do zapisania","yellow");return}await this.saveDataToServer(t),l("Zmiany zapisano pomyślnie!","green"),this.$emit("authorized"),this.closeModal()},collectLocalStorageData(){const t={},s=["isEditingMode","currentPage"];for(let i=0;i<localStorage.length;i++){const r=localStorage.key(i);if(r&&!s.includes(r))try{t[r]=JSON.parse(localStorage.getItem(r))}catch{}}return t},async saveDataToServer(t){const s=JSON.stringify(t),i=btoa(s),r=await fetch("https://mc.kot.li/?key=shiftData.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"shiftData",value:i})});if(!r.ok)throw new Error(`Server error: ${r.status}`)},closeModal(){this.password="",this.$emit("close")},cancel(){this.isAuthorizing||this.closeModal()},togglePasswordVisibility(){this.showPassword=!this.showPassword}},mounted(){this.$nextTick(()=>{this.$refs.passwordInput?.focus()})}},v={key:0,class:"modal"},_={class:"modal-content"},k={class:"input-container"},P=["type"],S=["aria-label","title"],A={class:"eye-icon"},D={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"22",height:"22",fill:"none",stroke:"white","stroke-width":"2"},x={class:"button-container"},M=["disabled"],j={key:0,class:"spinner"},B=["disabled"];function N(t,s,i,r,o,n){return i.show?(c(),d("section",v,[e("div",_,[s[6]||(s[6]=e("h3",null,"Autoryzacja",-1)),e("p",null,u(i.mode==="salary"?"Wpisz hasło aby wyświetlić wynagrodzenie:":"Wpisz hasło aby zapisać zmiany:"),1),e("div",k,[f(e("input",{type:o.showPassword?"text":"password","onUpdate:modelValue":s[0]||(s[0]=a=>o.password=a),onKeyup:s[1]||(s[1]=z((...a)=>n.authorize&&n.authorize(...a),["enter"])),placeholder:"Hasło...",autocomplete:"current-password",ref:"passwordInput"},null,40,P),[[m,o.password]]),e("button",{type:"button",class:"toggle-password-button",onClick:s[2]||(s[2]=(...a)=>n.togglePasswordVisibility&&n.togglePasswordVisibility(...a)),"aria-label":o.showPassword?"Ukryj hasło":"Pokaż hasło",title:o.showPassword?"Ukryj hasło":"Pokaż hasło"},[e("span",A,[(c(),d("svg",D,[e("g",{class:y({"eye-hidden":!o.showPassword})},s[5]||(s[5]=[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)]),2),e("line",{class:y(["eye-slash",{"eye-slash-hidden":o.showPassword}]),x1:"2",y1:"2",x2:"22",y2:"22"},null,2)]))])],8,S)]),e("div",x,[e("button",{class:"primary-button",onClick:s[3]||(s[3]=(...a)=>n.authorize&&n.authorize(...a)),disabled:o.isAuthorizing},[e("span",null,u(n.getButtonText()),1),o.isAuthorizing?(c(),d("span",j)):h("",!0)],8,M),e("button",{class:"secondary-button",onClick:s[4]||(s[4]=(...a)=>n.cancel&&n.cancel(...a)),disabled:o.isAuthorizing}," Anuluj ",8,B)])])])):h("",!0)}const C=g(b,[["render",N],["__scopeId","data-v-7457cb02"]]);export{C as default};
