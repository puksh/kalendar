import{d as u}from"./daysOfWeek-C19XqJ9X.js";import{N as b,r as C,a as m,c as v,_ as w}from"./utils-ILKzS2sg.js";import{c as h,o as l,e as p,d as r,w as c,F as D,a as N,n as f,t as S}from"./vue-vendor-CVTALk6y.js";const M={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:b},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:u,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1}},methods:{handleDrop(i,e){const a=JSON.parse(localStorage.getItem("draggedPerson"));if(!a)return;const n=this.monthDays.find(d=>d.date.toDateString()===i.toDateString()),o={...n,[e]:a.id};if(o.dayShift1!=null&&o.dayShift2!=null&&o.dayShift1===o.dayShift2||o.nightShift1!=null&&o.nightShift2!=null&&o.nightShift1===o.nightShift2){m("Ta sama osoba na obydwu zmianach.","red");return}const s=a.ratownik;let t=!1;switch(e){case"dayShift1":t=n.dayShift2Ratownik;break;case"dayShift2":t=n.dayShift1Ratownik;break;case"nightShift1":t=n.nightShift2Ratownik;break;case"nightShift2":t=n.nightShift1Ratownik;break}if(s&&t){m("Nie można przypisać dwóch ratowników na jedną zmianę.","red");return}n[e]=a.id,n[`${e}Name`]=a.name,n[`${e}Ratownik`]=a.ratownik,n[`${e}UserChanged`]=!0;const g={dayShift1:n.dayShift1,dayShift2:n.dayShift2,nightShift1:n.nightShift1,nightShift2:n.nightShift2};this.localData[i.toDateString()]=g,localStorage.setItem(i.toDateString(),JSON.stringify(g)),this.madeChanges=!0,this.$emit("has-changes",!0),localStorage.removeItem("draggedPerson")},isDropTarget(i,e){return this.currentDropTarget.date?this.currentDropTarget.date.toDateString()===i.toDateString()&&this.currentDropTarget.shiftType===e:!1},handleClickResetShift(i,e){if(i[e]!==null){i[e]=null,i[e+"Name"]="Usunięto",i[e+"Ratownik"]=null,i[e+"UserChanged"]=!0;const a={dayShift1:i.dayShift1,dayShift2:i.dayShift2,nightShift1:i.nightShift1,nightShift2:i.nightShift2};this.localData[i.date.toDateString()]=a,localStorage.setItem(i.date.toDateString(),JSON.stringify(a)),this.madeChanges=!0,this.$emit("has-changes",!0)}},resolvePersonName(i){const e=this.people.find(a=>a.id===i);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const i=this.selectedYear,e=this.selectedMonth,a=new Date(i,e+1,0).getDate();this.monthDays=[];for(let n=1;n<=a;n++)this.monthDays.push({date:new Date(i,e,n),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(i){this.madeChanges=i,this.$emit("has-changes",i)},emitEditingMode(i){this.$emit("update-editing-mode",i)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await v(()=>this.generateMonthDays())},loadFromLocalStorage(){const i=this.selectedYear,e=this.selectedMonth;for(let a=1;a<=31;a++){const n=new Date(i,e,a).toDateString();if(this.syncedChanges[n])continue;const o=localStorage.getItem(n);if(o)try{const s=JSON.parse(o),t=this.monthDays.find(g=>g.date.toDateString()===n);if(t){t.dayShift1=s.dayShift1,t.dayShift2=s.dayShift2,t.nightShift1=s.nightShift1,t.nightShift2=s.nightShift2;const g=this.resolvePersonName(t.dayShift1);t.dayShift1Name=g.name,t.dayShift1Ratownik=g.isRatownik;const d=this.resolvePersonName(t.dayShift2);t.dayShift2Name=d.name,t.dayShift2Ratownik=d.isRatownik;const k=this.resolvePersonName(t.nightShift1);t.nightShift1Name=k.name,t.nightShift1Ratownik=k.isRatownik;const y=this.resolvePersonName(t.nightShift2);t.nightShift2Name=y.name,t.nightShift2Ratownik=y.isRatownik}}catch(s){m("Failed to load local data: "+s,"red")}}},resetSyncedChangesSessionStorage(){this.syncedChanges=C()},resetUserChanges(){for(const i in localStorage)if(!(i==="isEditingMode"||i==="currentPage")&&localStorage.hasOwnProperty(i))try{const e=JSON.parse(localStorage.getItem(i)||"{}");(e.dayShift1UserChanged||e.dayShift2UserChanged||e.nightShift1UserChanged||e.nightShift2UserChanged)&&localStorage.removeItem(i)}catch{continue}this.localData={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges),this.editedShifts={}},handleScroll(i){this.scrollContainer&&(i.preventDefault(),this.scrollContainer.scrollLeft+=i.deltaY)},scrollToToday(){this.$nextTick(()=>{const i=new Date;if(i.getMonth()===this.selectedMonth&&i.getFullYear()===this.selectedYear){const e=this.monthDays.findIndex(a=>this.isToday(a.date));if(e!==-1&&this.scrollContainer){const a=document.querySelector(".day-cell")?.offsetWidth||0,n=this.scrollContainer.offsetWidth,o=a*e-n/2+a/2;this.scrollContainer.scrollTo({left:Math.max(0,o),behavior:"smooth"})}}})},getDayClass(i){return u[i]==="Nd"?"nd-color":u[i]==="Sob"?"sob-color":"normal-color"},getShiftAriaLabel(i,e){const a=i[e],n=e.includes("day")?"Zmiana dzienna":"Zmiana nocna",o=i[`${e}Name`];return this.isEditingMode?a?`${n}: ${o}. Kliknij aby usunąć zmianę.`:`${n}: Pusta zmiana. Przeciągnij członka zespołu by nadać im zmianę.`:a?`${n}: ${o}`:`${n}: Pusta zmiana.`},getShiftTooltip(i,e){const a=i[e],n=e.includes("day")?"Zmiana dzienna":"Zmiana nocna";return this.isEditingMode?a?`${n}: ${i[`${e}Name`]} (Kliknij by usunąć)`:`Przeciągnij członka zespołu by nadać im - ${n.toLowerCase()}`:a?`${n}: ${i[`${e}Name`]}`:`${n}: Nieprzypisana`},checkMobilePlatform(){const i=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(i.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(i){const e=new Date;return i.getDate()===e.getDate()&&i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.scrollToToday(),this.checkMobilePlatform()},watch:{isEditingMode(i){localStorage.setItem("isEditingMode",JSON.stringify(i)),i&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays(),this.scrollToToday()},selectedYear(){this.generateMonthDays()}}},_={key:0,class:"mobile-warning-overlay"},R={class:"mobile-warning"},z={class:"calendar-container"},U={class:"calendar-grid"},E=["onDrop"],P={class:"day-header"},W=["onDrop"],T={class:"day-date"},O=["clickable","onDrop","onClick","aria-label","title"],L={key:0,class:"assigned-person"},x={key:1,class:"assigned-person deleted"},I={key:2,class:"empty-slot"},j=["clickable","onDrop","onClick","aria-label","title"],A={key:0,class:"assigned-person"},Y={key:1,class:"assigned-person deleted"},F={key:2,class:"empty-slot"},J=["onDrop","onClick","aria-label","title"],q={key:0,class:"assigned-person"},B={key:1,class:"assigned-person deleted"},Z={key:2,class:"empty-slot"},K=["clickable","onDrop","onClick","aria-label","title"],V={key:0,class:"assigned-person"},G={key:1,class:"assigned-person deleted"},H={key:2,class:"empty-slot"};function Q(i,e,a,n,o,s){return l(),h(D,null,[o.showMobileWarning?(l(),h("div",_,[r("div",R,[e[7]||(e[7]=r("h3",null,"!! Urządzenie mobilne wykryte !!",-1)),e[8]||(e[8]=r("p",null," Niestety, tryb edycji w widoku kalendarza nie jest obsługiwany na urządzeniach mobilnych. ",-1)),e[9]||(e[9]=r("p",null,"Proszę przejdź do widoku tabeli lub skorzystaj z komputera.",-1)),r("button",{onClick:e[0]||(e[0]=(...t)=>s.handleMobileWarningClose&&s.handleMobileWarningClose(...t)),class:"warning-button"}," Ok ☹ ")])])):p("",!0),r("div",z,[r("section",{class:"scrollable-container",onWheel:e[6]||(e[6]=c((...t)=>s.handleScroll&&s.handleScroll(...t),["prevent"])),ref:"scrollContainer"},[r("div",U,[(l(!0),h(D,null,N(o.monthDays,(t,g)=>(l(),h("div",{key:g,class:f({"today-column":s.isToday(t.date)}),onDragover:e[5]||(e[5]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"day")},[r("div",null,[r("div",{class:f(["day-cell",{"current-month":t.isCurrentMonth,"nd-color":o.daysOfWeek[t.date.getDay()]==="Nd","sob-color":o.daysOfWeek[t.date.getDay()]==="Sob",today:s.isToday(t.date)}])},[r("div",P,S(o.daysOfWeek[t.date.getDay()]),1),r("div",{class:"shift",onDrop:d=>s.handleDrop(t.date,"day"),onDragover:e[4]||(e[4]=c(()=>{},["prevent"]))},[r("div",T,S(t.date.getDate()),1),r("div",{class:f(["shift-slot day",{ratownik:t.dayShift1Ratownik===!0,pielegniarka:t.dayShift1Ratownik===!1,userChanged:t.dayShift1UserChanged===!0,clickable:a.isEditingMode}]),clickable:a.isEditingMode,onDragover:e[1]||(e[1]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"dayShift1"),onClick:d=>a.isEditingMode&&s.handleClickResetShift(t,"dayShift1"),"aria-label":s.getShiftAriaLabel(t,"dayShift1"),title:s.getShiftTooltip(t,"dayShift1"),role:"button",tabindex:"0"},[t.dayShift1?(l(),h("div",L,S(t.dayShift1Name),1)):t.dayShift1UserChanged?(l(),h("div",x," Usunięto ")):(l(),h("div",I,"D"))],42,O),r("div",{class:f(["shift-slot day",{ratownik:t.dayShift2Ratownik===!0,pielegniarka:t.dayShift2Ratownik===!1,userChanged:t.dayShift2UserChanged===!0,clickable:a.isEditingMode}]),clickable:a.isEditingMode,onDrop:d=>s.handleDrop(t.date,"dayShift2"),onClick:d=>a.isEditingMode&&s.handleClickResetShift(t,"dayShift2"),"aria-label":s.getShiftAriaLabel(t,"dayShift2"),title:s.getShiftTooltip(t,"dayShift2"),role:"button",tabindex:"0"},[t.dayShift2?(l(),h("div",A,S(t.dayShift2Name),1)):t.dayShift2UserChanged?(l(),h("div",Y," Usunięto ")):(l(),h("div",F,"D"))],42,j),r("div",{class:f(["shift-slot night",{ratownik:t.nightShift1Ratownik===!0,pielegniarka:t.nightShift1Ratownik===!1,userChanged:t.nightShift1UserChanged===!0,clickable:a.isEditingMode}]),onDragover:e[2]||(e[2]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"nightShift1"),onClick:d=>a.isEditingMode&&s.handleClickResetShift(t,"nightShift1"),"aria-label":s.getShiftAriaLabel(t,"nightShift1"),title:s.getShiftTooltip(t,"nightShift1"),role:"button",tabindex:"0"},[t.nightShift1?(l(),h("div",q,S(t.nightShift1Name),1)):t.nightShift1UserChanged?(l(),h("div",B," Usunięto ")):(l(),h("div",Z,"N"))],42,J),r("div",{class:f(["shift-slot night",{ratownik:t.nightShift2Ratownik===!0,pielegniarka:t.nightShift2Ratownik===!1,userChanged:t.nightShift2UserChanged===!0,clickable:a.isEditingMode}]),clickable:a.isEditingMode,onDragover:e[3]||(e[3]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"nightShift2"),onClick:d=>a.isEditingMode&&s.handleClickResetShift(t,"nightShift2"),"aria-label":s.getShiftAriaLabel(t,"nightShift2"),title:s.getShiftTooltip(t,"nightShift2"),role:"button",tabindex:"0"},[t.nightShift2?(l(),h("div",V,S(t.nightShift2Name),1)):t.nightShift2UserChanged?(l(),h("div",G," Usunięto ")):(l(),h("div",H,"N"))],42,K)],40,W)],2)])],42,E))),128))])],544)])],64)}const et=w(M,[["render",Q],["__scopeId","data-v-ddc8cd77"]]);export{et as default};
