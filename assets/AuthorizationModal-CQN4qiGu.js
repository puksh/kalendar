const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CzgetsJO.js","assets/crypto-vendor-C-h6Caw_.js"])))=>i.map(i=>d[i]);
import{_}from"./index-T88G5b2L.js";import{N as b,a as l,_ as k}from"./utils-BribboEG.js";import{c as f,h as y,o as m,d as s,w as A,u as v,x as S,t as j}from"./vue-vendor-T9dwXKqP.js";const D={name:"AuthorizationModal",props:{show:{type:Boolean,required:!0}},emits:["close","authorized"],components:{NotificationMessage:b},data(){return{password:"",isAuthorizing:!1}},methods:{async authorize(){if(!this.isAuthorizing){this.isAuthorizing=!0;try{const d=await _(()=>import("./index-CzgetsJO.js").then(a=>a.i),__vite__mapDeps([0,1])),t=this.password,c="asmmRrfFvKrsBgyLzUuiZD9tGQj3LAQj",h=1e5,e=256/32;if(d.PBKDF2(t,c,{keySize:e,iterations:h}).toString()!=="addf7158e42fff0cbf420571d73113377ac694b75fe1d9450e687b4aa18c666f"){l("Nieprawidłowe hasło","red"),this.password="",this.isAuthorizing=!1;return}const u={};for(let a=0;a<localStorage.length;a++){const r=localStorage.key(a);if(r!=="isEditingMode"&&r!=="currentPage")try{u[r]=JSON.parse(localStorage.getItem(r))}catch{}}if(Object.keys(u).length===0){l("Brak zmian do zapisania","yellow"),this.isAuthorizing=!1;return}const z=JSON.stringify(u),g=new Blob([z],{type:"application/json"}),n=new FileReader,w=await new Promise((a,r)=>{n.onloadend=()=>a(n.result.toString().split(",")[1]),n.onerror=r,n.readAsDataURL(g)}),p=await fetch("https://mc.kot.li/?key=shiftData.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"shiftData",value:w})});if(!p.ok)throw new Error(`Server error: ${p.status}`);l("Zmiany zapisano pomyślnie!","green"),this.$emit("authorized"),this.closeModal()}catch{l("Nie udało się zaktualizować danych","red")}finally{this.isAuthorizing=!1}}},closeModal(){this.password="",this.$emit("close")},cancel(){this.isAuthorizing||this.closeModal()}},mounted(){this.$nextTick(()=>{this.$refs.passwordInput?.focus()})}},N={key:0,class:"modal"},B={class:"modal-content"},M={class:"input-container"},x={class:"button-container"},K=["disabled"],P={key:0,class:"spinner"},C=["disabled"];function E(d,t,c,h,e,i){return c.show?(m(),f("section",N,[s("div",B,[t[4]||(t[4]=s("h3",null,"Autoryzacja",-1)),t[5]||(t[5]=s("p",null,"Wpisz hasło aby zapisać zmiany:",-1)),s("div",M,[A(s("input",{type:"password","onUpdate:modelValue":t[0]||(t[0]=o=>e.password=o),onKeyup:t[1]||(t[1]=S((...o)=>i.authorize&&i.authorize(...o),["enter"])),placeholder:"Hasło...",autocomplete:"current-password",ref:"passwordInput"},null,544),[[v,e.password]])]),s("div",x,[s("button",{class:"primary-button",onClick:t[2]||(t[2]=(...o)=>i.authorize&&i.authorize(...o)),disabled:e.isAuthorizing},[s("span",null,j(e.isAuthorizing?"Weryfikacja...":"Zapisz"),1),e.isAuthorizing?(m(),f("span",P)):y("",!0)],8,K),s("button",{class:"secondary-button",onClick:t[3]||(t[3]=(...o)=>i.cancel&&i.cancel(...o)),disabled:e.isAuthorizing}," Anuluj ",8,C)])])])):y("",!0)}const J=k(D,[["render",E],["__scopeId","data-v-0a83cf0e"]]);export{J as default};
