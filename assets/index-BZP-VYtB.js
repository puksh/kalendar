const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-rgIH9GXZ.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/SideBarComponent-BUwlEePi.js","assets/utils-oZnrSTRW.js","assets/vue-vendor-DIMlJxEK.js","assets/utils-BWm1wYfN.css","assets/SideBarComponent-DPivk8FM.css","assets/MonthSelector-CW3Af4jJ.js","assets/MonthSelector-D1d4bCS0.css","assets/PeopleListWindow-uaTjbsze.js","assets/PeopleListWindow-BxO8ts3g.css","assets/ShiftCountWindow-CplICI6j.js","assets/ShiftCountWindow-9v8bD_ak.css","assets/AuthorizationModal-D2GvdeK6.js","assets/AuthorizationModal-bqQnogzt.css","assets/CalendarComponent-Dabm8T3B.js","assets/daysOfWeek-C19XqJ9X.js","assets/CalendarComponent-CVYdDUuQ.css","assets/ExcelComponent-CdBjFd-8.js","assets/ExcelComponent-B3XO2vrp.css"])))=>i.map(i=>d[i]);
import{c as w,o as g,d as i,e as x,n as T,f as A,w as B,t as _,F,a as W,g as z,h as E,i as L,j as b,k as j,l as O,m as V,v as U,b as I,p as Y,q as Z}from"./vue-vendor-DIMlJxEK.js";import{_ as N,a as C,c as q}from"./utils-oZnrSTRW.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const K="modulepreload",J=function(o){return"/"+o},H={},v=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let a=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=l?.nonce||l?.getAttribute("nonce");s=a(t.map(c=>{if(c=J(c),c in H)return;H[c]=!0;const f=c.endsWith(".css"),y=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${y}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":K,f||(m.as="script"),m.crossOrigin="",m.href=c,h&&m.setAttribute("nonce",h),document.head.appendChild(m),f)return new Promise((D,d)=>{m.addEventListener("load",D),m.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&n(l.reason);return e().catch(n)})},G={name:"PencilIcon",props:{isEditing:{type:Boolean,required:!0}}},X=["aria-checked"],Q={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",class:"pencil-icon"},$={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",class:"pencil-icon"};function ee(o,e,t,r,s,n){return g(),w("span",{class:"slider",role:"switch","aria-checked":t.isEditing},[t.isEditing?(g(),w("svg",$,e[1]||(e[1]=[i("path",{d:"M12 20h9"},null,-1),i("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"},null,-1)]))):(g(),w("svg",Q,e[0]||(e[0]=[i("path",{d:"M12 20h9"},null,-1),i("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"},null,-1)])))],8,X)}const te=N(G,[["render",ee]]),oe={},ne={class:"refresh-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"};function se(o,e){return g(),w("svg",ne,e[0]||(e[0]=[i("path",{d:"M23 4v6h-6"},null,-1),i("path",{d:"M1 20v-6h6"},null,-1),i("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10"},null,-1),i("path",{d:"M20.49 15a9 9 0 0 1-14.85 3.36L1 14"},null,-1)]))}const ae=N(oe,[["render",se],["__scopeId","data-v-11885e2d"]]);function re(o){const e=[{date:new Date(o,0,1),name:"Nowy Rok"},{date:new Date(o,0,6),name:"Święto Trzech Króli"},{date:new Date(o,4,1),name:"Święto Pracy"},{date:new Date(o,4,3),name:"Święto Konstytucji 3 Maja"},{date:new Date(o,7,15),name:"Wniebowzięcie Najświętszej Maryi Panny"},{date:new Date(o,10,1),name:"Wszystkich Świętych"},{date:new Date(o,10,11),name:"Święto Niepodległości"},{date:new Date(o,11,25),name:"Boże Narodzenie (pierwszy dzień)"},{date:new Date(o,11,26),name:"Boże Narodzenie (drugi dzień)"}],t=ie(o);e.push({date:t,name:"Wielkanoc"});const r=new Date(t);r.setDate(t.getDate()+1),e.push({date:r,name:"Poniedziałek Wielkanocny"});const s=new Date(t);s.setDate(t.getDate()+49),e.push({date:s,name:"Zielone Świątki"});const n=new Date(t);return n.setDate(t.getDate()+60),e.push({date:n,name:"Boże Ciało"}),e}function ie(o){const e=o%19,t=Math.floor(o/100),r=o%100,s=Math.floor(t/4),n=t%4,a=Math.floor((t+8)/25),l=Math.floor((t-a+1)/3),h=(19*e+t-s-l+15)%30,c=Math.floor(r/4),f=r%4,y=(32+2*n+2*c-h-f)%7,m=Math.floor((e+11*h+22*y)/451),D=Math.floor((h+y-7*m+114)/31)-1,d=(h+y-7*m+114)%31+1;return new Date(o,D,d)}function S(o){const e=re(o.getFullYear());for(const t of e)if(t.date.getDate()===o.getDate()&&t.date.getMonth()===o.getMonth()&&t.date.getFullYear()===o.getFullYear())return{isHoliday:!0,name:t.name};return{isHoliday:!1}}const le={name:"ButtonExport",props:{people:{type:Array,required:!0},monthDays:{type:Array,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},currentPage:{type:String,default:"ExcelComponent"}},data(){return{showExportMenu:!1}},mounted(){document.addEventListener("click",this.handleOutsideClick)},beforeUnmount(){document.removeEventListener("click",this.handleOutsideClick)},methods:{toggleExportMenu(o){o.stopPropagation(),this.showExportMenu=!this.showExportMenu},handleOutsideClick(o){this.showExportMenu&&!o.target.closest(".export-container")&&(this.showExportMenu=!1)},getMonthName(){return["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"][this.selectedMonth]},getFilename(o){return`Harmonogram_${this.getMonthName()}_${this.selectedYear}.${o}`},exportToCsv(){let o="\uFEFF";o+="Imię";for(let t=1;t<=this.getDaysInMonth();t++)o+=`;${t}`;o+=`\r
`;for(const t of this.people){o+=`"${t.name}"`;for(let r=1;r<=this.getDaysInMonth();r++)o+=`;${this.getFormattedShift(t.id,r," ")||""}`;o+=`\r
`}const e=new Blob([o],{type:"text/csv;charset=utf-8"});this.downloadFile(e,this.getFilename("csv")),this.showExportMenu=!1},async exportToPdf(){try{const{jsPDF:o}=await v(async()=>{const{jsPDF:d}=await import("./jspdf.es.min-MyVm9cRn.js").then(p=>p.j);return{jsPDF:d}},[]),{autoTable:e}=await v(async()=>{const{autoTable:d}=await import("./jspdf.plugin.autotable-BgrBGiiK.js");return{autoTable:d}},[]),t=new o({orientation:"landscape",unit:"mm",format:"a4"});try{const d=await fetch("/assets/fonts/IBMPlexMono-Regular.ttf");if(!d.ok)throw new Error("Font file not found");const p=await d.arrayBuffer();t.addFileToVFS("IBMPlexMono-Regular.ttf",this.arrayBufferToBase64(p)),t.addFont("IBMPlexMono-Regular.ttf","IBMPlexMono","normal"),t.setFont("IBMPlexMono")}catch(d){console.warn("Could not load local font, using fallback",d),t.setFont("helvetica")}let r=t.internal.pageSize.getWidth();t.setFontSize(16),t.setTextColor(0,0,0);const s="IZBA PRZYJĘĆ DZIECIĘCA",n=t.getStringUnitWidth(s)*t.getFontSize()/t.internal.scaleFactor;t.text(s,(r-n)/2,15);const l="ROZKŁAD PRACY PRACOWNIKÓW KONTRAKTOWYCH - {0} {1}r.".replace("{0}",this.getMonthName()).replace("{1}",this.selectedYear),h=t.getStringUnitWidth(l)*t.getFontSize()/t.internal.scaleFactor;t.text(l,(r-h)/2,22);const c=["Imię"];for(let d=1;d<=this.getDaysInMonth();d++)c.push(d.toString());const f=this.people.map(d=>{const p=[d.name];for(let u=1;u<=this.getDaysInMonth();u++){const M=this.getFormattedShift(d.id,u,`
`);p.push(M||"")}return p});e(t,{head:[c],body:f,startY:30,theme:"grid",margin:{left:8},styles:{fontSize:8,cellPadding:3,font:"IBMPlexMono",fontStyle:"normal",lineWidth:.3,minCellHeight:8,halign:"center",cellWidth:"wrap",overflow:"linebreak"},columnStyles:{0:{cellWidth:24}},headStyles:{fillColor:[0,62,62],textColor:[255,255,255],fontSize:6},didParseCell:function(d){try{if(d.section==="head"&&d.row.index===0&&d.column.index>0){const p=parseInt(d.cell.raw.toString());if(!isNaN(p)){const u=new Date(this.selectedYear,this.selectedMonth,p),M=u.getDay(),k=M===6,P=M===0;S(u).isHoliday?(d.cell.styles.fillColor=[255,255,255],d.cell.styles.textColor=[204,0,0]):k?(d.cell.styles.fillColor=[0,153,0],d.cell.styles.textColor=[255,255,255]):P&&(d.cell.styles.fillColor=[204,0,0],d.cell.styles.textColor=[255,255,255])}}else if(d.section==="body"&&(d.row.index%2===1?d.cell.styles.fillColor=[240,240,240]:d.cell.styles.fillColor=[255,255,255],d.column.index>0)){const p=parseInt(d.cell.raw.toString());if(!isNaN(p)){const u=new Date(this.selectedYear,this.selectedMonth,p),M=u.getDay(),k=M===6,P=M===0;S(u).isHoliday?d.cell.styles.fillColor=[255,238,238]:(k||P)&&(d.cell.styles.fillColor=[235,235,235])}}}catch(p){console.error("Error in didParseCell:",p)}}.bind(this),didDrawCell:function(d){try{if(d.section==="head"&&d.row.index===0&&d.column.index>0){const p=parseInt(d.cell.raw.toString());if(!isNaN(p)){const u=new Date(this.selectedYear,this.selectedMonth,p);if(S(u).isHoliday){const{x:k,y:P,width:R}=d.cell;t.setFontSize(6),t.setTextColor(204,0,0),t.text("*",k+R-3,P+3),t.setFontSize(8),t.setTextColor(0,0,0)}}}}catch(p){console.error("Error in didDrawCell:",p)}}.bind(this)});const m=(t.lastAutoTable.finalY||150)+10;t.setFontSize(10),t.setTextColor(0,0,0),t.text("Legenda:",14,m),t.text("D  - Dzienna 07:00-19:00",14,m+6),t.text("N  - Nocna   19:00-07:00",14,m+12),t.text("DN - Doba    07:00-07:00",14,m+18);const D=[];for(let d=1;d<=this.getDaysInMonth();d++){const p=new Date(this.selectedYear,this.selectedMonth,d),u=S(p);u.isHoliday&&D.push({date:p,name:u.name})}D.length!=0&&(t.text("Święta w tym miesiącu:",14,m+28),D.forEach((d,p)=>{t.text(`${d.date.getDate()} - ${d.name}`,14,m+34+p*6)})),t.save(this.getFilename("pdf")),this.showExportMenu=!1,C("Harmonogram zapisany jako PDF","green")}catch(o){console.error("Error exporting PDF:",o),C("Błąd podczas eksportu do PDF","red")}},async exportToExcel(){try{const o=await v(()=>import("./exceljs.min-rgIH9GXZ.js").then(l=>l.e),__vite__mapDeps([0,1])),e=new o.Workbook,t=e.addWorksheet(`${this.getMonthName()} ${this.selectedYear}`),r=["Imię"];for(let l=1;l<=this.getDaysInMonth();l++)r.push(l.toString());t.addRow(r);const s=t.getRow(1).eachCell(l=>{l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"003E3E"}},l.font={color:{argb:"FFFFFF"},bold:!0},l.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});this.people.forEach((l,h)=>{const c=[l.name];for(let y=1;y<=this.getDaysInMonth();y++)c.push(this.getFormattedShift(l.id,y," "));t.addRow(c);const f=h+2;f%2===0&&t.getRow(f).eachCell(y=>{y.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F0F0F0"}}})});for(let l=1;l<=this.getDaysInMonth();l++){const h=new Date(this.selectedYear,this.selectedMonth,l),{isHoliday:c,name:f}=S(h),y=h.getDay(),m=y===6,D=y===0;if(m||D||c){const p=this.getExcelColumnLetter(l+1);for(let M=2;M<=this.people.length+1;M++){const k=t.getCell(`${p}${M}`);k.fill={type:"pattern",pattern:"solid",fgColor:{argb:c?"FFEEEE":"EEEEEE"}}}const u=t.getCell(`${p}1`);if(c){u.note=f;const M=u.value?.toString()||"";u.value=M+"★",u.font={color:{argb:"FFCC0000"},bold:!0}}else m?(u.fill={type:"pattern",pattern:"solid",fgColor:{argb:"009900"}},u.font={color:{argb:"FFFFFF"},bold:!0}):D&&(u.fill={type:"pattern",pattern:"solid",fgColor:{argb:"CC0000"}},u.font={color:{argb:"FFFFFF"},bold:!0})}}t.columns.forEach(l=>{l.width=12}),t.getColumn(1).width=20,t.getColumn(1).alignment={horizontal:"left"};const n=await e.xlsx.writeBuffer(),a=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});this.downloadFile(a,this.getFilename("xlsx")),this.showExportMenu=!1,C("Harmonogram zapisany jako Excel","green")}catch(o){console.error("Error exporting Excel:",o),C("Błąd podczas eksportu do Excel","red")}},downloadFile(o,e){const t=document.createElement("a"),r=URL.createObjectURL(o);t.setAttribute("href",r),t.setAttribute("download",e),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r)},getDaysInMonth(){return new Date(this.selectedYear,this.selectedMonth+1,0).getDate()},getFormattedShift(o,e,t=`
`){const s=new Date(this.selectedYear,this.selectedMonth,e).toDateString(),n=localStorage.getItem(s);if(n){const a=JSON.parse(n),l=[];return(a.dayShift1===o||a.dayShift2===o)&&l.push("D"),(a.nightShift1===o||a.nightShift2===o)&&l.push("N"),l.join(t)}return""},isWeekendOrHoliday(o){const e=new Date(this.selectedYear,this.selectedMonth,o),t=e.getDay();if(t===0||t===6)return!0;const{isHoliday:r}=S(e);return r},getWeekendColumnStyles(){const o={};for(let e=1;e<=this.getDaysInMonth();e++)this.isWeekendOrHoliday(e)&&(o[e]={fillColor:[235,235,235]});return o},getExcelColumnLetter(o){let e=o,t="",r;for(;e>0;)r=(e-1)%26,t=String.fromCharCode(65+r)+t,e=Math.floor((e-r)/26);return t},arrayBufferToBase64(o){let e="";const t=new Uint8Array(o);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return window.btoa(e)}}},de={class:"export-container"};function ce(o,e,t,r,s,n){return g(),w("div",de,[i("button",{class:T(["export-button top-right-buttons",{"excel-position":t.currentPage==="ExcelComponent","calendar-position":t.currentPage==="CalendarComponent"}]),onClick:e[0]||(e[0]=(...a)=>n.toggleExportMenu&&n.toggleExportMenu(...a)),title:"Eksportuj harmonogram","aria-label":"Eksportuj harmonogram"},e[4]||(e[4]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"export-icon"},[i("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),i("polyline",{points:"7 10 12 15 17 10"}),i("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)]),2),s.showExportMenu?(g(),w("div",{key:0,class:T(["export-menu",{"excel-position":t.currentPage==="ExcelComponent","calendar-position":t.currentPage==="CalendarComponent"}])},[i("button",{onClick:e[1]||(e[1]=(...a)=>n.exportToCsv&&n.exportToCsv(...a)),class:"export-option"},e[5]||(e[5]=[A('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-e24a7f24><path d="M14 3v4a1 1 0 0 0 1 1h4" data-v-e24a7f24></path><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z" data-v-e24a7f24></path><path d="M9 17h6" data-v-e24a7f24></path><path d="M9 13h6" data-v-e24a7f24></path></svg><span data-v-e24a7f24>CSV</span>',2)])),i("button",{onClick:e[2]||(e[2]=(...a)=>n.exportToExcel&&n.exportToExcel(...a)),class:"export-option"},e[6]||(e[6]=[A('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="lightgreen" stroke-width="2" data-v-e24a7f24><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-e24a7f24></path><polyline points="14 2 14 8 20 8" data-v-e24a7f24></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-e24a7f24></line><line x1="16" y1="17" x2="8" y2="17" data-v-e24a7f24></line><polyline points="10 9 9 9 8 9" data-v-e24a7f24></polyline></svg><span data-v-e24a7f24>Excel (XLSX)</span>',2)])),i("button",{onClick:e[3]||(e[3]=(...a)=>n.exportToPdf&&n.exportToPdf(...a)),class:"export-option"},e[7]||(e[7]=[A('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="pink" stroke-width="2" data-v-e24a7f24><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-e24a7f24></path><polyline points="14 2 14 8 20 8" data-v-e24a7f24></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-e24a7f24></line><line x1="16" y1="17" x2="8" y2="17" data-v-e24a7f24></line><polyline points="10 9 9 9 8 9" data-v-e24a7f24></polyline></svg><span data-v-e24a7f24>PDF</span>',2)]))],2)):x("",!0)])}const he=N(le,[["render",ce],["__scopeId","data-v-e24a7f24"]]),pe={name:"ButtonImport",props:{isEditingMode:{type:Boolean,required:!0},people:{type:Array,required:!0},monthDays:{type:Array,required:!0}},emits:["has-changes","cells-imported"],data(){return{showModal:!1,pastedData:"",parsedData:[],daysMismatch:!1,importedCells:new Set,isDragging:!1}},computed:{daysInMonth(){return this.monthDays.length}},mounted(){this.$nextTick(()=>{this.$refs.dropZone&&this.$refs.dropZone.focus()}),window.addEventListener("paste",this.handleGlobalPaste)},beforeUnmount(){window.removeEventListener("paste",this.handleGlobalPaste)},methods:{showImportModal(){this.showModal=!0,this.resetImport(),this.$nextTick(()=>{this.$refs.dropZone&&this.$refs.dropZone.focus()})},closeImportModal(){this.showModal=!1},resetImport(){this.pastedData="",this.parsedData=[],this.importedCells.clear()},triggerFileInput(){this.$refs.fileInput&&this.$refs.fileInput.click()},onDragOver(o){this.isDragging=!0,o.dataTransfer.dropEffect="copy"},onDragLeave(){this.isDragging=!1},onDrop(o){this.isDragging=!1;const e=o.dataTransfer.files;if(e.length>0)this.handleFileData(e[0]);else{const t=o.dataTransfer.getData("text/html");if(t)this.processHtmlTable(t);else{const r=o.dataTransfer.getData("text/plain");r&&(this.pastedData=r,this.parseImportedData())}}},onPaste(o){const e=o.clipboardData||window.clipboardData,t=e.getData("text/html");if(t){this.processHtmlTable(t);return}const r=e.getData("text/plain");r&&(this.pastedData=r,this.parseImportedData())},handleGlobalPaste(o){this.showModal&&this.onPaste(o)},processHtmlTable(o){try{const r=new DOMParser().parseFromString(o,"text/html").querySelectorAll("table");if(r.length>0){const n=r[0].querySelectorAll("tr");let a="";n.forEach(l=>{const h=l.querySelectorAll("th, td"),c=Array.from(h).map(f=>f.textContent.trim());a+=c.join("	")+`
`}),this.pastedData=a,this.parseImportedData()}}catch(e){console.error("Error processing HTML table:",e),C("Nie udało się przetworzyć tabeli.","red")}},handleFileUpload(o){const e=o.target.files[0];e&&this.handleFileData(e)},handleFileData(o){o.type==="text/csv"||o.name.endsWith(".csv")?this.parseCSVFile(o):o.type.includes("spreadsheetml")||o.name.endsWith(".xlsx")||o.name.endsWith(".xls")?this.parseExcelFile(o):C("Nie wspierany format pliku. Proszę użyć pliku CSV lub Excela.","red")},parseCSVFile(o){const e=new FileReader;e.onload=t=>{this.pastedData=t.target.result,this.parseImportedData()},e.readAsText(o)},async parseExcelFile(o){try{const e=await v(()=>import("./exceljs.min-rgIH9GXZ.js").then(s=>s.e),__vite__mapDeps([0,1])),t=new e.Workbook,r=new FileReader;r.onload=async s=>{const n=s.target.result;await t.xlsx.load(n);const a=t.getWorksheet(1);let l="";a.eachRow((h,c)=>{const f=h.values.slice(1);l+=f.join(",")+`
`}),this.pastedData=l,this.parseImportedData()},r.readAsArrayBuffer(o)}catch(e){console.error("Error parsing Excel file:",e),C("Nie udało się przetworzyć pliku Excela.","red")}},parseImportedData(){if(!this.pastedData.trim()){this.parsedData=[];return}try{const o=this.pastedData.trim().split(/\r?\n/).filter(n=>n.trim());if(o.length<2){C("Zły format danych. Musi zawierać wiersz z dniami i kolumnę z członkami zespołu.","orange");return}const e=n=>{const a=[];let l="",h=!1;for(let c=0;c<n.length;c++){const f=n[c];f==='"'?h&&c<n.length-1&&n[c+1]==='"'?(l+='"',c++):h=!h:(f===","||f==="	"||f===";")&&!h?(a.push(l.trim()),l=""):l+=f}return a.push(l.trim()),a},t=o.map(e),r=t[0].slice(1),s=t.slice(1);this.parsedData=s.map(n=>{const a=n[0].replace(/^"(.*)"$/,"$1"),l=n.slice(1).map(h=>{const c=h.replace(/^"(.*)"$/,"$1").toUpperCase().trim();return["D","N","D N","DN"].includes(c)?c==="DN"?"D N":c:""});return{name:a,shifts:l}}),this.parsedData=this.parsedData.filter(n=>n.name),this.daysMismatch=r.length!==this.monthDays.length}catch(o){console.error("Error parsing imported data:",o),C("Nie udało się przetworzyć danych. Proszę sprawdzić format.","red"),this.parsedData=[]}},confirmImport(){if(!this.parsedData.length)return;const o=new Set;this.parsedData.forEach(e=>{const t=this.people.find(r=>r.name.toLowerCase()===e.name.toLowerCase());if(!t){C(`Nie znaleziono osoby o nazwie: ${e.name}`,"orange");return}e.shifts.forEach((r,s)=>{if(s<this.monthDays.length){const n=this.monthDays[s],a=n.date.toDateString();r&&(n.dayShift1===t.id&&(n.dayShift1=null),n.dayShift2===t.id&&(n.dayShift2=null),n.nightShift1===t.id&&(n.nightShift1=null),n.nightShift2===t.id&&(n.nightShift2=null),r.includes("D")&&(n.dayShift1?n.dayShift2||(n.dayShift2=t.id,n.dayShift2Name=t.name):(n.dayShift1=t.id,n.dayShift1Name=t.name)),r.includes("N")&&(n.nightShift1?n.nightShift2||(n.nightShift2=t.id,n.nightShift2Name=t.name):(n.nightShift1=t.id,n.nightShift1Name=t.name)),o.add(a),this.importedCells.add(`${t.id}-${n.date.getDate()}`))}})}),o.forEach(e=>{const t=this.monthDays.find(r=>r.date.toDateString()===e);if(t){const r={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2};localStorage.setItem(e,JSON.stringify(r))}}),this.closeImportModal(),C("Import zakończony sukcesem.","green"),this.$emit("has-changes",!0),this.$emit("cells-imported",Array.from(this.importedCells))}}},ue=["disabled"],fe={key:0,class:"import-modal"},me={class:"import-modal-content"},ge={class:"import-modal-header"},ye={class:"import-content"},we={key:0,class:"drop-zone-placeholder"},Ce={key:0,class:"preview-section"},Me={key:0,class:"warning-message"},De={class:"preview-table-container"},ve={class:"preview-table"},Ee={class:"controls"},xe={class:"modal-footer"},be=["disabled"];function ke(o,e,t,r,s,n){return g(),w(F,null,[i("button",{class:"top-right-buttons import-button",onClick:e[0]||(e[0]=(...a)=>n.showImportModal&&n.showImportModal(...a)),disabled:!t.isEditingMode,title:"Importuj dane do CSV lub Excel","aria-label":"Importuj dane do CSV lub Excel"},e[11]||(e[11]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"22",height:"22",fill:"none",stroke:"currentColor","stroke-width":"2"},[i("path",{d:"M3 14v5a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-5M12 3v12M7 8l5-5 5 5"})],-1)]),8,ue),s.showModal?(g(),w("div",fe,[i("div",me,[i("div",ge,[e[12]||(e[12]=i("h3",null,"Importowanie Danych",-1)),i("button",{class:"close-button",onClick:e[1]||(e[1]=(...a)=>n.closeImportModal&&n.closeImportModal(...a))},"×")]),i("div",ye,[i("div",{class:T(["drop-zone",{"drag-active":s.isDragging,"has-data":s.parsedData.length>0}]),onDragover:e[3]||(e[3]=B((...a)=>n.onDragOver&&n.onDragOver(...a),["prevent"])),onDragleave:e[4]||(e[4]=B((...a)=>n.onDragLeave&&n.onDragLeave(...a),["prevent"])),onDrop:e[5]||(e[5]=B((...a)=>n.onDrop&&n.onDrop(...a),["prevent"])),onPaste:e[6]||(e[6]=(...a)=>n.onPaste&&n.onPaste(...a)),onClick:e[7]||(e[7]=(...a)=>n.triggerFileInput&&n.triggerFileInput(...a)),tabindex:"0",ref:"dropZone"},[s.parsedData.length===0?(g(),w("div",we,e[13]||(e[13]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"gray","stroke-width":"2"},[i("path",{d:"M19 13v6a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-6M12 3v12M8 7l4-4 4 4"})],-1),i("p",null," Przeciągnij i upuść plik, wklej ze schowka, bądź kliknij aby wybrać plik ",-1),i("p",{class:"sub-text"}," Wspierane formaty: CSV, Excel ( xlsx, xls ) albo tabela ",-1)]))):x("",!0),i("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:e[2]||(e[2]=(...a)=>n.handleFileUpload&&n.handleFileUpload(...a)),accept:".csv,.xlsx,.xls"},null,544)],34),s.parsedData.length>0?(g(),w("div",Ce,[e[15]||(e[15]=i("h4",null,"Podgląd importowanego miesiąca",-1)),s.daysMismatch?(g(),w("div",Me," Uwaga: Importowany miesiąc ma "+_(s.parsedData[0].shifts.length)+" dni, a obecnie wybrany ma "+_(n.daysInMonth)+" dni. ",1)):x("",!0),i("div",De,[i("table",ve,[i("thead",null,[i("tr",null,[e[14]||(e[14]=i("th",null,null,-1)),(g(!0),w(F,null,W(s.parsedData[0].shifts,(a,l)=>(g(),w("th",{key:`header-${l}`},_(l+1),1))),128))])]),i("tbody",null,[(g(!0),w(F,null,W(s.parsedData,(a,l)=>(g(),w("tr",{key:`row-${l}`},[i("td",null,_(a.name),1),(g(!0),w(F,null,W(a.shifts,(h,c)=>(g(),w("td",{key:`cell-${l}-${c}`,class:"imported-shift"},_(h),1))),128))]))),128))])])]),i("div",Ee,[i("button",{class:"reset-button",onClick:e[8]||(e[8]=(...a)=>n.resetImport&&n.resetImport(...a))},"Reset")])])):x("",!0),i("div",xe,[i("button",{class:"cancel-button",onClick:e[9]||(e[9]=(...a)=>n.closeImportModal&&n.closeImportModal(...a))}," Anuluj "),i("button",{class:"import-confirm-button",onClick:e[10]||(e[10]=(...a)=>n.confirmImport&&n.confirmImport(...a)),disabled:!s.parsedData.length}," Importuj ",8,be)])])])])):x("",!0)],64)}const Se=N(pe,[["render",ke],["__scopeId","data-v-6c514bdd"]]),Pe={name:"VueCalendar",components:{SideBarComponent:z(()=>v(()=>import("./SideBarComponent-BUwlEePi.js"),__vite__mapDeps([2,3,4,5,6]))),MonthSelector:z(()=>v(()=>import("./MonthSelector-CW3Af4jJ.js"),__vite__mapDeps([7,3,4,5,8]))),PeopleListWindow:z(()=>v(()=>import("./PeopleListWindow-uaTjbsze.js"),__vite__mapDeps([9,3,4,5,10]))),ShiftCountWindow:z(()=>v(()=>import("./ShiftCountWindow-CplICI6j.js"),__vite__mapDeps([11,3,4,5,12]))),NotificationMessage:z(()=>v(()=>import("./utils-oZnrSTRW.js").then(o=>o.b),__vite__mapDeps([3,4,5]))),RefreshIcon:ae,ButtonExport:he,ButtonImport:Se,PencilIcon:te},data(){return{isLoading:!1,isEditingMode:this.safeGetFromStorage("isEditingMode",!1),selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),locale:"pl",hasUnsavedChanges:!1,showPasswordModal:!1,localData:{},people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0}],monthDays:[],isRefreshing:!1,AuthorizationModal:null,CalendarComponent:null,ExcelComponent:null,currentPage:this.safeGetFromStorage("currentPage","ExcelComponent")}},computed:{canSave(){return this.hasUnsavedChanges},peopleListEditingMode(){return this.currentPage==="CalendarComponent"&&this.isEditingMode},activeComponentRef(){return this.currentPage==="CalendarComponent"?this.$refs.calendarComponent:this.$refs.excelComponent}},methods:{showPasswordPrompt(){if(this.AuthorizationModal){this.showPasswordModal=!0;return}v(()=>import("./AuthorizationModal-D2GvdeK6.js"),__vite__mapDeps([13,3,4,5,14])).then(o=>{this.AuthorizationModal=Y(o.default),this.showPasswordModal=!0})},handleAuthorization(){this.showPasswordModal=!1,this.hasUnsavedChanges=!1,this.activeComponentRef?.handleChangesSaved()},loadPageComponent(o){const t={CalendarComponent:()=>v(()=>import("./CalendarComponent-Dabm8T3B.js"),__vite__mapDeps([15,16,3,4,5,17])),ExcelComponent:()=>v(()=>import("./ExcelComponent-CdBjFd-8.js"),__vite__mapDeps([18,16,3,4,5,19]))}[o];return!t||this[o]?Promise.resolve():(this.isLoading=!0,t().then(r=>{this[o]=Y(r.default)}).finally(()=>{this.isLoading=!1}))},handleNavigation(o){this.hasUnsavedChanges&&!confirm("Masz niezapisane zmiany. Czy na pewno chcesz zmienić widok?")||(localStorage.setItem("currentPage",o),this.loadPageComponent(o).then(()=>{this.currentPage=o,this.hasUnsavedChanges=!1}))},handleMonthChange(o){const e=new Date(this.selectedYear,this.selectedMonth,1);e.setMonth(e.getMonth()+o),this.selectedMonth=e.getMonth(),this.selectedYear=e.getFullYear()},discardChanges(){this.hasUnsavedChanges=!1,this.checkShiftDataSync()},generateCurrentView(){this.currentPage==="CalendarComponent"&&this.$refs.calendarComponent&&this.$refs.calendarComponent.generateMonthDays()},async checkShiftDataSync(){const o=new Error("Sync timeout");this.isRefreshing=!0;try{await Promise.race([q(()=>this.activeComponentRef?.generateMonthDays()),new Promise((e,t)=>setTimeout(()=>t(o),5e3))]),this.hasUnsavedChanges=!1}catch(e){console.error(e),C(`Błąd podczas odświeżania: ${e.message}`,"red")}finally{setTimeout(()=>this.isRefreshing=!1,800)}},updateEditingMode(o){this.isEditingMode=o,localStorage.setItem("isEditingMode",JSON.stringify(o))},updateUnsavedChanges(o){this.hasUnsavedChanges=o},emitEditingMode(o){this.updateEditingMode(o)},enableEditingMode(){this.isEditingMode=!0},updateMonthDays(o){this.monthDays=o},globalErrorHandler(){this.isRefreshing=!1,this.currentPage==="ExcelComponent"&&!this.$refs.excelComponent&&this.handleNavigation("ExcelComponent"),this.isLoading=!1},safeGetFromStorage(o,e){try{const t=localStorage.getItem(o);return t!==null?JSON.parse(t):e}catch(t){return console.warn(`Error reading ${o} from localStorage:`,t),e}},handleImportedCells(o){if(!this.ExcelComponent){console.error("ExcelComponent is not loaded yet.");return}this.$refs.excelComponent.importedCells=new Set(o)}},async mounted(){try{this.isRefreshing=!1,await this.loadPageComponent("ExcelComponent").catch(e=>{console.error("Failed to load Excel component:",e),C("Błąd ładowania Tabeli","red")}),localStorage.getItem("currentPage")==="CalendarComponent"&&await this.loadPageComponent("CalendarComponent").catch(e=>{console.error("Failed to load Calendar component:",e),C("Błąd ładowania Kalendarza","red"),this.currentPage="ExcelComponent",localStorage.setItem("currentPage","ExcelComponent")}),this.discardChanges(),this.hasUnsavedChanges=!1}catch(o){console.error("Error during application initialization:",o),C("Błąd inicjalizacji aplikacji","red")}["error","unhandledrejection"].forEach(o=>window.addEventListener(o,()=>this.globalErrorHandler()))}},_e={class:"app-container"},ze=["disabled"],Ie={class:"top-right-buttons-container"},Fe={class:"top-right-buttons compact-toggle",title:"Przełącz tryb edytowania"},Ne=["checked"],Le={class:"main-content"},Te={key:0,class:"refresh-overlay"},Re={class:"editing-mode-container"},Ae={class:"editing-mode-label"},Be={class:"editing-mode-label"};function We(o,e,t,r,s,n){const a=E("SideBarComponent"),l=E("MonthSelector"),h=E("refresh-icon"),c=E("PencilIcon"),f=E("ButtonExport"),y=E("ButtonImport"),m=E("RefreshIcon"),D=E("PeopleListWindow"),d=E("ShiftCountWindow"),p=E("NotificationMessage");return g(),w(F,null,[i("div",_e,[s.AuthorizationModal&&s.showPasswordModal?(g(),L(j(s.AuthorizationModal),{key:0,show:s.showPasswordModal,onClose:e[0]||(e[0]=u=>s.showPasswordModal=!1),onAuthorized:n.handleAuthorization,"aria-label":"Zapisz zmiany",title:"Zapisz zmiany w harmonogramie",mode:"save"},null,40,["show","onAuthorized"])):x("",!0),i("button",{disabled:!n.canSave,onClick:e[1]||(e[1]=(...u)=>n.showPasswordPrompt&&n.showPasswordPrompt(...u)),class:"submit-button","aria-label":"Zapisz zmiany",title:"Zapisz zmiany w harmonogramie"}," Zapisz ",8,ze),b(a,{currentComponent:s.currentPage,onNavigate:n.handleNavigation},null,8,["currentComponent","onNavigate"]),b(l,{currentMonth:s.selectedMonth,currentYear:s.selectedYear,locale:s.locale,hasUnsavedChanges:s.hasUnsavedChanges,onChangeMonth:n.handleMonthChange,onDiscardChanges:n.discardChanges},null,8,["currentMonth","currentYear","locale","hasUnsavedChanges","onChangeMonth","onDiscardChanges"]),i("section",Ie,[i("button",{class:"top-right-buttons buttonRefresh",onClick:e[2]||(e[2]=u=>n.checkShiftDataSync()),"aria-label":"Odśwież harmonogram",title:"Odśwież harmonogram"},[b(h,{class:T({refreshing:s.isRefreshing})},null,8,["class"])]),i("label",Fe,[i("input",{type:"checkbox",checked:s.isEditingMode,onChange:e[3]||(e[3]=u=>n.emitEditingMode(u.target.checked)),"aria-label":"Przełącz tryb edytowania"},null,40,Ne),b(c,{isEditing:s.isEditingMode},null,8,["isEditing"])]),b(f,{people:s.people,monthDays:s.monthDays,selectedMonth:s.selectedMonth,selectedYear:s.selectedYear,currentPage:s.currentPage},null,8,["people","monthDays","selectedMonth","selectedYear","currentPage"]),b(y,{isEditingMode:s.isEditingMode,people:s.people,monthDays:s.monthDays,onHasChanges:n.updateUnsavedChanges,onCellsImported:n.handleImportedCells},null,8,["isEditingMode","people","monthDays","onHasChanges","onCellsImported"])]),i("main",Le,[s.isRefreshing?(g(),w("div",Te,[b(m,{class:"centered-refresh-icon refreshing"})])):x("",!0),i("div",{style:V({opacity:s.isRefreshing?"0.5":"1"})},[s.currentPage==="CalendarComponent"?(g(),L(j(s.CalendarComponent),{key:0,ref:"calendarComponent",isEditingMode:s.isEditingMode,selectedMonth:s.selectedMonth,selectedYear:s.selectedYear,people:s.people,onUpdateEditingMode:n.updateEditingMode,onHasChanges:n.updateUnsavedChanges,onMonthDaysUpdated:n.updateMonthDays},null,40,["isEditingMode","selectedMonth","selectedYear","people","onUpdateEditingMode","onHasChanges","onMonthDaysUpdated"])):x("",!0),s.currentPage==="ExcelComponent"?(g(),L(j(s.ExcelComponent),{key:1,ref:"excelComponent",isEditingMode:s.isEditingMode,selectedMonth:s.selectedMonth,selectedYear:s.selectedYear,people:s.people,onUpdateEditingMode:n.updateEditingMode,onHasChanges:n.updateUnsavedChanges,onMonthDaysUpdated:n.updateMonthDays},null,40,["isEditingMode","selectedMonth","selectedYear","people","onUpdateEditingMode","onHasChanges","onMonthDaysUpdated"])):x("",!0)],4),b(D,{people:s.people,isEditingMode:n.peopleListEditingMode},null,8,["people","isEditingMode"]),O(i("div",Re,[O(i("h1",Ae,e[4]||(e[4]=[I(" Tryb edytowania "),i("a",{class:"editing-mode-status"},"Włączony",-1),i("br",null,null,-1),I(" Przeciągaj członków zespołu na miejsca w grafiku."),i("br",null,null,-1),I("Kliknij na zajętą zmianę, aby ją wyczyścić. ")]),512),[[U,s.currentPage==="CalendarComponent"]]),O(i("h1",Be,e[5]||(e[5]=[I(" Tryb edytowania "),i("a",{class:"editing-mode-status"},"Włączony",-1),i("br",null,null,-1),I(" Kliknij na miejsce w tabeli, aby wybrać zmianę. ")]),512),[[U,s.currentPage==="ExcelComponent"]])],512),[[U,s.isEditingMode]]),s.monthDays.length>0&&s.localData[1]!==null?(g(),L(d,{key:1,ref:"shiftCountWindow",people:s.people,monthDays:s.monthDays},null,8,["people","monthDays"])):x("",!0),b(p)])]),e[6]||(e[6]=i("footer",{class:"footer"},[i("a",{href:"https://github.com/puksh/kalendar"},"© 2025 puksh - All rights reserved")],-1))],64)}const je=N(Pe,[["render",We],["__scopeId","data-v-9f54d92b"]]);window.addEventListener("error",o=>{o.error&&(o.error.message.includes("Failed to fetch dynamically imported module")||o.error.message.includes("Importing a module script failed"))&&window.location.reload()});Z(je).mount("#app");"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(o=>{console.log("Service Worker registered with scope:",o.scope)}).catch(o=>{console.log("Service Worker registration failed:",o)})});export{v as _,S as i};
