import{N as p,a as l,_ as g}from"./utils-oZnrSTRW.js";import{c as d,e as h,o as c,d as t,t as u,l as f,s as m,u as z,n as y}from"./vue-vendor-DIMlJxEK.js";const b={name:"AuthorizationModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"save",validator:e=>["save","salary"].includes(e)}},emits:["close","authorized"],components:{NotificationMessage:p},data(){return{password:"",isAuthorizing:!1,showPassword:!1}},methods:{getButtonText(){return this.isAuthorizing?"Weryfikacja...":this.mode==="salary"?"Wyświetl wynagrodzenie":"Zapisz zmiany"},async authorize(){if(!this.isAuthorizing){this.isAuthorizing=!0,this.showPassword=!1;try{if(!await this.verifyPassword()){l("Nieprawidłowe hasło","red"),this.password="";return}this.mode==="salary"?this.handleSalaryMode():await this.handleSaveMode()}catch(e){console.error(e),l("Wystąpił błąd podczas autoryzacji","red")}finally{this.isAuthorizing=!1}}},async verifyPassword(){const e=new TextEncoder().encode("asmmRrfFvKrsBgyLzUuiZD9tGQj3LAQj"),s=1e5,i=32,r=new TextEncoder,o=await window.crypto.subtle.importKey("raw",r.encode(this.password),{name:"PBKDF2"},!1,["deriveBits"]),a=await window.crypto.subtle.deriveBits({name:"PBKDF2",salt:e,iterations:s,hash:"SHA-256"},o,i*8);return Array.from(new Uint8Array(a)).map(w=>w.toString(16).padStart(2,"0")).join("")==="5fb04c8d929f687dd2baed132f66d67a8a442cab4d2d84cec4a58b08f01f9c6b"},handleSalaryMode(){l("Dostęp przyznany","green"),this.$emit("authorized"),this.closeModal()},async handleSaveMode(){const e=this.collectLocalStorageData();if(Object.keys(e).length===0){l("Brak zmian do zapisania","yellow");return}await this.saveDataToServer(e),l("Zmiany zapisano pomyślnie!","green"),this.$emit("authorized"),this.closeModal()},collectLocalStorageData(){const e={},s=["isEditingMode","currentPage"];for(let i=0;i<localStorage.length;i++){const r=localStorage.key(i);if(r&&!s.includes(r))try{e[r]=JSON.parse(localStorage.getItem(r))}catch{}}return e},async saveDataToServer(e){const s=JSON.stringify(e),i=btoa(s),r=await fetch("https://mc.kot.li/?key=shiftData.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"shiftData",value:i})});if(!r.ok)throw new Error(`Server error: ${r.status}`)},closeModal(){this.password="",this.$emit("close")},cancel(){this.isAuthorizing||this.closeModal()},togglePasswordVisibility(){this.showPassword=!this.showPassword}},mounted(){this.$nextTick(()=>{this.$refs.passwordInput?.focus()})}},v={key:0,class:"modal"},k={class:"modal-content"},S={class:"input-container"},P=["type"],_=["aria-label","title"],x={class:"eye-icon"},A={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"22",height:"22",fill:"none",stroke:"white","stroke-width":"2"},D={class:"button-container"},B=["disabled"],M={key:0,class:"spinner"},j=["disabled"];function K(e,s,i,r,o,a){return i.show?(c(),d("section",v,[t("div",k,[s[6]||(s[6]=t("h3",null,"Autoryzacja",-1)),t("p",null,u(i.mode==="salary"?"Wpisz hasło aby wyświetlić wynagrodzenie:":"Wpisz hasło aby zapisać zmiany:"),1),t("div",S,[f(t("input",{type:o.showPassword?"text":"password","onUpdate:modelValue":s[0]||(s[0]=n=>o.password=n),onKeyup:s[1]||(s[1]=z((...n)=>a.authorize&&a.authorize(...n),["enter"])),placeholder:"Hasło...",autocomplete:"current-password",ref:"passwordInput"},null,40,P),[[m,o.password]]),t("button",{type:"button",class:"toggle-password-button",onClick:s[2]||(s[2]=(...n)=>a.togglePasswordVisibility&&a.togglePasswordVisibility(...n)),"aria-label":o.showPassword?"Ukryj hasło":"Pokaż hasło",title:o.showPassword?"Ukryj hasło":"Pokaż hasło"},[t("span",x,[(c(),d("svg",A,[t("g",{class:y({"eye-hidden":!o.showPassword})},s[5]||(s[5]=[t("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),t("circle",{cx:"12",cy:"12",r:"3"},null,-1)]),2),t("line",{class:y(["eye-slash",{"eye-slash-hidden":o.showPassword}]),x1:"2",y1:"2",x2:"22",y2:"22"},null,2)]))])],8,_)]),t("div",D,[t("button",{class:"primary-button",onClick:s[3]||(s[3]=(...n)=>a.authorize&&a.authorize(...n)),disabled:o.isAuthorizing},[t("span",null,u(a.getButtonText()),1),o.isAuthorizing?(c(),d("span",M)):h("",!0)],8,B),t("button",{class:"secondary-button",onClick:s[4]||(s[4]=(...n)=>a.cancel&&a.cancel(...n)),disabled:o.isAuthorizing}," Anuluj ",8,j)])])])):h("",!0)}const C=g(b,[["render",K],["__scopeId","data-v-ef8780c7"]]);export{C as default};
