import{d as M}from"./daysOfWeek-C19XqJ9X.js";import{N as v,r as b,c as _,a as g,_ as z}from"./utils-B-gdOSXq.js";import{i as O}from"./index-Cph13O-O.js";import{c as l,o as r,d,F as y,a as D,w as U,n as m,t as N,l as F,s as Y}from"./vue-vendor-wnm_OC9P.js";const P={name:"SpreadsheetView",emits:["update-editing-mode","has-changes","month-days-updated"],props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},components:{NotificationMessage:v},data(){return{editedShifts:{},monthDays:[],localData:{},daysOfWeek:M,madeChanges:!1,scrollContainer:null,isFirstColumnLocked:!1,importedCells:new Set}},computed:{daysInMonth(){return this.monthDays.map(t=>t.date.getDate())},orderedPeople(){const t=["Milena","Mikołaj","Aleksandra","Joanna","Łukasz","Natalia","Marcin"];return this.people.filter(i=>t.includes(i.name)).sort((i,a)=>t.indexOf(i.name)-t.indexOf(a.name))}},watch:{selectedMonth(){this.generateMonthDays()},selectedYear(){this.generateMonthDays()}},methods:{isEditing(t,i){return this.editedShifts.hasOwnProperty(`${t}-${i}`)},getShiftForPersonAndDay(t,i){const a=this.monthDays.find(h=>h.date.getDate()===i)?.date.toDateString(),o=localStorage.getItem(a);if(o){const h=JSON.parse(o),s=[];return(h.dayShift1===t||h.dayShift2===t)&&s.push("D"),(h.nightShift1===t||h.nightShift2===t)&&s.push("N"),s.join(" ")}return null},editCell(t,i){if(this.isEditingMode){const a=`${t}-${i}`,o=this.getShiftForPersonAndDay(t,i)||"";this.editedShifts[a]=o}},saveShift(t,i){const a=`${t}-${i}`,o=this.editedShifts[a]?.trim().toUpperCase()||"",h=this.getShiftForPersonAndDay(t,i)||"";if(!["D","N","D N",""].includes(o)){g("Zła wartość! Tylko 'D', 'N', lub 'D N' są dozwolone.","red"),this.$nextTick(()=>{this.editedShifts[a]=h});return}const n=this.monthDays.find(c=>c.date.getDate()===i)?.date.toDateString();if(!n||!this.monthDays)return;const e=this.monthDays.find(c=>c.date.toDateString()===n);if(!e)return;if(e.dayShift1===t&&(e.dayShift1=null,e.dayShift1Name="Not assigned",e.dayShift1UserChanged=!0),e.dayShift2===t&&(e.dayShift2=null,e.dayShift2Name="Not assigned",e.dayShift2UserChanged=!0),e.nightShift1===t&&(e.nightShift1=null,e.nightShift1Name="Not assigned",e.nightShift1UserChanged=!0),e.nightShift2===t&&(e.nightShift2=null,e.nightShift2Name="Not assigned",e.nightShift2UserChanged=!0),o===""){const c={dayShift1:e.dayShift1,dayShift2:e.dayShift2,nightShift1:e.nightShift1,nightShift2:e.nightShift2,dayShift1Name:e.dayShift1Name,dayShift2Name:e.dayShift2Name,nightShift1Name:e.nightShift1Name,nightShift2Name:e.nightShift2Name};this.localData[n]=c,localStorage.setItem(n,JSON.stringify(c)),this.madeChanges=!0,this.$emit("has-changes",this.madeChanges),this.$nextTick(()=>{delete this.editedShifts[a],this.$forceUpdate()});return}const f=this.people.find(c=>c.id===t);if(o.includes("D")){if(f?.ratownik&&[e.dayShift1,e.dayShift2].filter(Boolean).some(S=>this.people.find(u=>u.id===S)?.ratownik&&S!==t)){g("Nie można przypisać dwóch ratowników na zmianę dzienną.","red"),delete this.editedShifts[a];return}if(!e.dayShift1)e.dayShift1=t,e.dayShift1Name=f.name,e.dayShift1UserChanged=!0;else if(!e.dayShift2)e.dayShift2=t,e.dayShift2Name=f.name,e.dayShift2UserChanged=!0;else{g("Nie można przypisać więcej niż dwóch osób na zmianę dzienną.","red"),delete this.editedShifts[a];return}}if(o.includes("N")){if(f?.ratownik&&[e.nightShift1,e.nightShift2].filter(Boolean).some(S=>this.people.find(u=>u.id===S)?.ratownik&&S!==t)){g("Nie można przypisać dwóch ratowników na zmianę nocną.","red"),delete this.editedShifts[a];return}if(!e.nightShift1)e.nightShift1=t,e.nightShift1Name=f.name,e.nightShift1UserChanged=!0;else if(!e.nightShift2)e.nightShift2=t,e.nightShift2Name=f.name,e.nightShift2UserChanged=!0;else{g("Nie można przypisać więcej niż dwóch osób na zmianę nocną.","red"),delete this.editedShifts[a];return}}const k={dayShift1:e.dayShift1,dayShift2:e.dayShift2,nightShift1:e.nightShift1,nightShift2:e.nightShift2};this.localData[n]=k,this.madeChanges=!0,this.$emit("has-changes",this.madeChanges),localStorage.setItem(n,JSON.stringify(k)),delete this.editedShifts[a]},generateMonthDays(){this.resetUserChanges();const t=this.selectedYear,i=this.selectedMonth,a=new Date(t,i+1,0).getDate();this.monthDays=[];for(let o=1;o<=a;o++)this.monthDays.push({date:new Date(t,i,o),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(t){this.madeChanges=t,this.$emit("has-changes",this.madeChanges)},loadFromLocalStorage(){const t=this.selectedYear,i=this.selectedMonth;for(let a=1;a<=31;a++){const o=new Date(t,i,a).toDateString(),h=localStorage.getItem(o);if(h)try{const s=JSON.parse(h),n=this.monthDays.find(e=>e.date.toDateString()===o);n&&(n.dayShift1=s.dayShift1,n.dayShift2=s.dayShift2,n.nightShift1=s.nightShift1,n.nightShift2=s.nightShift2,n.dayShift1Name=s.dayShift1Name||"Not assigned",n.dayShift2Name=s.dayShift2Name||"Not assigned",n.nightShift1Name=s.nightShift1Name||"Not assigned",n.nightShift2Name=s.nightShift2Name||"Not assigned")}catch(s){console.error("Failed to load local data:",s),g("Nie udało się załadować danych lokalnych. Sprawdź konsolę.","red")}}},resolvePersonName(t){const i=this.people.find(a=>a.id===t);return i?{name:i.name,isRatownik:i.ratownik}:{name:void 0,isRatownik:!1}},async checkShiftDataSync(){this.syncedChanges=await _(()=>this.generateMonthDays())},resetSyncedChangesSessionStorage(){this.syncedChanges=b()},handleScroll(t){this.scrollContainer&&(t.preventDefault(),this.scrollContainer.scrollLeft+=t.deltaY)},resetUserChanges(){for(const t in localStorage)if(!(t==="isEditingMode"||t==="currentPage")&&localStorage.hasOwnProperty(t))try{const i=JSON.parse(localStorage.getItem(t)||"{}");(i.dayShift1UserChanged||i.dayShift2UserChanged||i.nightShift1UserChanged||i.nightShift2UserChanged)&&localStorage.removeItem(t)}catch{continue}this.localData={},this.editedShifts={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges)},isToday(t){const i=new Date;return t.getDate()===i.getDate()&&t.getMonth()===i.getMonth()&&t.getFullYear()===i.getFullYear()},isImportedCell(t,i){return this.importedCells.has(`${t}-${i}`)},toggleColumnsLocked(){this.isFirstColumnLocked=!this.isFirstColumnLocked,this.$nextTick(()=>{document.querySelectorAll(".calendar-table th:first-child, .calendar-table td:first-child").forEach(i=>{this.isFirstColumnLocked?i.classList.add("column-locked"):i.classList.remove("column-locked")})})},isHoliday(t){return O(t)}},mounted(){this.resetUserChanges(),this.generateMonthDays(),this.scrollContainer=this.$refs.scrollContainer}},L={class:"spreadsheet-view"},x={class:"calendar-table"},E=["title"],V={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"white","stroke-width":"2"},j={key:0,d:"M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z"},H={key:1,d:"M8 11V7a4 4 0 0 1 8 0"},A=["title","aria-label"],B=["onClick","aria-label","title"],T=["onUpdate:modelValue","onChange"];function J(t,i,a,o,h,s){return r(),l("div",L,[d("div",{class:"scrollable-container",onWheel:i[1]||(i[1]=U((...n)=>s.handleScroll&&s.handleScroll(...n),["prevent"])),ref:"scrollContainer"},[d("table",x,[d("thead",null,[d("tr",null,[d("th",null,[d("button",{class:"lock-column-button",onClick:i[0]||(i[0]=(...n)=>s.toggleColumnsLocked&&s.toggleColumnsLocked(...n)),title:h.isFirstColumnLocked?"Odblokuj szerokość":"Zablokuj szerokość"},[(r(),l("svg",V,[i[2]||(i[2]=d("rect",{x:"7",y:"11",width:"10",height:"10",rx:"1"},null,-1)),h.isFirstColumnLocked?(r(),l("path",j)):(r(),l("path",H))]))],8,E)]),(r(!0),l(y,null,D(s.daysInMonth,n=>(r(),l("th",{key:n,class:m({"nd-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,n).getDay()]==="Nd","sob-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,n).getDay()]==="Sob","holiday-color":s.isHoliday(new Date(a.selectedYear,a.selectedMonth,n)).isHoliday,"today-column":s.isToday(new Date(a.selectedYear,a.selectedMonth,n))}),title:s.isHoliday(new Date(a.selectedYear,a.selectedMonth,n)).name||"","aria-label":s.isHoliday(new Date(a.selectedYear,a.selectedMonth,n)).name||""},N(n),11,A))),128))])]),d("tbody",null,[(r(!0),l(y,null,D(s.orderedPeople,n=>(r(),l("tr",{key:n.id},[d("td",{class:m({ratownik:n.ratownik,pielegniarka:!n.ratownik})},N(n.name),3),(r(!0),l(y,null,D(s.daysInMonth,e=>(r(),l("td",{key:e,class:m(["editable-cell",{"nd-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,e).getDay()]==="Nd","sob-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,e).getDay()]==="Sob","holiday-color":s.isHoliday(new Date(a.selectedYear,a.selectedMonth,e)).isHoliday,today:s.isToday(new Date(a.selectedYear,a.selectedMonth,e))}]),onClick:f=>s.editCell(n.id,e),"aria-label":a.isEditingMode?"Kliknij aby edytować zmianę":"",title:a.isEditingMode?"Kliknij aby edytować zmianę":"",role:"gridcell"},[!a.isEditingMode||!s.isEditing(n.id,e)?(r(),l("span",{key:0,class:m({"imported-cell":s.isImportedCell(n.id,e)})},N(s.getShiftForPersonAndDay(n.id,e)||""),3)):F((r(),l("select",{key:1,"onUpdate:modelValue":f=>h.editedShifts[`${n.id}-${e}`]=f,onChange:f=>s.saveShift(n.id,e)},i[3]||(i[3]=[d("option",{value:""},null,-1),d("option",{value:"D"},"D",-1),d("option",{value:"N"},"N",-1),d("option",{value:"D N"},"D N",-1)]),40,T)),[[Y,h.editedShifts[`${n.id}-${e}`]]])],10,B))),128))]))),128))])])],544)])}const K=z(P,[["render",J],["__scopeId","data-v-239a30f7"]]);export{K as default};
