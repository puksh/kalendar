import{S as v,P as M}from"./PeopleListWindow-j-7DJpae.js";import{_ as b,r as p,o as h,c as f,a as d,t as S,w,d as C,F as m,f as y,g as D,h as E,b as x,n as P,i as z}from"./index-QYdSRHFs.js";const F={name:"SpreadsheetView",components:{ShiftCountWindow:v,PeopleListWindow:M},props:{monthDays:Array,people:Array},data(){return{isEditingMode:!1,editedShifts:{},selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),monthDays:[],madeChanges:!1,people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0},{id:8,name:"Alina",ratownik:!1},{id:9,name:"Ewelina",ratownik:!1},{id:7,name:"Teresa",ratownik:!1}],locale:"pl"}},computed:{daysInMonth(){return this.monthDays.map(e=>e.date.getDate())},orderedPeople(){const e=["Milena","Mikołaj","Aleksandra","Joanna","Łukasz","Natalia","Marcin"];return this.people.filter(t=>e.includes(t.name)).sort((t,s)=>e.indexOf(t.name)-e.indexOf(s.name))},monthYear(){return new Date(this.selectedYear,this.selectedMonth).toLocaleString(this.locale,{month:"long",year:"numeric"})}},methods:{toggleEditingMode(){this.isEditingMode=!this.isEditingMode},isEditing(e,t){return this.editedShifts.hasOwnProperty(`${e}-${t}`)},getShiftForPersonAndDay(e,t){const s=this.monthDays.find(o=>o.date.getDate()===t)?.date.toDateString(),l=localStorage.getItem(s);if(l){const o=JSON.parse(l);return Object.values(o).find(a=>a===e)}return null},editCell(e,t){if(this.isEditingMode){const s=`${e}-${t}`,l=this.getShiftForPersonAndDay(e,t)||"";this.editedShifts[s]=l}},saveShift(e,t){const s=`${e}-${t}`,l=this.editedShifts[s].trim().toUpperCase();if(!["D","N","D N",""].includes(l)){alert("Invalid input! Only 'D', 'N', or 'D N' are allowed."),delete this.editedShifts[s];return}const a=this.monthDays.find(r=>r.date.getDate()===t)?.date.toDateString();if(a){const r=JSON.parse(localStorage.getItem(a)||"{}"),i=this.monthDays.find(c=>c.date.toDateString()===a);if(l===""){i.dayShift1===e?(i.dayShift1=null,i.dayShift1Name="Not assigned",r.dayShift1=null):i.dayShift2===e?(i.dayShift2=null,i.dayShift2Name="Not assigned",r.dayShift2=null):i.nightShift1===e?(i.nightShift1=null,i.nightShift1Name="Not assigned",r.nightShift1=null):i.nightShift2===e&&(i.nightShift2=null,i.nightShift2Name="Not assigned",r.nightShift2=null),localStorage.setItem(a,JSON.stringify(r)),delete this.editedShifts[s];return}const n=this.people.find(c=>c.id===e),g=n?.ratownik,N=[i.dayShift1,i.dayShift2,i.nightShift1,i.nightShift2].filter(Boolean).some(c=>this.people.find(k=>k.id===c)?.ratownik);if(g&&N){alert("Nie można przypisać dwóch ratowników na jedną zmianę."),delete this.editedShifts[s];return}if(l.includes("D"))if(!i.dayShift1)i.dayShift1=e,i.dayShift1Name=n.name;else if(!i.dayShift2)i.dayShift2=e,i.dayShift2Name=n.name;else{alert("Nie można przypisać więcej niż dwóch osób na zmianę dzienną."),delete this.editedShifts[s];return}if(l.includes("N"))if(!i.nightShift1)i.nightShift1=e,i.nightShift1Name=n.name;else if(!i.nightShift2)i.nightShift2=e,i.nightShift2Name=n.name;else{alert("Nie można przypisać więcej niż dwóch osób na zmianę nocną."),delete this.editedShifts[s];return}r.dayShift1=i.dayShift1,r.dayShift2=i.dayShift2,r.nightShift1=i.nightShift1,r.nightShift2=i.nightShift2,localStorage.setItem(a,JSON.stringify(r))}delete this.editedShifts[s]},generateMonthDays(){const e=this.selectedYear,t=this.selectedMonth,s=new Date(e,t+1,0).getDate();this.monthDays=[];for(let l=1;l<=s;l++)this.monthDays.push({date:new Date(e,t,l),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage()},changeMonth(e){this.madeChanges&&!confirm("You have unsaved changes. Are you sure you want to switch the month? Your changes will be discarded.")||(this.editedShifts={},this.selectedMonth=this.selectedMonth+e,this.generateMonthDays())},loadFromLocalStorage(){const e=this.selectedYear,t=this.selectedMonth;for(let s=1;s<=31;s++){const l=new Date(e,t,s).toDateString(),o=localStorage.getItem(l);if(o)try{const a=JSON.parse(o),r=this.monthDays.find(i=>i.date.toDateString()===l);r&&(r.dayShift1=a.dayShift1,r.dayShift2=a.dayShift2,r.nightShift1=a.nightShift1,r.nightShift2=a.nightShift2,r.dayShift1Name=a.dayShift1Name||"Not assigned",r.dayShift2Name=a.dayShift2Name||"Not assigned",r.nightShift1Name=a.nightShift1Name||"Not assigned",r.nightShift2Name=a.nightShift2Name||"Not assigned")}catch(a){console.error("Failed to load local data:",a)}}},resolvePersonName(e){const t=this.people.find(s=>s.id===e);return t?{name:t.name,isRatownik:t.ratownik}:{name:void 0,isRatownik:!1}},async fetchServerShiftData(){this.syncedChanges={};try{const e=await fetch("https://mc.kot.li/?key=shiftData.json",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw e.status===404&&addNotification("Data not found on server","red"),new Error(`Failed to fetch data from server: ${e.status}`);return await e.json()}catch(e){return console.error("Error fetching data from server:",e),addNotification("Failed to fetch data from server","red"),null}},getShiftForPersonAndDay(e,t){const s=this.monthDays.find(o=>o.date.getDate()===t)?.date.toDateString(),l=localStorage.getItem(s);if(l){const o=JSON.parse(l),a=[];return(o.dayShift1===e||o.dayShift2===e)&&a.push("D"),(o.nightShift1===e||o.nightShift2===e)&&a.push("N"),a.join(" ")}return null}},mounted(){this.generateMonthDays()}},O={class:"spreadsheet-view"},V={class:"monthChange"},j={style:{"font-weight":"bold",width:"200px !important"}},A={class:"glass-toggle"},Y={class:"calendar-table"},J=["onClick"],_={key:0},L=["onUpdate:modelValue","onChange"],W={key:0,style:{display:"flex","flex-direction":"column","align-items":"center"}};function R(e,t,s,l,o,a){const r=p("PeopleListWindow"),i=p("ShiftCountWindow");return h(),f(m,null,[d("div",O,[d("section",V,[d("button",{class:"buttonMonthChange",onClick:t[0]||(t[0]=n=>a.changeMonth(-1))}," ‹ "),d("span",j,S(a.monthYear.toUpperCase()),1),d("button",{class:"buttonMonthChange",onClick:t[1]||(t[1]=n=>a.changeMonth(1))},"›")]),d("button",{class:"top-right-buttons buttonRefresh",onClick:t[2]||(t[2]=n=>e.checkShiftDataSync())},t[5]||(t[5]=[d("img",{src:"/assets/icons/refresh.svg",style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Refresh"},null,-1)])),d("label",A,[w(d("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=n=>o.isEditingMode=n),onChange:t[4]||(t[4]=(...n)=>e.updateEditingMode&&e.updateEditingMode(...n))},null,544),[[C,o.isEditingMode]]),t[6]||(t[6]=d("span",{class:"toggle-slider"},null,-1)),t[7]||(t[7]=d("span",{class:"label-text"},"Tryb edytowania",-1))]),d("table",Y,[d("thead",null,[d("tr",null,[t[8]||(t[8]=d("th",null,null,-1)),(h(!0),f(m,null,y(a.daysInMonth,n=>(h(),f("th",{key:n},S(n),1))),128))])]),d("tbody",null,[(h(!0),f(m,null,y(a.orderedPeople,n=>(h(),f("tr",{key:n.id},[d("td",{class:P({ratownik:n.ratownik,pielegniarka:!n.ratownik})},S(n.name),3),(h(!0),f(m,null,y(a.daysInMonth,g=>(h(),f("td",{key:g,class:"editable-cell",onClick:u=>a.editCell(n.id,g)},[!o.isEditingMode||!a.isEditing(n.id,g)?(h(),f("span",_,S(a.getShiftForPersonAndDay(n.id,g)||""),1)):w((h(),f("select",{key:1,"onUpdate:modelValue":u=>o.editedShifts[`${n.id}-${g}`]=u,onChange:u=>a.saveShift(n.id,g)},t[9]||(t[9]=[d("option",{value:""},null,-1),d("option",{value:"D"},"D",-1),d("option",{value:"N"},"N",-1),d("option",{value:"D N"},"D N",-1)]),40,L)),[[z,o.editedShifts[`${n.id}-${g}`]]])],8,J))),128))]))),128))])])]),D(r,{people:o.people,isEditingMode:!1},null,8,["people"]),o.isEditingMode?(h(),f("div",W,t[10]||(t[10]=[d("h1",{style:{background:"var(--glass-bg-color)","backdrop-filter":"blur(var(--glass-blur))","-webkit-backdrop-filter":"blur(var(--glass-blur))",border:"1px solid var(--glass-border-color)","border-radius":"var(--border-radius-small)",filter:"drop-shadow(var(--shadow-drop))",color:"var(--color-text-dark)","font-size":"20px","box-shadow":"var(--glass-box-shadow)",padding:"var(--spacing-medium)"}},[E(" Tryb edytowania "),d("a",{style:{color:"green"}},"Włączony")],-1)]))):x("",!0),D(i,{people:o.people,monthDays:o.monthDays},null,8,["people","monthDays"])],64)}const G=b(F,[["render",R],["__scopeId","data-v-af71d109"]]);export{G as default};
