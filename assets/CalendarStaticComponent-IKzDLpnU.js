import{S as w,P as D,d as m}from"./PeopleListWindow-DLG7NZFK.js";import{addNotification as y}from"./NotificationMessage-Bm7SL4Yp.js";import{_ as v,r as p,o as l,c,a as o,t as g,d as N,F as C,e as _,f as k,n as S}from"./index-BCtFxG_n.js";const M={name:"CalendarComponent",components:{ShiftCountWindow:w,PeopleListWindow:D},data(){return{selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),monthDays:[],localData:{},changedShifts:{},syncedChanges:{},daysOfWeek:m,currentDate:new Date,people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0},{id:8,name:"Alina",ratownik:!1},{id:9,name:"Ewelina",ratownik:!1},{id:7,name:"Teresa",ratownik:!1}],locale:"pl",scrollContainer:null}},computed:{monthYear(){return new Date(this.selectedYear,this.selectedMonth).toLocaleString(this.locale,{month:"long",year:"numeric"})}},methods:{resolvePersonName(t){const n=this.people.find(a=>a.id===t);return n?{name:n.name,isRatownik:n.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const t=this.selectedYear,n=this.selectedMonth,a=new Date(t,n+1,0).getDate();this.monthDays=[];for(let r=1;r<=a;r++)this.monthDays.push({date:new Date(t,n,r),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage()},changeMonth(t){if(this.madeChanges){if(!confirm("You have unsaved changes. Are you sure you want to switch the month? Your changes will be discarded."))return;this.changedShifts={}}this.selectedMonth=this.selectedMonth+t,this.generateMonthDays()},async fetchServerShiftData(){this.syncedChanges={};try{const t=await fetch("https://vuecalendar.kot.li/?key=shiftData.json",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw t.status===404&&y("Data not found on server","red"),new Error(`Failed to fetch data from server: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching data from server:",t),y("Failed to fetch data from server","red"),null}},async checkShiftDataSync(){this.resetSyncedChangesSessionStorage();const t=await this.fetchServerShiftData();if(!t){console.log("No remote data fetched.");return}const n={};for(const[a,r]of Object.entries(t)){const i=localStorage.getItem(a),h=i?JSON.parse(i):null,s={};if(!h)n[a]={...r},localStorage.setItem(a,JSON.stringify(r));else{for(const[d,e]of Object.entries(r)){const f=h[d]||null;f!==e&&(s[d]={from:f||"Empty",to:e||"Empty"})}Object.keys(s).length>0&&(n[a]=s),localStorage.setItem(a,JSON.stringify(r))}}this.generateMonthDays(),this.syncedChanges=n,console.log("Updated syncedChanges:",this.syncedChanges),sessionStorage.setItem("syncedChanges",JSON.stringify(this.syncedChanges)),setTimeout(()=>{console.log("Clearing syncedChanges."),this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3)},loadFromLocalStorage(){const t=this.selectedYear,n=this.selectedMonth;for(let a=1;a<=31;a++){const r=new Date(t,n,a).toDateString();if(this.syncedChanges[r])continue;const i=localStorage.getItem(r);if(i)try{const h=JSON.parse(i),s=this.monthDays.find(d=>d.date.toDateString()===r);if(s){s.dayShift1=h.dayShift1,s.dayShift2=h.dayShift2,s.nightShift1=h.nightShift1,s.nightShift2=h.nightShift2;const d=this.resolvePersonName(s.dayShift1);s.dayShift1Name=d.name,s.dayShift1Ratownik=d.isRatownik;const e=this.resolvePersonName(s.dayShift2);s.dayShift2Name=e.name,s.dayShift2Ratownik=e.isRatownik;const f=this.resolvePersonName(s.nightShift1);s.nightShift1Name=f.name,s.nightShift1Ratownik=f.isRatownik;const u=this.resolvePersonName(s.nightShift2);s.nightShift2Name=u.name,s.nightShift2Ratownik=u.isRatownik}}catch(h){y("Failed to load local data: "+h,"red")}}this.calculateAllShiftCounts()},resetSyncedChangesSessionStorage(){const t=sessionStorage.getItem("syncedChanges");t&&(this.syncedChanges=JSON.parse(t),setTimeout(()=>{this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3))},handleScroll(t){this.scrollContainer&&(t.preventDefault(),this.scrollContainer.scrollLeft+=t.deltaY)},getDayClass(t){return m[t]==="Nd"?"nd-color":m[t]==="Sob"?"sob-color":"normal-color"},countShiftsForPerson(t){if(!t)return 0;let n=0;for(let a=0;a<this.monthDays.length;a++)this.monthDays[a].dayShift1===t&&(n+=1),this.monthDays[a].dayShift2===t&&(n+=1),this.monthDays[a].nightShift1===t&&(n+=1),this.monthDays[a].nightShift2===t&&(n+=1);return n},calculateAllShiftCounts(){this.people.forEach(t=>{t.shiftCount=this.countShiftsForPerson(t.id)})}},async mounted(){await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer}},b={class:"monthChange"},R={style:{"font-weight":"bold"}},O={class:"calendar-container"},P={class:"calendar-grid"},W={class:"day-header"},F={class:"shift"},Y={class:"day-date"},E={key:0,class:"assigned-person"},L={key:1,class:"empty-slot"},j={key:0,class:"assigned-person"},J={key:1,class:"empty-slot"},T={key:0,class:"assigned-person"},U={key:1,class:"empty-slot"},A={key:0,class:"assigned-person"},x={key:1,class:"empty-slot"};function I(t,n,a,r,i,h){const s=p("PeopleListWindow"),d=p("ShiftCountWindow");return l(),c(C,null,[o("section",null,[o("section",b,[o("button",{class:"buttonMonthChange",onClick:n[0]||(n[0]=e=>h.changeMonth(-1))}," ‹ "),o("span",R,g(h.monthYear.toUpperCase()),1),o("button",{class:"buttonMonthChange",onClick:n[1]||(n[1]=e=>h.changeMonth(1))},"›")]),o("button",{class:"top-right-buttons buttonRefresh",onClick:n[2]||(n[2]=e=>h.checkShiftDataSync())},n[4]||(n[4]=[o("img",{src:"/assets/icons/refresh.svg",style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Refresh"},null,-1)]))]),o("div",O,[o("section",{class:"scrollable-container",onWheel:n[3]||(n[3]=N((...e)=>h.handleScroll&&h.handleScroll(...e),["prevent"])),ref:"scrollContainer"},[o("div",P,[(l(!0),c(C,null,_(i.monthDays,(e,f)=>(l(),c("div",{key:f,class:"day-column"},[o("div",null,[o("div",{class:S(["day-cell",{"current-month":e.isCurrentMonth,"nd-color":i.daysOfWeek[e.date.getDay()]==="Nd","sob-color":i.daysOfWeek[e.date.getDay()]==="Sob"}])},[o("div",W,g(i.daysOfWeek[e.date.getDay()]),1),o("div",F,[o("div",Y,g(e.date.getDate()),1),o("div",{class:S(["shift-slot day",{"synced-changed":i.syncedChanges[e.date.toDateString()]?.dayShift1,ratownik:e.dayShift1Ratownik===!0,userChanged:e.dayShift1UserChanged===!0}])},[e.dayShift1?(l(),c("div",E,g(e.dayShift1Name),1)):(l(),c("div",L,"D"))],2),o("div",{class:S(["shift-slot day",{"synced-changed":i.syncedChanges[e.date.toDateString()]?.dayShift2,ratownik:e.dayShift2Ratownik===!0,userChanged:e.dayShift2UserChanged===!0}])},[e.dayShift2?(l(),c("div",j,g(e.dayShift2Name),1)):(l(),c("div",J,"D"))],2),o("div",{class:S(["shift-slot night",{"synced-changed":i.syncedChanges[e.date.toDateString()]?.nightShift1,ratownik:e.nightShift1Ratownik===!0,userChanged:e.nightShift1UserChanged===!0}])},[e.nightShift1?(l(),c("div",T,g(e.nightShift1Name),1)):(l(),c("div",U,"N"))],2),o("div",{class:S(["shift-slot night",{"synced-changed":i.syncedChanges[e.date.toDateString()]?.nightShift2,ratownik:e.nightShift2Ratownik===!0,userChanged:e.nightShift2UserChanged===!0}])},[e.nightShift2?(l(),c("div",A,g(e.nightShift2Name),1)):(l(),c("div",x,"N"))],2)])],2)])]))),128))])],544)]),k(s,{people:i.people},null,8,["people"]),k(d,{people:i.people,monthDays:i.monthDays},null,8,["people","monthDays"])],64)}const G=v(M,[["render",I],["__scopeId","data-v-fd98c76c"]]);export{G as default};
