import{c as N,i as D,a as E,s as m,d as f,l as T,g as v,b as k,v as b}from"./shiftManagement-DwD8WFN1.js";import{M as p,_ as M,N as P,c as G}from"./utils-DxxLyD3D.js";import{i as C}from"./index-BCWM8ikL.js";import{c as l,o as r,t as h,w as c,n as y,h as F,g as H,d as n,F as u,a as _,k as w}from"./vue-vendor-C8we75Ce.js";function O(){return N(),{localData:{},madeChanges:!1}}const W={name:"CalendarShiftSlotComponent",emits:["drop","reset"],props:{day:{type:Object,required:!0},shiftType:{type:String,required:!0},isEditing:{type:Boolean,default:!1}},data(){return{MESSAGES:p}},computed:{isNightShift(){return this.shiftType.includes("night")},isDayShift(){return this.shiftType.includes("day")},shiftName(){return this.isDayShift?this.MESSAGES.SHIFT_DAY:this.MESSAGES.SHIFT_NIGHT},hasAssignedPerson(){return!!this.day[this.shiftType]},assignedPersonName(){return this.day[this.shiftType+"Name"]},isUserChanged(){return this.day[this.shiftType+"UserChanged"]},isRatownik(){return this.day[this.shiftType+"Ratownik"]===!0},isPielegniarka(){return this.day[this.shiftType+"Ratownik"]===!1}},methods:{getShiftSlotClasses(){return{day:this.isDayShift,night:this.isNightShift,ratownik:this.isRatownik,pielegniarka:this.isPielegniarka,userChanged:this.isUserChanged,clickable:this.isEditing&&this.hasAssignedPerson}},getShiftAriaLabel(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}. ${this.MESSAGES.SHIFT_CLICK_TO_REMOVE}.`:`${this.shiftName}: ${this.MESSAGES.SHIFT_EMPTY}. ${this.MESSAGES.SHIFT_DRAG_TO_ASSIGN}.`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${this.MESSAGES.SHIFT_EMPTY}.`},getShiftTooltip(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName} (${this.MESSAGES.SHIFT_CLICK_TO_DELETE})`:`${this.MESSAGES.SHIFT_DRAG_TO_ASSIGN_SPECIFIC} - ${this.shiftName.toLowerCase()}`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${this.MESSAGES.NOT_ASSIGNED}`}}},L=["aria-label","title"],R={key:0,class:"assigned-person"},$={key:1,class:"assigned-person deleted"},Y={key:2,class:"empty-slot"};function B(e,t,s,d,i,a){return r(),l("div",{class:y(["shift-slot",a.getShiftSlotClasses()]),onDragover:t[0]||(t[0]=c(()=>{},["prevent"])),onDrop:t[1]||(t[1]=S=>e.$emit("drop")),onClick:t[2]||(t[2]=S=>s.isEditing&&e.$emit("reset")),"aria-label":a.getShiftAriaLabel(),title:a.getShiftTooltip(),role:"button",tabindex:"0"},[s.day[s.shiftType]?(r(),l("div",R,h(s.day[s.shiftType+"Name"]),1)):s.day[s.shiftType+"UserChanged"]?(r(),l("div",$,h(i.MESSAGES.SHIFT_DELETED),1)):(r(),l("div",Y,h(s.shiftType.includes("day")?i.MESSAGES.SHIFT_DAY_INITIAL:i.MESSAGES.SHIFT_NIGHT_INITIAL),1))],42,L)}const U=M(W,[["render",B],["__scopeId","data-v-c4315d9d"]]),q=["dayShift1","dayShift2","nightShift1","nightShift2"],x={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:P,ShiftSlot:U},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:f,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1,MESSAGES:p,SHIFT_TYPES:q}},computed:{holidayInfo(){return this.monthDays.map(e=>C(e.date))}},methods:{handleDrop(e,t){const s=this.getDraggedPersonFromStorage();if(!s)return;const d=this.findDayByDate(e);!d||!b(d,t,s,this.people)||(E(d,t,s),m(d),this.markChangesAndEmit(),this.clearDraggedPersonFromStorage())},handleClickResetShift(e,t){e[t]!==null&&(k(e,t),m(e),this.madeChanges=!0,this.$emit("has-changes",!0))},generateMonthDays(){this.monthDays=v(this.selectedYear,this.selectedMonth),T(this.selectedYear,this.selectedMonth,this.monthDays,this.people),this.$emit("month-days-updated",this.monthDays)},updateChanges(e){this.madeChanges=e,this.$emit("has-changes",e)},emitEditingMode(e){this.$emit("update-editing-mode",e)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await G(()=>this.generateMonthDays())},loadFromSessionStorage(){T(this.selectedYear,this.selectedMonth,this.monthDays,this.people)},resetUserChanges(){const e=O();this.localData=e.localData,this.madeChanges=e.madeChanges,this.$emit("has-changes",this.madeChanges)},handleScroll(e){this.scrollContainer&&(e.preventDefault(),this.scrollContainer.scrollLeft+=e.deltaY)},scrollToToday(){this.$nextTick(()=>{const e=new Date;if(e.getMonth()===this.selectedMonth&&e.getFullYear()===this.selectedYear){const t=this.monthDays.findIndex(s=>D(s.date));if(t!==-1&&this.scrollContainer){const s=document.querySelector(".day-cell")?.offsetWidth||0,d=this.scrollContainer.offsetWidth,i=s*t-d/2+s/2;this.scrollContainer.scrollTo({left:Math.max(0,i),behavior:"smooth"})}}})},getDayCellClasses(e){return{"current-month":e.isCurrentMonth,"nd-color":f[e.date.getDay()]==="Nd","sob-color":f[e.date.getDay()]==="Sob","holiday-color":this.isHoliday(e.date).isHoliday,today:this.isToday(e.date)}},getHolidayTooltip(e){return this.isHoliday(e).name||""},getDraggedPersonFromStorage(){const e=localStorage.getItem("draggedPerson");return e?JSON.parse(e):null},findDayByDate(e){return this.monthDays.find(t=>t.date.toDateString()===e.toDateString())},assignShiftToDay(e,t,s){E(e,t,s),m.call(this,e)},markChangesAndEmit(){this.madeChanges=!0,this.$emit("has-changes",!0)},clearDraggedPersonFromStorage(){localStorage.removeItem("draggedPerson")},checkMobilePlatform(){const e=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(e.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(e){return D(e)},isHoliday(e){return C(e)}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.scrollToToday(),this.checkMobilePlatform()},watch:{isEditingMode(e){localStorage.setItem("isEditingMode",JSON.stringify(e)),e&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays(),this.scrollToToday()},selectedYear(){this.generateMonthDays()}}},K={key:0,class:"mobile-warning-overlay"},J={class:"mobile-warning"},V={class:"calendar-container"},j={class:"calendar-grid"},z=["title"],X={class:"day-header"},Q={class:"day-date"};function Z(e,t,s,d,i,a){const S=F("shift-slot");return r(),l(u,null,[i.showMobileWarning?(r(),l("div",K,[n("div",J,[n("h3",null,h(i.MESSAGES.MOBILE_WARNING_TITLE),1),n("p",null,h(i.MESSAGES.MOBILE_WARNING_TEXT),1),n("p",null,h(i.MESSAGES.MOBILE_WARNING_INSTRUCTION),1),n("button",{onClick:t[0]||(t[0]=(...o)=>a.handleMobileWarningClose&&a.handleMobileWarningClose(...o)),class:"warning-button"},h(i.MESSAGES.MOBILE_WARNING_OK_BUTTON),1)])])):H("",!0),n("div",V,[n("section",{class:"scrollable-container",onWheel:t[3]||(t[3]=c((...o)=>a.handleScroll&&a.handleScroll(...o),["prevent"])),ref:"scrollContainer"},[n("div",j,[(r(!0),l(u,null,_(i.monthDays,(o,I)=>(r(),l("div",{key:I,class:y([{"today-column":a.isToday(o.date)},"day-column"]),onDragover:t[2]||(t[2]=c(()=>{},["prevent"]))},[n("div",null,[n("div",{class:y(["day-cell",a.getDayCellClasses(o)]),title:a.getHolidayTooltip(o.date)},[n("div",X,h(i.daysOfWeek[o.date.getDay()]),1),n("div",{class:"shift",onDragover:t[1]||(t[1]=c(()=>{},["prevent"]))},[n("div",Q,h(o.date.getDate()),1),(r(!0),l(u,null,_(i.SHIFT_TYPES,g=>(r(),w(S,{key:g,day:o,"shift-type":g,"is-editing":s.isEditingMode,onDrop:A=>a.handleDrop(o.date,g),onReset:A=>a.handleClickResetShift(o,g)},null,8,["day","shift-type","is-editing","onDrop","onReset"]))),128))],32)],10,z)])],34))),128))])],544)])],64)}const ae=M(x,[["render",Z],["__scopeId","data-v-031081f7"]]);export{ae as default};
