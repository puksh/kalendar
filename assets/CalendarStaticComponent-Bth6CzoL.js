import{d as k}from"./daysOfWeek-C19XqJ9X.js";import{addNotification as w}from"./NotificationMessage-D02pITJL.js";import{_ as p,o as a,c as o,a as n,t as d,d as v,F as f,r as m,n as S,e as y}from"./index-BGUQuMRx.js";const D={name:"CalendarComponent",data(){return{selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),monthDays:[],localData:{},changedShifts:{},syncedChanges:{},daysOfWeek:k,currentDate:new Date,people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0},{id:8,name:"Alina",ratownik:!1},{id:9,name:"Ewelina",ratownik:!1},{id:7,name:"Teresa",ratownik:!1}],locale:"pl",scrollContainer:null}},computed:{monthYear(){return new Date(this.selectedYear,this.selectedMonth).toLocaleString(this.locale,{month:"long",year:"numeric"})}},methods:{resolvePersonName(s){const e=this.people.find(i=>i.id===s);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const s=this.selectedYear,e=this.selectedMonth,i=new Date(s,e+1,0).getDate();this.monthDays=[];for(let l=1;l<=i;l++)this.monthDays.push({date:new Date(s,e,l),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage()},changeMonth(s){if(this.madeChanges){if(!confirm("You have unsaved changes. Are you sure you want to switch the month? Your changes will be discarded."))return;this.changedShifts={}}this.selectedMonth=this.selectedMonth+s,this.generateMonthDays()},async fetchServerShiftData(){this.syncedChanges={};try{const s=await fetch("https://vuecalendar.kot.li/?key=shiftData.json",{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw s.status===404&&w("Data not found on server","red"),new Error(`Failed to fetch data from server: ${s.status}`);return await s.json()}catch(s){return console.error("Error fetching data from server:",s),w("Failed to fetch data from server","red"),null}},async checkShiftDataSync(){this.resetSyncedChangesSessionStorage();const s=await this.fetchServerShiftData();if(!s){console.log("No remote data fetched.");return}const e={};for(const[i,l]of Object.entries(s)){const r=localStorage.getItem(i),h=r?JSON.parse(r):null,t={};if(!h)e[i]={...l},localStorage.setItem(i,JSON.stringify(l));else{for(const[c,g]of Object.entries(l)){const u=h[c]||null;u!==g&&(t[c]={from:u||"Empty",to:g||"Empty"})}Object.keys(t).length>0&&(e[i]=t),localStorage.setItem(i,JSON.stringify(l))}}this.generateMonthDays(),this.syncedChanges=e,console.log("Updated syncedChanges:",this.syncedChanges),sessionStorage.setItem("syncedChanges",JSON.stringify(this.syncedChanges)),setTimeout(()=>{console.log("Clearing syncedChanges."),this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3)},loadFromLocalStorage(){const s=this.selectedYear,e=this.selectedMonth;for(let i=1;i<=31;i++){const l=new Date(s,e,i).toDateString();if(this.syncedChanges[l])continue;const r=localStorage.getItem(l);if(r)try{const h=JSON.parse(r),t=this.monthDays.find(c=>c.date.toDateString()===l);if(t){t.dayShift1=h.dayShift1,t.dayShift2=h.dayShift2,t.nightShift1=h.nightShift1,t.nightShift2=h.nightShift2;const c=this.resolvePersonName(t.dayShift1);t.dayShift1Name=c.name,t.dayShift1Ratownik=c.isRatownik;const g=this.resolvePersonName(t.dayShift2);t.dayShift2Name=g.name,t.dayShift2Ratownik=g.isRatownik;const u=this.resolvePersonName(t.nightShift1);t.nightShift1Name=u.name,t.nightShift1Ratownik=u.isRatownik;const C=this.resolvePersonName(t.nightShift2);t.nightShift2Name=C.name,t.nightShift2Ratownik=C.isRatownik}}catch(h){w("Failed to load local data: "+h,"red")}}this.calculateAllShiftCounts()},resetSyncedChangesSessionStorage(){const s=sessionStorage.getItem("syncedChanges");s&&(this.syncedChanges=JSON.parse(s),setTimeout(()=>{this.syncedChanges={},sessionStorage.removeItem("syncedChanges")},5e3))},handleScroll(s){this.scrollContainer&&(s.preventDefault(),this.scrollContainer.scrollLeft+=s.deltaY)},getDayClass(s){return k[s]==="Nd"?"nd-color":k[s]==="Sob"?"sob-color":"normal-color"},countShiftsForPerson(s){if(!s)return 0;let e=0;for(let i=0;i<this.monthDays.length;i++)this.monthDays[i].dayShift1===s&&(e+=1),this.monthDays[i].dayShift2===s&&(e+=1),this.monthDays[i].nightShift1===s&&(e+=1),this.monthDays[i].nightShift2===s&&(e+=1);return e},calculateAllShiftCounts(){this.people.forEach(s=>{s.shiftCount=this.countShiftsForPerson(s.id)})}},async mounted(){await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer}},N={class:"monthChange"},_={style:{"font-weight":"bold"}},M={class:"calendar-container"},b={class:"calendar-grid"},R={class:"day-header"},O={class:"shift"},x={class:"day-date"},F={key:0,class:"assigned-person"},Y={key:1,class:"empty-slot"},z={key:0,class:"assigned-person"},P={key:1,class:"empty-slot"},E={key:0,class:"assigned-person"},j={key:1,class:"empty-slot"},J={key:0,class:"assigned-person"},T={key:1,class:"empty-slot"},U={class:"people-list"},A={class:"person-lists"},I={class:"person-lists"},L={class:"shift-counts-window"},W={style:{display:"flex","flex-direction":"row"}},V={style:{display:"flex","flex-direction":"column"}},B={class:"shift-counts"},G={style:{display:"flex","flex-direction":"column"}},Z={class:"shift-counts"};function q(s,e,i,l,r,h){return a(),o(f,null,[n("section",null,[n("section",N,[n("button",{class:"buttonMonthChange",onClick:e[0]||(e[0]=t=>h.changeMonth(-1))}," ‹ "),n("span",_,d(h.monthYear.toUpperCase()),1),n("button",{class:"buttonMonthChange",onClick:e[1]||(e[1]=t=>h.changeMonth(1))},"›")]),n("button",{class:"top-right-buttons buttonRefresh",onClick:e[2]||(e[2]=t=>h.checkShiftDataSync())},e[4]||(e[4]=[n("img",{src:"/assets/icons/refresh.svg",style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Refresh"},null,-1)]))]),n("div",M,[n("section",{class:"scrollable-container",onWheel:e[3]||(e[3]=v((...t)=>h.handleScroll&&h.handleScroll(...t),["prevent"])),ref:"scrollContainer"},[n("div",b,[(a(!0),o(f,null,m(r.monthDays,(t,c)=>(a(),o("div",{key:c,class:"day-column"},[n("div",null,[n("div",{class:S(["day-cell",{"current-month":t.isCurrentMonth,"nd-color":r.daysOfWeek[t.date.getDay()]==="Nd","sob-color":r.daysOfWeek[t.date.getDay()]==="Sob"}])},[n("div",R,d(r.daysOfWeek[t.date.getDay()]),1),n("div",O,[n("div",x,d(t.date.getDate()),1),n("div",{class:S(["shift-slot day",{"synced-changed":r.syncedChanges[t.date.toDateString()]?.dayShift1,ratownik:t.dayShift1Ratownik===!0,userChanged:t.dayShift1UserChanged===!0}])},[t.dayShift1?(a(),o("div",F,d(t.dayShift1Name),1)):(a(),o("div",Y,"D"))],2),n("div",{class:S(["shift-slot day",{"synced-changed":r.syncedChanges[t.date.toDateString()]?.dayShift2,ratownik:t.dayShift2Ratownik===!0,userChanged:t.dayShift2UserChanged===!0}])},[t.dayShift2?(a(),o("div",z,d(t.dayShift2Name),1)):(a(),o("div",P,"D"))],2),n("div",{class:S(["shift-slot night",{"synced-changed":r.syncedChanges[t.date.toDateString()]?.nightShift1,ratownik:t.nightShift1Ratownik===!0,userChanged:t.nightShift1UserChanged===!0}])},[t.nightShift1?(a(),o("div",E,d(t.nightShift1Name),1)):(a(),o("div",j,"N"))],2),n("div",{class:S(["shift-slot night",{"synced-changed":r.syncedChanges[t.date.toDateString()]?.nightShift2,ratownik:t.nightShift2Ratownik===!0,userChanged:t.nightShift2UserChanged===!0}])},[t.nightShift2?(a(),o("div",J,d(t.nightShift2Name),1)):(a(),o("div",T,"N"))],2)])],2)])]))),128))])],544)]),n("section",U,[e[7]||(e[7]=n("h3",{style:{"font-weight":"bold"}},"Zespół",-1)),n("div",null,[e[5]||(e[5]=n("h4",null,"Ratowniczki/cy",-1)),n("div",A,[(a(!0),o(f,null,m(r.people.filter(t=>t.ratownik),t=>(a(),o("div",{key:t.id,class:"person-item ratownik"},d(t.name),1))),128))]),e[6]||(e[6]=n("h4",null,"Pielęgniarki/rze",-1)),n("div",I,[(a(!0),o(f,null,m(r.people.filter(t=>!t.ratownik),t=>(a(),o("div",{key:t.id,class:"person-item"},d(t.name),1))),128))])])]),n("section",L,[e[12]||(e[12]=n("h3",null,"Ilość zmian",-1)),n("div",W,[n("div",V,[e[9]||(e[9]=n("h4",null,"Ratowniczki/cy",-1)),n("ul",B,[(a(!0),o(f,null,m(r.people.filter(t=>t.ratownik),t=>(a(),o("li",{key:t.id},[y(d(t.name)+": ",1),n("strong",null,d(t.shiftCount||0),1),e[8]||(e[8]=y(" zmian/a "))]))),128))])]),n("div",G,[e[11]||(e[11]=n("h4",null,"Pielęgniarki/rze",-1)),n("ul",Z,[(a(!0),o(f,null,m(r.people.filter(t=>!t.ratownik),t=>(a(),o("li",{key:t.id},[y(d(t.name)+": ",1),n("strong",null,d(t.shiftCount||0),1),e[10]||(e[10]=y(" zmian/a "))]))),128))])])])])],64)}const X=p(D,[["render",q],["__scopeId","data-v-6e99b37a"]]);export{X as default};
