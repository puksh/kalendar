import{d as g,i as P,c as N,l as v,g as L,b as w,s as E,v as T,a as b}from"./shiftManagement-DwD8WFN1.js";import{N as A,a as m,M as d,_ as F}from"./utils-DxxLyD3D.js";import{i as S,g as O}from"./index-BCWM8ikL.js";import{c as l,o as n,d as f,F as C,a as D,n as y,t as _,p as H,z as I,w as V}from"./vue-vendor-C8we75Ce.js";const U=[{value:"",label:""},{value:"D",label:"D"},{value:"N",label:"N"},{value:"D N",label:"D N"}],Y=["D","N","D N",""],p=["dayShift1","dayShift2","nightShift1","nightShift2"],M=["Milena","Mikołaj","Aleksandra","Joanna","Łukasz","Natalia","Marcin"],x={name:"SpreadsheetView",emits:["update-editing-mode","has-changes","month-days-updated"],props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},components:{NotificationMessage:A},data(){return{editedShifts:{},monthDays:[],localData:{},daysOfWeek:g,madeChanges:!1,scrollContainer:null,isFirstColumnLocked:!1,importedCells:new Set,MESSAGES:d,SHIFT_OPTIONS:U}},computed:{daysInMonth(){return this.monthDays.map(e=>e.date.getDate())},orderedPeople(){return this.people.filter(e=>M.includes(e.name)).sort((e,t)=>M.indexOf(e.name)-M.indexOf(t.name))},lockButtonTooltip(){return this.isFirstColumnLocked?d.UNLOCK_WIDTH:d.LOCK_WIDTH},editCellAriaLabel(){return this.isEditingMode?d.CLICK_TO_EDIT:""},editCellTitle(){return this.isEditingMode?d.CLICK_TO_EDIT:""}},watch:{selectedMonth(){this.generateMonthDays()},selectedYear(){this.generateMonthDays()}},methods:{isEditing(e,t){return this.editedShifts.hasOwnProperty(`${e}-${t}`)},getShiftForPersonAndDay(e,t){const i=this.monthDays.find(h=>h.date.getDate()===t)?.date;return i?O(e,i," "):null},editCell(e,t){if(this.isEditingMode){const i=`${e}-${t}`,h=this.getShiftForPersonAndDay(e,t)||"";this.editedShifts[i]=h}},validateShiftValue(e){const t=e?.trim().toUpperCase()||"";return Y.includes(t)?t:null},clearPersonFromAllShifts(e,t){p.forEach(i=>{e[i]===t&&(e[i]=null,e[i+"Name"]=d.NOT_ASSIGNED,e[i+"UserChanged"]=!0)})},assignPersonToShift(e,t,i){const h=this.people.find(c=>c.id===t);return e[i]?!1:(e[i]=t,e[i+"Name"]=h.name,e[i+"UserChanged"]=!0,!0)},assignDayShift(e,t){return this.assignPersonToShift(e,t,"dayShift1")||this.assignPersonToShift(e,t,"dayShift2")?!0:(m(d.MAX_DAY_PEOPLE,"red"),!1)},assignNightShift(e,t){return this.assignPersonToShift(e,t,"nightShift1")||this.assignPersonToShift(e,t,"nightShift2")?!0:(m(d.MAX_NIGHT_PEOPLE,"red"),!1)},saveShiftData(e,t){const i={dayShift1:e.dayShift1,dayShift2:e.dayShift2,nightShift1:e.nightShift1,nightShift2:e.nightShift2,dayShift1Name:e.dayShift1Name,dayShift2Name:e.dayShift2Name,nightShift1Name:e.nightShift1Name,nightShift2Name:e.nightShift2Name};this.localData[t]=i,sessionStorage.setItem(t,JSON.stringify(i)),this.madeChanges=!0,this.$emit("has-changes",this.madeChanges)},saveShift(e,t){const i=`${e}-${t}`,h=this.validateShiftValue(this.editedShifts[i]),c=this.getDateString(t);if(!c)return;const s=this.findDayByDate(c);if(!s)return;if(p.filter(u=>s[u]===e).forEach(u=>{w(s,u)}),h===""){E(s),delete this.editedShifts[i];return}const r=this.people.find(u=>u.id===e);if(!r)return;const o=(u,k)=>!s[u]&&T(s,u,e,this.people)?(b(s,u,r),!0):!s[k]&&T(s,k,e,this.people)?(b(s,k,r),!0):!1;if(h.includes("D")&&!o("dayShift1","dayShift2")){m(d.MAX_DAY_PEOPLE,"red"),delete this.editedShifts[i];return}if(h.includes("N")&&!o("nightShift1","nightShift2")){m(d.MAX_NIGHT_PEOPLE,"red"),delete this.editedShifts[i];return}E(s),delete this.editedShifts[i],this.madeChanges=!0,this.$emit("has-changes",!0)},generateMonthDays(){this.resetUserChanges(),this.monthDays=L(this.selectedYear,this.selectedMonth),v(this.selectedYear,this.selectedMonth,this.monthDays,this.people),this.$emit("month-days-updated",this.monthDays)},updateChanges(e){this.madeChanges=e,this.$emit("has-changes",this.madeChanges)},loadFromSessionStorage(){v(this.selectedYear,this.selectedMonth,this.monthDays,this.people)},resetUserChanges(){N(),this.localData={},this.editedShifts={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges)},clearUserChangesFromStorage(){N()},isToday(e){return P(e)},isImportedCell(e,t){return this.importedCells.has(`${e}-${t}`)},toggleColumnsLocked(){this.isFirstColumnLocked=!this.isFirstColumnLocked,this.$nextTick(()=>{document.querySelectorAll(".calendar-table th:first-child, .calendar-table td:first-child").forEach(t=>{this.isFirstColumnLocked?t.classList.add("column-locked"):t.classList.remove("column-locked")})})},isHoliday(e){return S(e)},getHeaderCellClasses(e){const t=new Date(this.selectedYear,this.selectedMonth,e);return{"nd-color":g[t.getDay()]==="Nd","sob-color":g[t.getDay()]==="Sob","holiday-color":S(t).isHoliday,"today-column":this.isToday(t)}},getPersonCellClasses(e){return{ratownik:e.ratownik,pielegniarka:!e.ratownik}},getDataCellClasses(e){const t=new Date(this.selectedYear,this.selectedMonth,e);return{"nd-color":g[t.getDay()]==="Nd","sob-color":g[t.getDay()]==="Sob","holiday-color":S(t).isHoliday,today:this.isToday(t)}},getHolidayTooltip(e){const t=new Date(this.selectedYear,this.selectedMonth,e);return S(t).name||""},findDayByDate(e){return this.monthDays.find(t=>t.date.toDateString()===e)},getDateString(e){return this.monthDays.find(t=>t.date.getDate()===e)?.date.toDateString()},handleScroll(e){this.scrollContainer&&(e.preventDefault(),this.scrollContainer.scrollLeft+=e.deltaY)}},mounted(){this.resetUserChanges(),this.generateMonthDays(),this.scrollContainer=this.$refs.scrollContainer}},B={class:"spreadsheet-view"},q={class:"calendar-table"},z=["title"],G={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"white","stroke-width":"2"},K={key:0,d:"M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z"},W={key:1,d:"M8 11V7a4 4 0 0 1 8 0"},X=["title","aria-label"],J=["onClick","aria-label","title"],R=["onUpdate:modelValue","onChange"],j=["value"];function Q(e,t,i,h,c,s){return n(),l("div",B,[f("div",{class:"scrollable-container",onWheel:t[1]||(t[1]=V((...a)=>s.handleScroll&&s.handleScroll(...a),["prevent"])),ref:"scrollContainer"},[f("table",q,[f("thead",null,[f("tr",null,[f("th",null,[f("button",{class:"lock-column-button",onClick:t[0]||(t[0]=(...a)=>s.toggleColumnsLocked&&s.toggleColumnsLocked(...a)),title:s.lockButtonTooltip},[(n(),l("svg",G,[t[2]||(t[2]=f("rect",{x:"7",y:"11",width:"10",height:"10",rx:"1"},null,-1)),c.isFirstColumnLocked?(n(),l("path",K)):(n(),l("path",W))]))],8,z)]),(n(!0),l(C,null,D(s.daysInMonth,a=>(n(),l("th",{key:a,class:y(s.getHeaderCellClasses(a)),title:s.getHolidayTooltip(a),"aria-label":s.getHolidayTooltip(a)},_(a),11,X))),128))])]),f("tbody",null,[(n(!0),l(C,null,D(s.orderedPeople,a=>(n(),l("tr",{key:a.id},[f("td",{class:y(s.getPersonCellClasses(a))},_(a.name),3),(n(!0),l(C,null,D(s.daysInMonth,r=>(n(),l("td",{key:r,class:y(["editable-cell",s.getDataCellClasses(r)]),onClick:o=>s.editCell(a.id,r),"aria-label":s.editCellAriaLabel,title:s.editCellTitle,role:"gridcell"},[!i.isEditingMode||!s.isEditing(a.id,r)?(n(),l("span",{key:0,class:y({"imported-cell":s.isImportedCell(a.id,r)})},_(s.getShiftForPersonAndDay(a.id,r)||""),3)):H((n(),l("select",{key:1,"onUpdate:modelValue":o=>c.editedShifts[`${a.id}-${r}`]=o,onChange:o=>s.saveShift(a.id,r)},[(n(!0),l(C,null,D(c.SHIFT_OPTIONS,o=>(n(),l("option",{key:o.value,value:o.value},_(o.label),9,j))),128))],40,R)),[[I,c.editedShifts[`${a.id}-${r}`]]])],10,J))),128))]))),128))])])],544)])}const se=F(x,[["render",Q],["__scopeId","data-v-47b9980a"]]);export{se as default};
