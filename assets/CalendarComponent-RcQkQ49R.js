import{d as u}from"./daysOfWeek-C19XqJ9X.js";import{N as C,r as b,a as m,c as v,_ as w}from"./utils-BjyM4F9V.js";import{c as r,o as l,h as p,d as h,q as c,F as D,a as N,n as f,t as S}from"./vue-vendor-RtJloCyB.js";const M={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:C},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:u,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1}},methods:{handleDrop(i,e){const n=JSON.parse(localStorage.getItem("draggedPerson"));if(!n)return;const a=this.monthDays.find(d=>d.date.toDateString()===i.toDateString()),o={...a,[e]:n.id};if(o.dayShift1!=null&&o.dayShift2!=null&&o.dayShift1===o.dayShift2||o.nightShift1!=null&&o.nightShift2!=null&&o.nightShift1===o.nightShift2){m("Ta sama osoba na obydwu zmianach.","red");return}const s=n.ratownik;let t=!1;switch(e){case"dayShift1":t=a.dayShift2Ratownik;break;case"dayShift2":t=a.dayShift1Ratownik;break;case"nightShift1":t=a.nightShift2Ratownik;break;case"nightShift2":t=a.nightShift1Ratownik;break}if(s&&t){m("Nie można przypisać dwóch ratowników na jedną zmianę.","red");return}a[e]=n.id,a[`${e}Name`]=n.name,a[`${e}Ratownik`]=n.ratownik,a[`${e}UserChanged`]=!0;const g={dayShift1:a.dayShift1,dayShift2:a.dayShift2,nightShift1:a.nightShift1,nightShift2:a.nightShift2};this.localData[i.toDateString()]=g,localStorage.setItem(i.toDateString(),JSON.stringify(g)),this.madeChanges=!0,this.$emit("has-changes",!0),localStorage.removeItem("draggedPerson")},isDropTarget(i,e){return this.currentDropTarget.date?this.currentDropTarget.date.toDateString()===i.toDateString()&&this.currentDropTarget.shiftType===e:!1},handleClickResetShift(i,e){if(i[e]!==null){i[e]=null,i[e+"Name"]="Usunięto",i[e+"Ratownik"]=null,i[e+"UserChanged"]=!0;const n={dayShift1:i.dayShift1,dayShift2:i.dayShift2,nightShift1:i.nightShift1,nightShift2:i.nightShift2};this.localData[i.date.toDateString()]=n,localStorage.setItem(i.date.toDateString(),JSON.stringify(n)),this.madeChanges=!0,this.$emit("has-changes",!0)}},resolvePersonName(i){const e=this.people.find(n=>n.id===i);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const i=this.selectedYear,e=this.selectedMonth,n=new Date(i,e+1,0).getDate();this.monthDays=[];for(let a=1;a<=n;a++)this.monthDays.push({date:new Date(i,e,a),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(i){this.madeChanges=i,this.$emit("has-changes",i)},emitEditingMode(i){this.$emit("update-editing-mode",i)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await v(()=>this.generateMonthDays())},loadFromLocalStorage(){const i=this.selectedYear,e=this.selectedMonth;for(let n=1;n<=31;n++){const a=new Date(i,e,n).toDateString();if(this.syncedChanges[a])continue;const o=localStorage.getItem(a);if(o)try{const s=JSON.parse(o),t=this.monthDays.find(g=>g.date.toDateString()===a);if(t){t.dayShift1=s.dayShift1,t.dayShift2=s.dayShift2,t.nightShift1=s.nightShift1,t.nightShift2=s.nightShift2;const g=this.resolvePersonName(t.dayShift1);t.dayShift1Name=g.name,t.dayShift1Ratownik=g.isRatownik;const d=this.resolvePersonName(t.dayShift2);t.dayShift2Name=d.name,t.dayShift2Ratownik=d.isRatownik;const k=this.resolvePersonName(t.nightShift1);t.nightShift1Name=k.name,t.nightShift1Ratownik=k.isRatownik;const y=this.resolvePersonName(t.nightShift2);t.nightShift2Name=y.name,t.nightShift2Ratownik=y.isRatownik}}catch(s){m("Failed to load local data: "+s,"red")}}},resetSyncedChangesSessionStorage(){this.syncedChanges=b()},resetUserChanges(){for(const i in localStorage)if(!(i==="isEditingMode"||i==="currentPage")&&localStorage.hasOwnProperty(i))try{const e=JSON.parse(localStorage.getItem(i)||"{}");(e.dayShift1UserChanged||e.dayShift2UserChanged||e.nightShift1UserChanged||e.nightShift2UserChanged)&&localStorage.removeItem(i)}catch{continue}this.localData={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges),this.editedShifts={}},handleScroll(i){this.scrollContainer&&(i.preventDefault(),this.scrollContainer.scrollLeft+=i.deltaY)},scrollToToday(){this.$nextTick(()=>{const i=new Date;if(i.getMonth()===this.selectedMonth&&i.getFullYear()===this.selectedYear){const e=this.monthDays.findIndex(n=>this.isToday(n.date));if(e!==-1&&this.scrollContainer){const n=document.querySelector(".day-cell")?.offsetWidth||0,a=this.scrollContainer.offsetWidth,o=n*e-a/2+n/2;this.scrollContainer.scrollTo({left:Math.max(0,o),behavior:"smooth"})}}})},getDayClass(i){return u[i]==="Nd"?"nd-color":u[i]==="Sob"?"sob-color":"normal-color"},getShiftAriaLabel(i,e){const n=i[e],a=e.includes("day")?"Zmiana dzienna":"Zmiana nocna",o=i[`${e}Name`];return this.isEditingMode?n?`${a}: ${o}. Kliknij aby usunąć zmianę.`:`${a}: Pusta zmiana. Przeciągnij członka zespołu by nadać im zmianę.`:n?`${a}: ${o}`:`${a}: Pusta zmiana.`},getShiftTooltip(i,e){const n=i[e],a=e.includes("day")?"Zmiana dzienna":"Zmiana nocna";return this.isEditingMode?n?`${a}: ${i[`${e}Name`]} (Kliknij by usunąć)`:`Przeciągnij członka zespołu by nadać im - ${a.toLowerCase()}`:n?`${a}: ${i[`${e}Name`]}`:`${a}: Nieprzypisana`},checkMobilePlatform(){const i=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(i.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(i){const e=new Date;return i.getDate()===e.getDate()&&i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.scrollToToday(),this.checkMobilePlatform()},watch:{isEditingMode(i){localStorage.setItem("isEditingMode",JSON.stringify(i)),i&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays(),this.scrollToToday()},selectedYear(){this.generateMonthDays()}}},_={key:0,class:"mobile-warning-overlay"},R={class:"mobile-warning"},z={class:"calendar-container"},U={class:"calendar-grid"},E=["onDrop"],P={class:"day-header"},W=["onDrop"],T={class:"day-date"},O=["clickable","onDrop","onClick","aria-label","title"],L={key:0,class:"assigned-person"},x={key:1,class:"assigned-person deleted"},I={key:2,class:"empty-slot"},j=["clickable","onDrop","onClick","aria-label","title"],A={key:0,class:"assigned-person"},Y={key:1,class:"assigned-person deleted"},F={key:2,class:"empty-slot"},q=["onDrop","onClick","aria-label","title"],J={key:0,class:"assigned-person"},B={key:1,class:"assigned-person deleted"},Z={key:2,class:"empty-slot"},K=["clickable","onDrop","onClick","aria-label","title"],V={key:0,class:"assigned-person"},G={key:1,class:"assigned-person deleted"},H={key:2,class:"empty-slot"};function Q(i,e,n,a,o,s){return l(),r(D,null,[o.showMobileWarning?(l(),r("div",_,[h("div",R,[e[7]||(e[7]=h("h3",null,"!! Urządzenie mobilne wykryte !!",-1)),e[8]||(e[8]=h("p",null," Niestety, tryb edycji w widoku kalendarza nie jest obsługiwany na urządzeniach mobilnych. ",-1)),e[9]||(e[9]=h("p",null,"Proszę przejdź do widoku tabeli lub skorzystaj z komputera.",-1)),h("button",{onClick:e[0]||(e[0]=(...t)=>s.handleMobileWarningClose&&s.handleMobileWarningClose(...t)),class:"warning-button"}," Ok ☹ ")])])):p("",!0),h("div",z,[h("section",{class:"scrollable-container",onWheel:e[6]||(e[6]=c((...t)=>s.handleScroll&&s.handleScroll(...t),["prevent"])),ref:"scrollContainer"},[h("div",U,[(l(!0),r(D,null,N(o.monthDays,(t,g)=>(l(),r("div",{key:g,class:f({"today-column":s.isToday(t.date)}),onDragover:e[5]||(e[5]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"day")},[h("div",null,[h("div",{class:f(["day-cell",{"current-month":t.isCurrentMonth,"nd-color":o.daysOfWeek[t.date.getDay()]==="Nd","sob-color":o.daysOfWeek[t.date.getDay()]==="Sob",today:s.isToday(t.date)}])},[h("div",P,S(o.daysOfWeek[t.date.getDay()]),1),h("div",{class:"shift",onDrop:d=>s.handleDrop(t.date,"day"),onDragover:e[4]||(e[4]=c(()=>{},["prevent"]))},[h("div",T,S(t.date.getDate()),1),h("div",{class:f(["shift-slot day",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.dayShift1,ratownik:t.dayShift1Ratownik===!0,pielegniarka:t.dayShift1Ratownik===!1,userChanged:t.dayShift1UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDragover:e[1]||(e[1]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"dayShift1"),onClick:d=>n.isEditingMode&&s.handleClickResetShift(t,"dayShift1"),"aria-label":s.getShiftAriaLabel(t,"dayShift1"),title:s.getShiftTooltip(t,"dayShift1"),role:"button",tabindex:"0"},[t.dayShift1?(l(),r("div",L,S(t.dayShift1Name),1)):t.dayShift1UserChanged?(l(),r("div",x," Usunięto ")):(l(),r("div",I,"D"))],42,O),h("div",{class:f(["shift-slot day",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.dayShift2,ratownik:t.dayShift2Ratownik===!0,pielegniarka:t.dayShift2Ratownik===!1,userChanged:t.dayShift2UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDrop:d=>s.handleDrop(t.date,"dayShift2"),onClick:d=>n.isEditingMode&&s.handleClickResetShift(t,"dayShift2"),"aria-label":s.getShiftAriaLabel(t,"dayShift2"),title:s.getShiftTooltip(t,"dayShift2"),role:"button",tabindex:"0"},[t.dayShift2?(l(),r("div",A,S(t.dayShift2Name),1)):t.dayShift2UserChanged?(l(),r("div",Y," Usunięto ")):(l(),r("div",F,"D"))],42,j),h("div",{class:f(["shift-slot night",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.nightShift1,ratownik:t.nightShift1Ratownik===!0,pielegniarka:t.nightShift1Ratownik===!1,userChanged:t.nightShift1UserChanged===!0,clickable:n.isEditingMode}]),onDragover:e[2]||(e[2]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"nightShift1"),onClick:d=>n.isEditingMode&&s.handleClickResetShift(t,"nightShift1"),"aria-label":s.getShiftAriaLabel(t,"nightShift1"),title:s.getShiftTooltip(t,"nightShift1"),role:"button",tabindex:"0"},[t.nightShift1?(l(),r("div",J,S(t.nightShift1Name),1)):t.nightShift1UserChanged?(l(),r("div",B," Usunięto ")):(l(),r("div",Z,"N"))],42,q),h("div",{class:f(["shift-slot night",{"synced-changed":o.syncedChanges[t.date.toDateString()]?.nightShift2,ratownik:t.nightShift2Ratownik===!0,pielegniarka:t.nightShift2Ratownik===!1,userChanged:t.nightShift2UserChanged===!0,clickable:n.isEditingMode}]),clickable:n.isEditingMode,onDragover:e[3]||(e[3]=c(()=>{},["prevent"])),onDrop:d=>s.handleDrop(t.date,"nightShift2"),onClick:d=>n.isEditingMode&&s.handleClickResetShift(t,"nightShift2"),"aria-label":s.getShiftAriaLabel(t,"nightShift2"),title:s.getShiftTooltip(t,"nightShift2"),role:"button",tabindex:"0"},[t.nightShift2?(l(),r("div",V,S(t.nightShift2Name),1)):t.nightShift2UserChanged?(l(),r("div",G," Usunięto ")):(l(),r("div",H,"N"))],42,K)],40,W)],2)])],42,E))),128))])],544)])],64)}const et=w(M,[["render",Q],["__scopeId","data-v-6ae91591"]]);export{et as default};
