import{d as m}from"./daysOfWeek-C19XqJ9X.js";import{_ as k,N as w,a as y,r as v,c as A}from"./utils-oZnrSTRW.js";import{i as N}from"./index-BZP-VYtB.js";import{c,o as l,t as d,w as f,n as _,h as R,e as b,d as r,F as D,a as T,i as O}from"./vue-vendor-DIMlJxEK.js";function P(e,t,i){const n=new Date(e,t+1,0).getDate(),s=[];for(let a=1;a<=n;a++)s.push({date:new Date(e,t,a),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});return s}function L(e){const t=this.people.find(i=>i.id===e);return t?{name:t.name,isRatownik:t.ratownik}:{name:void 0,isRatownik:!1}}function F(e,t){switch(t){case"dayShift1":return e.dayShift2Ratownik;case"dayShift2":return e.dayShift1Ratownik;case"nightShift1":return e.nightShift2Ratownik;case"nightShift2":return e.nightShift1Ratownik}}function G(e,t,i){e[t]=i.id,e[`${t}Name`]=i.name,e[`${t}Ratownik`]=i.ratownik,e[`${t}UserChanged`]=!0}function C(e){const t=e.date.toDateString(),i={dayShift1:e.dayShift1,dayShift2:e.dayShift2,nightShift1:e.nightShift1,nightShift2:e.nightShift2};this.localData[t]=i,localStorage.setItem(t,JSON.stringify(i))}function U(e,t,i){return t==="dayShift1"&&e.dayShift2===i||t==="dayShift2"&&e.dayShift1===i||t==="nightShift1"&&e.nightShift2===i||t==="nightShift2"&&e.nightShift1===i}function z(e){for(const t in localStorage)if(!(t==="isEditingMode"||t==="currentPage")&&localStorage.hasOwnProperty(t))try{const i=JSON.parse(localStorage.getItem(t)||"{}");(i.dayShift1UserChanged||i.dayShift2UserChanged||i.nightShift1UserChanged||i.nightShift2UserChanged)&&localStorage.removeItem(t)}catch{continue}return{localData:{},madeChanges:!1}}function E(e){const t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}const h={DELETED:"Usunięto",DAY_SHIFT:"Zmiana dzienna",NIGHT_SHIFT:"Zmiana nocna",CLICK_TO_REMOVE:"Kliknij aby usunąć zmianę",EMPTY_SHIFT:"Pusta zmiana",DRAG_TO_ASSIGN:"Przeciągnij członka zespołu by nadać im zmianę",CLICK_TO_DELETE:"Kliknij by usunąć",DRAG_TO_ASSIGN_SHIFT:"Przeciągnij członka zespołu by nadać im",UNASSIGNED:"Nieprzypisana"},W={name:"CalendarShiftSlotComponent",emits:["drop","reset"],props:{day:{type:Object,required:!0},shiftType:{type:String,required:!0},isEditing:{type:Boolean,default:!1}},data(){return{MESSAGES:h}},computed:{isNightShift(){return this.shiftType.includes("night")},isDayShift(){return this.shiftType.includes("day")},shiftName(){return this.isDayShift?h.DAY_SHIFT:h.NIGHT_SHIFT},hasAssignedPerson(){return!!this.day[this.shiftType]},assignedPersonName(){return this.day[this.shiftType+"Name"]},isUserChanged(){return this.day[this.shiftType+"UserChanged"]},isRatownik(){return this.day[this.shiftType+"Ratownik"]===!0},isPielegniarka(){return this.day[this.shiftType+"Ratownik"]===!1}},methods:{getShiftSlotClasses(){return{day:this.isDayShift,night:this.isNightShift,ratownik:this.isRatownik,pielegniarka:this.isPielegniarka,userChanged:this.isUserChanged,clickable:this.isEditing}},getShiftAriaLabel(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}. ${h.CLICK_TO_REMOVE}.`:`${this.shiftName}: ${h.EMPTY_SHIFT}. ${h.DRAG_TO_ASSIGN}.`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${h.EMPTY_SHIFT}.`},getShiftTooltip(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName} (${h.CLICK_TO_DELETE})`:`${h.DRAG_TO_ASSIGN_SHIFT} - ${this.shiftName.toLowerCase()}`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${h.UNASSIGNED}`}}},H=["aria-label","title"],$={key:0,class:"assigned-person"},B={key:1,class:"assigned-person deleted"},Y={key:2,class:"empty-slot"};function K(e,t,i,n,s,a){return l(),c("div",{class:_(["shift-slot",a.getShiftSlotClasses()]),onDragover:t[0]||(t[0]=f(()=>{},["prevent"])),onDrop:t[1]||(t[1]=g=>e.$emit("drop")),onClick:t[2]||(t[2]=g=>i.isEditing&&e.$emit("reset")),"aria-label":a.getShiftAriaLabel(),title:a.getShiftTooltip(),role:"button",tabindex:"0"},[i.day[i.shiftType]?(l(),c("div",$,d(i.day[i.shiftType+"Name"]),1)):i.day[i.shiftType+"UserChanged"]?(l(),c("div",B,d(s.MESSAGES.DELETED),1)):(l(),c("div",Y,d(i.shiftType.includes("day")?"D":"N"),1))],42,H)}const j=k(W,[["render",K],["__scopeId","data-v-2cfe5a74"]]),u={MOBILE_WARNING_TITLE:"!! Urządzenie mobilne wykryte !!",MOBILE_WARNING_TEXT:"Niestety, tryb edycji w widoku kalendarza nie jest obsługiwany na urządzeniach mobilnych.",MOBILE_WARNING_INSTRUCTION:"Proszę przejdź do widoku tabeli lub skorzystaj z komputera.",OK_BUTTON:"Ok ☹",DUPLICATE_SHIFT:"Ta sama osoba na obydwu zmianach.",TWO_RATOWNIK_ERROR:"Nie można przypisać dwóch ratowników na jedną zmianę.",LOAD_ERROR:"Failed to load local data: "},p=["dayShift1","dayShift2","nightShift1","nightShift2"],q=31,x={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:w,ShiftSlot:j},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:m,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1,MESSAGES:u,SHIFT_TYPES:p}},computed:{holidayInfo(){return this.monthDays.map(e=>N(e.date))}},methods:{handleDrop(e,t){const i=this.getDraggedPersonFromStorage();if(!i)return;const n=this.findDayByDate(e);this.validateShiftAssignment(n,t,i)&&(this.assignShiftToDay(n,t,i),this.markChangesAndEmit(),this.clearDraggedPersonFromStorage())},isDropTarget(e,t){return this.currentDropTarget.date?this.currentDropTarget.date.toDateString()===e.toDateString()&&this.currentDropTarget.shiftType===t:!1},handleClickResetShift(e,t){e[t]!==null&&(e[t]=null,e[t+"Name"]="Usunięto",e[t+"Ratownik"]=null,e[t+"UserChanged"]=!0,C.call(this,e),this.madeChanges=!0,this.$emit("has-changes",!0))},resolvePersonName(e){return L.call(this,e)},generateMonthDays(){this.monthDays=P(this.selectedYear,this.selectedMonth),this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(e){this.madeChanges=e,this.$emit("has-changes",e)},emitEditingMode(e){this.$emit("update-editing-mode",e)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await A(()=>this.generateMonthDays())},loadFromLocalStorage(){const{year:e,month:t}={year:this.selectedYear,month:this.selectedMonth};for(let i=1;i<=q;i++)this.loadDayFromStorage(e,t,i)},loadDayFromStorage(e,t,i){const n=new Date(e,t,i).toDateString(),s=localStorage.getItem(n);if(s)try{const a=JSON.parse(s),g=this.findDayByDate(new Date(n));g&&this.applyStoredStatesToDay(g,a)}catch(a){y(u.LOAD_ERROR+a,"red")}},applyStoredStatesToDay(e,t){p.forEach(i=>{e[i]=t[i];const n=this.resolvePersonName(e[i]);e[i+"Name"]=n.name,e[i+"Ratownik"]=n.isRatownik})},resetSyncedChangesSessionStorage(){this.syncedChanges=v()},resetUserChanges(){const e=z();this.localData=e.localData,this.madeChanges=e.madeChanges,this.$emit("has-changes",this.madeChanges)},handleScroll(e){this.scrollContainer&&(e.preventDefault(),this.scrollContainer.scrollLeft+=e.deltaY)},scrollToToday(){this.$nextTick(()=>{const e=new Date;if(e.getMonth()===this.selectedMonth&&e.getFullYear()===this.selectedYear){const t=this.monthDays.findIndex(i=>E(i.date));if(t!==-1&&this.scrollContainer){const i=document.querySelector(".day-cell")?.offsetWidth||0,n=this.scrollContainer.offsetWidth,s=i*t-n/2+i/2;this.scrollContainer.scrollTo({left:Math.max(0,s),behavior:"smooth"})}}})},getDayCellClasses(e){return{"current-month":e.isCurrentMonth,"nd-color":m[e.date.getDay()]==="Nd","sob-color":m[e.date.getDay()]==="Sob","holiday-color":this.isHoliday(e.date).isHoliday,today:this.isToday(e.date)}},getHolidayTooltip(e){return this.isHoliday(e).name||""},validateShiftAssignment(e,t,i){return U(e,t,i.id)?(y(u.DUPLICATE_SHIFT,"red"),!1):i.ratownik&&F(e,t)?(y(u.TWO_RATOWNIK_ERROR,"red"),!1):!0},getDraggedPersonFromStorage(){const e=localStorage.getItem("draggedPerson");return e?JSON.parse(e):null},findDayByDate(e){return this.monthDays.find(t=>t.date.toDateString()===e.toDateString())},assignShiftToDay(e,t,i){G(e,t,i),C.call(this,e)},markChangesAndEmit(){this.madeChanges=!0,this.$emit("has-changes",!0)},clearDraggedPersonFromStorage(){localStorage.removeItem("draggedPerson")},checkMobilePlatform(){const e=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(e.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(e){return E(e)},isHoliday(e){return N(e)}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.scrollToToday(),this.checkMobilePlatform()},watch:{isEditingMode(e){localStorage.setItem("isEditingMode",JSON.stringify(e)),e&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays(),this.scrollToToday()},selectedYear(){this.generateMonthDays()}}},J={key:0,class:"mobile-warning-overlay"},V={class:"mobile-warning"},X={class:"calendar-container"},Z={class:"calendar-grid"},Q=["onDrop"],ee=["title"],te={class:"day-header"},ie=["onDrop"],ae={class:"day-date"};function se(e,t,i,n,s,a){const g=R("shift-slot");return l(),c(D,null,[s.showMobileWarning?(l(),c("div",J,[r("div",V,[r("h3",null,d(s.MESSAGES.MOBILE_WARNING_TITLE),1),r("p",null,d(s.MESSAGES.MOBILE_WARNING_TEXT),1),r("p",null,d(s.MESSAGES.MOBILE_WARNING_INSTRUCTION),1),r("button",{onClick:t[0]||(t[0]=(...o)=>a.handleMobileWarningClose&&a.handleMobileWarningClose(...o)),class:"warning-button"},d(s.MESSAGES.OK_BUTTON),1)])])):b("",!0),r("div",X,[r("section",{class:"scrollable-container",onWheel:t[3]||(t[3]=f((...o)=>a.handleScroll&&a.handleScroll(...o),["prevent"])),ref:"scrollContainer"},[r("div",Z,[(l(!0),c(D,null,T(s.monthDays,(o,I)=>(l(),c("div",{key:I,class:_({"today-column":a.isToday(o.date)}),onDragover:t[2]||(t[2]=f(()=>{},["prevent"])),onDrop:S=>a.handleDrop(o.date,"day")},[r("div",null,[r("div",{class:_(["day-cell",a.getDayCellClasses(o)]),title:a.getHolidayTooltip(o.date)},[r("div",te,d(s.daysOfWeek[o.date.getDay()]),1),r("div",{class:"shift",onDrop:S=>a.handleDrop(o.date,"day"),onDragover:t[1]||(t[1]=f(()=>{},["prevent"]))},[r("div",ae,d(o.date.getDate()),1),(l(!0),c(D,null,T(s.SHIFT_TYPES,S=>(l(),O(g,{key:S,day:o,"shift-type":S,"is-editing":i.isEditingMode,onDrop:M=>a.handleDrop(o.date,S),onReset:M=>a.handleClickResetShift(o,S)},null,8,["day","shift-type","is-editing","onDrop","onReset"]))),128))],40,ie)],10,ee)])],42,Q))),128))])],544)])],64)}const le=k(x,[["render",se],["__scopeId","data-v-2448a0dc"]]);export{le as default};
