import{M as f,d as m,c as I,s as N,v as A,a as w}from"./shiftManagement-CXvRfEnl.js";import{_ as M,N as b,a as y,r as P,c as R}from"./utils-BO-MB2ZG.js";import{i as _}from"./index-DY7hY_Hh.js";import{c,o as l,t as d,w as u,n as C,h as O,f as F,d as o,F as D,a as E,k as L}from"./vue-vendor-RF0o26Ul.js";function G(t,e,i){const n=new Date(t,e+1,0).getDate(),a=[];for(let s=1;s<=n;s++)a.push({date:new Date(t,e,s),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});return a}function H(t){const e=this.people.find(i=>i.id===t);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}}function $(t,e){switch(e){case"dayShift1":return t.dayShift2Ratownik;case"dayShift2":return t.dayShift1Ratownik;case"nightShift1":return t.nightShift2Ratownik;case"nightShift2":return t.nightShift1Ratownik}}function W(t,e,i){t[e]=i.id,t[`${e}Name`]=i.name,t[`${e}Ratownik`]=i.ratownik,t[`${e}UserChanged`]=!0}function U(t){const e=t.date.toDateString(),i={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2};this.localData[e]=i,localStorage.setItem(e,JSON.stringify(i))}function Y(t,e,i){return e==="dayShift1"&&t.dayShift2===i||e==="dayShift2"&&t.dayShift1===i||e==="nightShift1"&&t.nightShift2===i||e==="nightShift2"&&t.nightShift1===i}function B(t){for(const e in localStorage)if(!(e==="isEditingMode"||e==="currentPage")&&localStorage.hasOwnProperty(e))try{const i=JSON.parse(localStorage.getItem(e)||"{}");(i.dayShift1UserChanged||i.dayShift2UserChanged||i.nightShift1UserChanged||i.nightShift2UserChanged)&&localStorage.removeItem(e)}catch{continue}return{localData:{},madeChanges:!1}}function T(t){const e=new Date;return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}const h={DELETED:"Usunięto",DAY_SHIFT:"Zmiana dzienna",NIGHT_SHIFT:"Zmiana nocna",CLICK_TO_REMOVE:"Kliknij aby usunąć zmianę",EMPTY_SHIFT:"Pusta zmiana",DRAG_TO_ASSIGN:"Przeciągnij członka zespołu by nadać im zmianę",CLICK_TO_DELETE:"Kliknij by usunąć",DRAG_TO_ASSIGN_SHIFT:"Przeciągnij członka zespołu by nadać im",UNASSIGNED:"Nieprzypisana"},z={name:"CalendarShiftSlotComponent",emits:["drop","reset"],props:{day:{type:Object,required:!0},shiftType:{type:String,required:!0},isEditing:{type:Boolean,default:!1}},data(){return{MESSAGES:h}},computed:{isNightShift(){return this.shiftType.includes("night")},isDayShift(){return this.shiftType.includes("day")},shiftName(){return this.isDayShift?h.DAY_SHIFT:h.NIGHT_SHIFT},hasAssignedPerson(){return!!this.day[this.shiftType]},assignedPersonName(){return this.day[this.shiftType+"Name"]},isUserChanged(){return this.day[this.shiftType+"UserChanged"]},isRatownik(){return this.day[this.shiftType+"Ratownik"]===!0},isPielegniarka(){return this.day[this.shiftType+"Ratownik"]===!1}},methods:{getShiftSlotClasses(){return{day:this.isDayShift,night:this.isNightShift,ratownik:this.isRatownik,pielegniarka:this.isPielegniarka,userChanged:this.isUserChanged,clickable:this.isEditing}},getShiftAriaLabel(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}. ${h.CLICK_TO_REMOVE}.`:`${this.shiftName}: ${h.EMPTY_SHIFT}. ${h.DRAG_TO_ASSIGN}.`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${h.EMPTY_SHIFT}.`},getShiftTooltip(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName} (${h.CLICK_TO_DELETE})`:`${h.DRAG_TO_ASSIGN_SHIFT} - ${this.shiftName.toLowerCase()}`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${h.UNASSIGNED}`}}},K=["aria-label","title"],q={key:0,class:"assigned-person"},x={key:1,class:"assigned-person deleted"},j={key:2,class:"empty-slot"};function J(t,e,i,n,a,s){return l(),c("div",{class:C(["shift-slot",s.getShiftSlotClasses()]),onDragover:e[0]||(e[0]=u(()=>{},["prevent"])),onDrop:e[1]||(e[1]=g=>t.$emit("drop")),onClick:e[2]||(e[2]=g=>i.isEditing&&t.$emit("reset")),"aria-label":s.getShiftAriaLabel(),title:s.getShiftTooltip(),role:"button",tabindex:"0"},[i.day[i.shiftType]?(l(),c("div",q,d(i.day[i.shiftType+"Name"]),1)):i.day[i.shiftType+"UserChanged"]?(l(),c("div",x,d(a.MESSAGES.DELETED),1)):(l(),c("div",j,d(i.shiftType.includes("day")?"D":"N"),1))],42,K)}const V=M(z,[["render",J],["__scopeId","data-v-2cfe5a74"]]),p=["dayShift1","dayShift2","nightShift1","nightShift2"],X=31,Z={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:b,ShiftSlot:V},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:m,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1,MESSAGES:f,SHIFT_TYPES:p}},computed:{holidayInfo(){return this.monthDays.map(t=>_(t.date))}},methods:{handleDrop(t,e){const i=this.getDraggedPersonFromStorage();if(!i)return;const n=this.findDayByDate(t);!n||!A(n,e,i.id,this.people)||(w(n,e,i),N(n),this.markChangesAndEmit(),this.clearDraggedPersonFromStorage())},handleClickResetShift(t,e){t[e]!==null&&(I(t,e),N(t),this.madeChanges=!0,this.$emit("has-changes",!0))},resolvePersonName(t){return H.call(this,t)},generateMonthDays(){this.monthDays=G(this.selectedYear,this.selectedMonth),this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(t){this.madeChanges=t,this.$emit("has-changes",t)},emitEditingMode(t){this.$emit("update-editing-mode",t)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await R(()=>this.generateMonthDays())},loadFromLocalStorage(){const{year:t,month:e}={year:this.selectedYear,month:this.selectedMonth};for(let i=1;i<=X;i++)this.loadDayFromStorage(t,e,i)},loadDayFromStorage(t,e,i){const n=new Date(t,e,i).toDateString(),a=localStorage.getItem(n);if(a)try{const s=JSON.parse(a),g=this.findDayByDate(new Date(n));g&&this.applyStoredStatesToDay(g,s)}catch(s){y(f.LOAD_ERROR+s,"red")}},applyStoredStatesToDay(t,e){p.forEach(i=>{t[i]=e[i];const n=this.resolvePersonName(t[i]);t[i+"Name"]=n.name,t[i+"Ratownik"]=n.isRatownik})},resetSyncedChangesSessionStorage(){this.syncedChanges=P()},resetUserChanges(){const t=B();this.localData=t.localData,this.madeChanges=t.madeChanges,this.$emit("has-changes",this.madeChanges)},handleScroll(t){this.scrollContainer&&(t.preventDefault(),this.scrollContainer.scrollLeft+=t.deltaY)},scrollToToday(){this.$nextTick(()=>{const t=new Date;if(t.getMonth()===this.selectedMonth&&t.getFullYear()===this.selectedYear){const e=this.monthDays.findIndex(i=>T(i.date));if(e!==-1&&this.scrollContainer){const i=document.querySelector(".day-cell")?.offsetWidth||0,n=this.scrollContainer.offsetWidth,a=i*e-n/2+i/2;this.scrollContainer.scrollTo({left:Math.max(0,a),behavior:"smooth"})}}})},getDayCellClasses(t){return{"current-month":t.isCurrentMonth,"nd-color":m[t.date.getDay()]==="Nd","sob-color":m[t.date.getDay()]==="Sob","holiday-color":this.isHoliday(t.date).isHoliday,today:this.isToday(t.date)}},getHolidayTooltip(t){return this.isHoliday(t).name||""},validateShiftAssignment(t,e,i){return Y(t,e,i.id)?(y(f.DUPLICATE_SHIFT,"red"),!1):i.ratownik&&$(t,e)?(y(f.TWO_RATOWNIK_ERROR,"red"),!1):!0},getDraggedPersonFromStorage(){const t=localStorage.getItem("draggedPerson");return t?JSON.parse(t):null},findDayByDate(t){return this.monthDays.find(e=>e.date.toDateString()===t.toDateString())},assignShiftToDay(t,e,i){W(t,e,i),U.call(this,t)},markChangesAndEmit(){this.madeChanges=!0,this.$emit("has-changes",!0)},clearDraggedPersonFromStorage(){localStorage.removeItem("draggedPerson")},checkMobilePlatform(){const t=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(t.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(t){return T(t)},isHoliday(t){return _(t)}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.scrollToToday(),this.checkMobilePlatform()},watch:{isEditingMode(t){localStorage.setItem("isEditingMode",JSON.stringify(t)),t&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays(),this.scrollToToday()},selectedYear(){this.generateMonthDays()}}},Q={key:0,class:"mobile-warning-overlay"},tt={class:"mobile-warning"},et={class:"calendar-container"},it={class:"calendar-grid"},st=["title"],at={class:"day-header"},nt={class:"day-date"};function ot(t,e,i,n,a,s){const g=O("shift-slot");return l(),c(D,null,[a.showMobileWarning?(l(),c("div",Q,[o("div",tt,[o("h3",null,d(a.MESSAGES.MOBILE_WARNING_TITLE),1),o("p",null,d(a.MESSAGES.MOBILE_WARNING_TEXT),1),o("p",null,d(a.MESSAGES.MOBILE_WARNING_INSTRUCTION),1),o("button",{onClick:e[0]||(e[0]=(...r)=>s.handleMobileWarningClose&&s.handleMobileWarningClose(...r)),class:"warning-button"},d(a.MESSAGES.MOBILE_WARNING_OK_BUTTON),1)])])):F("",!0),o("div",et,[o("section",{class:"scrollable-container",onWheel:e[3]||(e[3]=u((...r)=>s.handleScroll&&s.handleScroll(...r),["prevent"])),ref:"scrollContainer"},[o("div",it,[(l(!0),c(D,null,E(a.monthDays,(r,k)=>(l(),c("div",{key:k,class:C({"today-column":s.isToday(r.date)}),onDragover:e[2]||(e[2]=u(()=>{},["prevent"]))},[o("div",null,[o("div",{class:C(["day-cell",s.getDayCellClasses(r)]),title:s.getHolidayTooltip(r.date)},[o("div",at,d(a.daysOfWeek[r.date.getDay()]),1),o("div",{class:"shift",onDragover:e[1]||(e[1]=u(()=>{},["prevent"]))},[o("div",nt,d(r.date.getDate()),1),(l(!0),c(D,null,E(a.SHIFT_TYPES,S=>(l(),L(g,{key:S,day:r,"shift-type":S,"is-editing":i.isEditingMode,onDrop:v=>s.handleDrop(r.date,S),onReset:v=>s.handleClickResetShift(r,S)},null,8,["day","shift-type","is-editing","onDrop","onReset"]))),128))],32)],10,st)])],34))),128))])],544)])],64)}const ct=M(Z,[["render",ot],["__scopeId","data-v-33052e55"]]);export{ct as default};
