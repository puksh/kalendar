import{_ as w,o as l,c as f,a as r,t as g,F as S,e as u,n as N,w as k,h as p}from"./index-COIOp8vu.js";const M={name:"SpreadsheetView",props:{monthDays:Array,people:Array},data(){return{isEditingMode:!1,editedShifts:{},selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),monthDays:[],madeChanges:!1,people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0},{id:8,name:"Alina",ratownik:!1},{id:9,name:"Ewelina",ratownik:!1},{id:7,name:"Teresa",ratownik:!1}],locale:"pl"}},computed:{daysInMonth(){return this.monthDays.map(t=>t.date.getDate())},orderedPeople(){const t=["Milena","Mikołaj","Aleksandra","Joanna","Łukasz","Natalia","Marcin"];return this.people.filter(e=>t.includes(e.name)).sort((e,s)=>t.indexOf(e.name)-t.indexOf(s.name))},monthYear(){return new Date(this.selectedYear,this.selectedMonth).toLocaleString(this.locale,{month:"long",year:"numeric"})}},methods:{toggleEditingMode(){this.isEditingMode=!this.isEditingMode},isEditing(t,e){return this.editedShifts.hasOwnProperty(`${t}-${e}`)},getShiftForPersonAndDay(t,e){const s=this.monthDays.find(h=>h.date.getDate()===e)?.date.toDateString(),o=localStorage.getItem(s);if(o){const h=JSON.parse(o);return Object.values(h).find(a=>a===t)}return null},editCell(t,e){if(this.isEditingMode){const s=`${t}-${e}`,o=this.getShiftForPersonAndDay(t,e)||"";this.editedShifts[s]=o}},saveShift(t,e){const s=`${t}-${e}`,o=this.editedShifts[s].trim().toUpperCase();if(!["D","N","D N",""].includes(o)){alert("Invalid input! Only 'D', 'N', or 'D N' are allowed."),delete this.editedShifts[s];return}const a=this.monthDays.find(i=>i.date.getDate()===e)?.date.toDateString();if(a){const i=JSON.parse(localStorage.getItem(a)||"{}"),n=this.monthDays.find(c=>c.date.toDateString()===a);if(o===""){i.dayShift1=null,i.dayShift2=null,i.nightShift1=null,i.nightShift2=null,n.dayShift1=null,n.dayShift2=null,n.nightShift1=null,n.nightShift2=null,localStorage.setItem(a,JSON.stringify(i)),delete this.editedShifts[s];return}const d=this.people.find(c=>c.id===t),m=d?.ratownik,y=[n.dayShift1,n.dayShift2,n.nightShift1,n.nightShift2].filter(Boolean).some(c=>this.people.find(D=>D.id===c)?.ratownik);if(m&&y){alert("Nie można przypisać dwóch ratowników na jedną zmianę."),delete this.editedShifts[s];return}if(o.includes("D"))if(!n.dayShift1)n.dayShift1=t,n.dayShift1Name=d.name;else if(!n.dayShift2)n.dayShift2=t,n.dayShift2Name=d.name;else{alert("Nie można przypisać więcej niż dwóch osób na zmianę dzienną."),delete this.editedShifts[s];return}if(o.includes("N"))if(!n.nightShift1)n.nightShift1=t,n.nightShift1Name=d.name;else if(!n.nightShift2)n.nightShift2=t,n.nightShift2Name=d.name;else{alert("Nie można przypisać więcej niż dwóch osób na zmianę nocną."),delete this.editedShifts[s];return}i.dayShift1=n.dayShift1,i.dayShift2=n.dayShift2,i.nightShift1=n.nightShift1,i.nightShift2=n.nightShift2,localStorage.setItem(a,JSON.stringify(i))}delete this.editedShifts[s]},generateMonthDays(){const t=this.selectedYear,e=this.selectedMonth,s=new Date(t,e+1,0).getDate();this.monthDays=[];for(let o=1;o<=s;o++)this.monthDays.push({date:new Date(t,e,o),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage()},changeMonth(t){this.madeChanges&&!confirm("You have unsaved changes. Are you sure you want to switch the month? Your changes will be discarded.")||(this.selectedMonth=this.selectedMonth+t,this.generateMonthDays())},loadFromLocalStorage(){const t=this.selectedYear,e=this.selectedMonth;for(let s=1;s<=31;s++){const o=new Date(t,e,s).toDateString(),h=localStorage.getItem(o);if(h)try{const a=JSON.parse(h),i=this.monthDays.find(n=>n.date.toDateString()===o);i&&(i.dayShift1=a.dayShift1,i.dayShift2=a.dayShift2,i.nightShift1=a.nightShift1,i.nightShift2=a.nightShift2,i.dayShift1Name=a.dayShift1Name||"Not assigned",i.dayShift2Name=a.dayShift2Name||"Not assigned",i.nightShift1Name=a.nightShift1Name||"Not assigned",i.nightShift2Name=a.nightShift2Name||"Not assigned")}catch(a){console.error("Failed to load local data:",a)}}},resolvePersonName(t){const e=this.people.find(s=>s.id===t);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}},async fetchServerShiftData(){this.syncedChanges={};try{const t=await fetch("https://mc.kot.li/?key=shiftData.json",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw t.status===404&&addNotification("Data not found on server","red"),new Error(`Failed to fetch data from server: ${t.status}`);return await t.json()}catch(t){return console.error("Error fetching data from server:",t),addNotification("Failed to fetch data from server","red"),null}},getShiftForPersonAndDay(t,e){const s=this.monthDays.find(h=>h.date.getDate()===e)?.date.toDateString(),o=localStorage.getItem(s);if(o){const h=JSON.parse(o),a=[];return(h.dayShift1===t||h.dayShift2===t)&&a.push("D"),(h.nightShift1===t||h.nightShift2===t)&&a.push("N"),a.join(" ")}return null}},mounted(){this.generateMonthDays()}},v={class:"spreadsheet-view"},C={class:"monthChange"},b={style:{"font-weight":"bold"}},E={class:"calendar-table"},z=["onClick"],F={key:0},O=["onUpdate:modelValue","onChange"];function P(t,e,s,o,h,a){return l(),f("div",v,[r("section",C,[r("button",{class:"buttonMonthChange",onClick:e[0]||(e[0]=i=>a.changeMonth(-1))}," ‹ "),r("span",b,g(a.monthYear.toUpperCase()),1),r("button",{class:"buttonMonthChange",onClick:e[1]||(e[1]=i=>a.changeMonth(1))},"›")]),r("button",{class:"top-right-buttons buttonRefresh",onClick:e[2]||(e[2]=i=>t.checkShiftDataSync())},e[4]||(e[4]=[r("img",{src:"/assets/icons/refresh.svg",style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Refresh"},null,-1)])),r("button",{onClick:e[3]||(e[3]=(...i)=>a.toggleEditingMode&&a.toggleEditingMode(...i)),class:"edit-mode-button"},g(h.isEditingMode?"Wyłącz tryb edytowania":"Włącz tryb edytowania"),1),r("table",E,[r("thead",null,[r("tr",null,[e[5]||(e[5]=r("th",null,"Nazwisko i imię",-1)),(l(!0),f(S,null,u(a.daysInMonth,i=>(l(),f("th",{key:i},g(i),1))),128))])]),r("tbody",null,[(l(!0),f(S,null,u(a.orderedPeople,i=>(l(),f("tr",{key:i.id},[r("td",{class:N({ratownik:i.ratownik,pielegniarka:!i.ratownik})},g(i.name),3),(l(!0),f(S,null,u(a.daysInMonth,n=>(l(),f("td",{key:n,class:"editable-cell",onClick:d=>a.editCell(i.id,n)},[!h.isEditingMode||!a.isEditing(i.id,n)?(l(),f("span",F,g(a.getShiftForPersonAndDay(i.id,n)||""),1)):k((l(),f("select",{key:1,"onUpdate:modelValue":d=>h.editedShifts[`${i.id}-${n}`]=d,onChange:d=>a.saveShift(i.id,n)},e[6]||(e[6]=[r("option",{value:""},null,-1),r("option",{value:"D"},"D",-1),r("option",{value:"N"},"N",-1),r("option",{value:"D N"},"D N",-1)]),40,O)),[[p,h.editedShifts[`${i.id}-${n}`]]])],8,z))),128))]))),128))])])])}const Y=w(M,[["render",P],["__scopeId","data-v-65f2e5f4"]]);export{Y as default};
