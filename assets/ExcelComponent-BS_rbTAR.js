import{S as M,P as v,A as b,d as C}from"./AuthorizationModal-CmRD9STF.js";import{_ as P,r as w,o as d,c as l,a as p,b as o,t as S,F as m,d as D,e as z,f as x,n as k,g as _,v as E}from"./index-CHLuS958.js";import"./NotificationMessage-CO_IjsfA.js";const O={name:"SpreadsheetView",emits:["update-editing-mode"],components:{ShiftCountWindow:M,PeopleListWindow:v,AuthorizationModal:b},props:{isEditingMode:{type:Boolean,required:!0}},data(){return{editedShifts:{},selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),monthDays:[],localData:{},daysOfWeek:C,madeChanges:!1,people:[{id:1,name:"Milena",ratownik:!1},{id:2,name:"Mikołaj",ratownik:!1},{id:3,name:"Aleksandra",ratownik:!1},{id:4,name:"Łukasz",ratownik:!0},{id:5,name:"Joanna",ratownik:!1},{id:6,name:"Natalia",ratownik:!0},{id:7,name:"Marcin",ratownik:!0},{id:8,name:"Alina",ratownik:!1},{id:9,name:"Ewelina",ratownik:!1},{id:7,name:"Teresa",ratownik:!1}],locale:"pl",showPasswordModal:!1}},computed:{daysInMonth(){return this.monthDays.map(e=>e.date.getDate())},orderedPeople(){const e=["Milena","Mikołaj","Aleksandra","Joanna","Łukasz","Natalia","Marcin"];return this.people.filter(i=>e.includes(i.name)).sort((i,s)=>e.indexOf(i.name)-e.indexOf(s.name))},monthYear(){return new Date(this.selectedYear,this.selectedMonth).toLocaleString(this.locale,{month:"long",year:"numeric"})}},methods:{emitEditingMode(e){this.$emit("update-editing-mode",e)},isEditing(e,i){return this.editedShifts.hasOwnProperty(`${e}-${i}`)},getShiftForPersonAndDay(e,i){const s=this.monthDays.find(n=>n.date.getDate()===i)?.date.toDateString(),r=localStorage.getItem(s);if(r){const n=JSON.parse(r);return Object.values(n).find(a=>a===e)}return null},editCell(e,i){if(this.isEditingMode){const s=`${e}-${i}`,r=this.getShiftForPersonAndDay(e,i)||"";this.editedShifts[s]=r}},saveShift(e,i){const s=`${e}-${i}`,r=this.editedShifts[s]?.trim().toUpperCase()||"";if(!["D","N","D N",""].includes(r)){alert("Invalid input! Only 'D', 'N', or 'D N' are allowed."),delete this.editedShifts[s];return}const a=this.monthDays.find(c=>c.date.getDate()===i)?.date.toDateString();if(!a||!this.monthDays)return;const t=this.monthDays.find(c=>c.date.toDateString()===a);if(!t)return;if(r===""){t.dayShift1===e&&(t.dayShift1=null,t.dayShift1Name="Not assigned",t.dayShift1UserChanged=!0),t.dayShift2===e&&(t.dayShift2=null,t.dayShift2Name="Not assigned",t.dayShift2UserChanged=!0),t.nightShift1===e&&(t.nightShift1=null,t.nightShift1Name="Not assigned",t.nightShift1UserChanged=!0),t.nightShift2===e&&(t.nightShift2=null,t.nightShift2Name="Not assigned",t.nightShift2UserChanged=!0);const c={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2,dayShift1Name:t.dayShift1Name,dayShift2Name:t.dayShift2Name,nightShift1Name:t.nightShift1Name,nightShift2Name:t.nightShift2Name};this.localData[a]=c,localStorage.setItem(a,JSON.stringify(c)),this.madeChanges=!0,delete this.editedShifts[s];return}const g=this.people.find(c=>c.id===e),y=g?.ratownik,f=[t.dayShift1,t.dayShift2,t.nightShift1,t.nightShift2].filter(Boolean).some(c=>this.people.find(N=>N.id===c)?.ratownik);if(y&&f){alert("Nie można przypisać dwóch ratowników na jedną zmianę."),delete this.editedShifts[s];return}if(r.includes("D")){if(t.dayShift1===e||t.dayShift2===e){alert("This person is already assigned to the day shift."),delete this.editedShifts[s];return}if(!t.dayShift1)t.dayShift1=e,t.dayShift1Name=g.name,t.dayShift1UserChanged=!0;else if(!t.dayShift2)t.dayShift2=e,t.dayShift2Name=g.name,t.dayShift2UserChanged=!0;else{alert("Nie można przypisać więcej niż dwóch osób na zmianę dzienną."),delete this.editedShifts[s];return}}if(r.includes("N")){if(t.nightShift1===e||t.nightShift2===e){alert("This person is already assigned to the night shift."),delete this.editedShifts[s];return}if(!t.nightShift1)t.nightShift1=e,t.nightShift1Name=g.name,t.nightShift1UserChanged=!0;else if(!t.nightShift2)t.nightShift2=e,t.nightShift2Name=g.name,t.nightShift2UserChanged=!0;else{alert("Nie można przypisać więcej niż dwóch osób na zmianę nocną."),delete this.editedShifts[s];return}}const u={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2};this.localData[a]=u,this.madeChanges=!0,localStorage.setItem(a,JSON.stringify(u)),delete this.editedShifts[s]},generateMonthDays(){const e=this.selectedYear,i=this.selectedMonth,s=new Date(e,i+1,0).getDate();this.monthDays=[];for(let r=1;r<=s;r++)this.monthDays.push({date:new Date(e,i,r),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage()},changeMonth(e){this.madeChanges&&!confirm("You have unsaved changes. Are you sure you want to switch the month? Your changes will be discarded.")||(this.editedShifts={},this.selectedMonth=this.selectedMonth+e,this.generateMonthDays())},loadFromLocalStorage(){const e=this.selectedYear,i=this.selectedMonth;for(let s=1;s<=31;s++){const r=new Date(e,i,s).toDateString(),n=localStorage.getItem(r);if(n)try{const a=JSON.parse(n),t=this.monthDays.find(g=>g.date.toDateString()===r);t&&(t.dayShift1=a.dayShift1,t.dayShift2=a.dayShift2,t.nightShift1=a.nightShift1,t.nightShift2=a.nightShift2,t.dayShift1Name=a.dayShift1Name||"Not assigned",t.dayShift2Name=a.dayShift2Name||"Not assigned",t.nightShift1Name=a.nightShift1Name||"Not assigned",t.nightShift2Name=a.nightShift2Name||"Not assigned")}catch(a){console.error("Failed to load local data:",a)}}},resolvePersonName(e){const i=this.people.find(s=>s.id===e);return i?{name:i.name,isRatownik:i.ratownik}:{name:void 0,isRatownik:!1}},showPasswordPrompt(){this.showPasswordModal=!0},async fetchServerShiftData(){this.syncedChanges={};try{const e=await fetch("https://mc.kot.li/?key=shiftData.json",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw e.status===404&&addNotification("Data not found on server","red"),new Error(`Failed to fetch data from server: ${e.status}`);return await e.json()}catch(e){return console.error("Error fetching data from server:",e),addNotification("Failed to fetch data from server","red"),null}},getShiftForPersonAndDay(e,i){const s=this.monthDays.find(n=>n.date.getDate()===i)?.date.toDateString(),r=localStorage.getItem(s);if(r){const n=JSON.parse(r),a=[];return(n.dayShift1===e||n.dayShift2===e)&&a.push("D"),(n.nightShift1===e||n.nightShift2===e)&&a.push("N"),a.join(" ")}return null},showPasswordPrompt(){this.showPasswordModal=!0}},mounted(){this.generateMonthDays()}},A=["disabled"],Y={class:"spreadsheet-view"},j={class:"monthChange"},F={style:{"font-weight":"bold",width:"200px !important"}},U={class:"top-right-buttons compact-toggle"},W=["checked"],L={class:"slider"},V={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"pencil-icon"},B={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"pencil-icon"},J={class:"calendar-table"},T=["onClick"],R={key:0},q=["onUpdate:modelValue","onChange"],G={key:0,style:{display:"flex","flex-direction":"column","align-items":"center"}};function Z(e,i,s,r,n,a){const t=w("AuthorizationModal"),g=w("PeopleListWindow"),y=w("ShiftCountWindow");return d(),l(m,null,[p(t,{show:n.showPasswordModal,localData:n.localData,onClose:i[0]||(i[0]=h=>n.showPasswordModal=!1),onAuthorized:e.handleAuthorization},null,8,["show","localData","onAuthorized"]),o("button",{disabled:!n.madeChanges,onClick:i[1]||(i[1]=(...h)=>a.showPasswordPrompt&&a.showPasswordPrompt(...h)),class:"submit-button"}," Zapisz ",8,A),o("div",Y,[o("section",j,[o("button",{class:"buttonMonthChange",onClick:i[2]||(i[2]=h=>a.changeMonth(-1))}," ‹ "),o("span",F,S(a.monthYear.toUpperCase()),1),o("button",{class:"buttonMonthChange",onClick:i[3]||(i[3]=h=>a.changeMonth(1))},"›")]),o("button",{class:"top-right-buttons buttonRefresh",onClick:i[4]||(i[4]=h=>e.checkShiftDataSync())},i[6]||(i[6]=[o("img",{src:"/assets/icons/refresh.svg",style:{width:"30px",height:"30px",cursor:"pointer"},alt:"Refresh"},null,-1)])),o("label",U,[o("input",{type:"checkbox",checked:s.isEditingMode,onChange:i[5]||(i[5]=h=>a.emitEditingMode(h.target.checked))},null,40,W),o("span",L,[s.isEditingMode?(d(),l("svg",B,i[8]||(i[8]=[o("path",{d:"M12 20h9"},null,-1),o("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"},null,-1)]))):(d(),l("svg",V,i[7]||(i[7]=[o("path",{d:"M12 20h9"},null,-1),o("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"},null,-1)])))])]),o("table",J,[o("thead",null,[o("tr",null,[i[9]||(i[9]=o("th",null,null,-1)),(d(!0),l(m,null,D(a.daysInMonth,h=>(d(),l("th",{key:h,class:k({"nd-color":n.daysOfWeek[new Date(n.selectedYear,n.selectedMonth,h).getDay()]==="Nd","sob-color":n.daysOfWeek[new Date(n.selectedYear,n.selectedMonth,h).getDay()]==="Sob"})},S(h),3))),128))])]),o("tbody",null,[(d(!0),l(m,null,D(a.orderedPeople,h=>(d(),l("tr",{key:h.id},[o("td",{class:k({ratownik:h.ratownik,pielegniarka:!h.ratownik})},S(h.name),3),(d(!0),l(m,null,D(a.daysInMonth,f=>(d(),l("td",{key:f,class:k(["editable-cell",{"nd-color":n.daysOfWeek[new Date(n.selectedYear,n.selectedMonth,f).getDay()]==="Nd","sob-color":n.daysOfWeek[new Date(n.selectedYear,n.selectedMonth,f).getDay()]==="Sob"}]),onClick:u=>a.editCell(h.id,f)},[!s.isEditingMode||!a.isEditing(h.id,f)?(d(),l("span",R,S(a.getShiftForPersonAndDay(h.id,f)||""),1)):_((d(),l("select",{key:1,"onUpdate:modelValue":u=>n.editedShifts[`${h.id}-${f}`]=u,onChange:u=>a.saveShift(h.id,f)},i[10]||(i[10]=[o("option",{value:""},null,-1),o("option",{value:"D"},"D",-1),o("option",{value:"N"},"N",-1),o("option",{value:"D N"},"D N",-1)]),40,q)),[[E,n.editedShifts[`${h.id}-${f}`]]])],10,T))),128))]))),128))])])]),p(g,{people:n.people,isEditingMode:!1},null,8,["people"]),s.isEditingMode?(d(),l("div",G,i[11]||(i[11]=[o("h1",{style:{background:"var(--glass-bg-color)","backdrop-filter":"blur(var(--glass-blur))","-webkit-backdrop-filter":"blur(var(--glass-blur))",border:"1px solid var(--glass-border-color)","border-radius":"var(--border-radius-small)",filter:"drop-shadow(var(--shadow-drop))",color:"var(--color-text-dark)","font-size":"20px","box-shadow":"var(--glass-box-shadow)",padding:"var(--spacing-medium)"}},[z(" Tryb edytowania "),o("a",{style:{color:"green"}},"Włączony")],-1)]))):x("",!0),p(y,{people:n.people,monthDays:n.monthDays},null,8,["people","monthDays"])],64)}const I=P(O,[["render",Z],["__scopeId","data-v-6dc2c73f"]]);export{I as default};
