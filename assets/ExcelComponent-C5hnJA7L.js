import{d as M}from"./daysOfWeek-C19XqJ9X.js";import{N as v,r as b,c as p,a as g,_ as z}from"./utils-ILKzS2sg.js";import{c as l,o as r,d,F as y,a as D,w as O,n as u,t as N,k as U,s as _}from"./vue-vendor-CVTALk6y.js";const F={name:"SpreadsheetView",emits:["update-editing-mode","has-changes","month-days-updated"],props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},components:{NotificationMessage:v},data(){return{editedShifts:{},monthDays:[],localData:{},daysOfWeek:M,madeChanges:!1,scrollContainer:null,isFirstColumnLocked:!1,importedCells:new Set}},computed:{daysInMonth(){return this.monthDays.map(e=>e.date.getDate())},orderedPeople(){const e=["Milena","Mikołaj","Aleksandra","Joanna","Łukasz","Natalia","Marcin"];return this.people.filter(i=>e.includes(i.name)).sort((i,a)=>e.indexOf(i.name)-e.indexOf(a.name))}},watch:{selectedMonth(){this.generateMonthDays()},selectedYear(){this.generateMonthDays()}},methods:{isEditing(e,i){return this.editedShifts.hasOwnProperty(`${e}-${i}`)},getShiftForPersonAndDay(e,i){const a=this.monthDays.find(h=>h.date.getDate()===i)?.date.toDateString(),o=localStorage.getItem(a);if(o){const h=JSON.parse(o),s=[];return(h.dayShift1===e||h.dayShift2===e)&&s.push("D"),(h.nightShift1===e||h.nightShift2===e)&&s.push("N"),s.join(" ")}return null},editCell(e,i){if(this.isEditingMode){const a=`${e}-${i}`,o=this.getShiftForPersonAndDay(e,i)||"";this.editedShifts[a]=o}},saveShift(e,i){const a=`${e}-${i}`,o=this.editedShifts[a]?.trim().toUpperCase()||"",h=this.getShiftForPersonAndDay(e,i)||"";if(!["D","N","D N",""].includes(o)){g("Zła wartość! Tylko 'D', 'N', lub 'D N' są dozwolone.","red"),this.$nextTick(()=>{this.editedShifts[a]=h});return}const n=this.monthDays.find(c=>c.date.getDate()===i)?.date.toDateString();if(!n||!this.monthDays)return;const t=this.monthDays.find(c=>c.date.toDateString()===n);if(!t)return;if(t.dayShift1===e&&(t.dayShift1=null,t.dayShift1Name="Not assigned",t.dayShift1UserChanged=!0),t.dayShift2===e&&(t.dayShift2=null,t.dayShift2Name="Not assigned",t.dayShift2UserChanged=!0),t.nightShift1===e&&(t.nightShift1=null,t.nightShift1Name="Not assigned",t.nightShift1UserChanged=!0),t.nightShift2===e&&(t.nightShift2=null,t.nightShift2Name="Not assigned",t.nightShift2UserChanged=!0),o===""){const c={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2,dayShift1Name:t.dayShift1Name,dayShift2Name:t.dayShift2Name,nightShift1Name:t.nightShift1Name,nightShift2Name:t.nightShift2Name};this.localData[n]=c,localStorage.setItem(n,JSON.stringify(c)),this.madeChanges=!0,this.$emit("has-changes",this.madeChanges),this.$nextTick(()=>{delete this.editedShifts[a],this.$forceUpdate()});return}const f=this.people.find(c=>c.id===e);if(o.includes("D")){if(f?.ratownik&&[t.dayShift1,t.dayShift2].filter(Boolean).some(S=>this.people.find(m=>m.id===S)?.ratownik&&S!==e)){g("Nie można przypisać dwóch ratowników na zmianę dzienną.","red"),delete this.editedShifts[a];return}if(!t.dayShift1)t.dayShift1=e,t.dayShift1Name=f.name,t.dayShift1UserChanged=!0;else if(!t.dayShift2)t.dayShift2=e,t.dayShift2Name=f.name,t.dayShift2UserChanged=!0;else{g("Nie można przypisać więcej niż dwóch osób na zmianę dzienną.","red"),delete this.editedShifts[a];return}}if(o.includes("N")){if(f?.ratownik&&[t.nightShift1,t.nightShift2].filter(Boolean).some(S=>this.people.find(m=>m.id===S)?.ratownik&&S!==e)){g("Nie można przypisać dwóch ratowników na zmianę nocną.","red"),delete this.editedShifts[a];return}if(!t.nightShift1)t.nightShift1=e,t.nightShift1Name=f.name,t.nightShift1UserChanged=!0;else if(!t.nightShift2)t.nightShift2=e,t.nightShift2Name=f.name,t.nightShift2UserChanged=!0;else{g("Nie można przypisać więcej niż dwóch osób na zmianę nocną.","red"),delete this.editedShifts[a];return}}const k={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2};this.localData[n]=k,this.madeChanges=!0,this.$emit("has-changes",this.madeChanges),localStorage.setItem(n,JSON.stringify(k)),delete this.editedShifts[a]},generateMonthDays(){this.resetUserChanges();const e=this.selectedYear,i=this.selectedMonth,a=new Date(e,i+1,0).getDate();this.monthDays=[];for(let o=1;o<=a;o++)this.monthDays.push({date:new Date(e,i,o),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(e){this.madeChanges=e,this.$emit("has-changes",this.madeChanges)},loadFromLocalStorage(){const e=this.selectedYear,i=this.selectedMonth;for(let a=1;a<=31;a++){const o=new Date(e,i,a).toDateString(),h=localStorage.getItem(o);if(h)try{const s=JSON.parse(h),n=this.monthDays.find(t=>t.date.toDateString()===o);n&&(n.dayShift1=s.dayShift1,n.dayShift2=s.dayShift2,n.nightShift1=s.nightShift1,n.nightShift2=s.nightShift2,n.dayShift1Name=s.dayShift1Name||"Not assigned",n.dayShift2Name=s.dayShift2Name||"Not assigned",n.nightShift1Name=s.nightShift1Name||"Not assigned",n.nightShift2Name=s.nightShift2Name||"Not assigned")}catch{g("Nie udało się załadować danych lokalnych. Sprawdź konsolę.","red")}}},resolvePersonName(e){const i=this.people.find(a=>a.id===e);return i?{name:i.name,isRatownik:i.ratownik}:{name:void 0,isRatownik:!1}},async checkShiftDataSync(){this.syncedChanges=await p(()=>this.generateMonthDays())},resetSyncedChangesSessionStorage(){this.syncedChanges=b()},handleScroll(e){this.scrollContainer&&(e.preventDefault(),this.scrollContainer.scrollLeft+=e.deltaY)},resetUserChanges(){for(const e in localStorage)if(!(e==="isEditingMode"||e==="currentPage")&&localStorage.hasOwnProperty(e))try{const i=JSON.parse(localStorage.getItem(e)||"{}");(i.dayShift1UserChanged||i.dayShift2UserChanged||i.nightShift1UserChanged||i.nightShift2UserChanged)&&localStorage.removeItem(e)}catch{continue}this.localData={},this.editedShifts={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges)},isToday(e){const i=new Date;return e.getDate()===i.getDate()&&e.getMonth()===i.getMonth()&&e.getFullYear()===i.getFullYear()},isImportedCell(e,i){return this.importedCells.has(`${e}-${i}`)},toggleColumnsLocked(){this.isFirstColumnLocked=!this.isFirstColumnLocked,this.$nextTick(()=>{document.querySelectorAll(".calendar-table th:first-child, .calendar-table td:first-child").forEach(i=>{this.isFirstColumnLocked?i.classList.add("column-locked"):i.classList.remove("column-locked")})})}},mounted(){this.resetUserChanges(),this.generateMonthDays(),this.scrollContainer=this.$refs.scrollContainer}},L={class:"spreadsheet-view"},P={class:"calendar-table"},x=["title"],Y={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"white","stroke-width":"2"},E={key:0,d:"M12 3a4 4 0 0 0-4 4v4h8V7a4 4 0 0 0-4-4z"},V={key:1,d:"M8 11V7a4 4 0 0 1 8 0"},B=["onClick","aria-label","title"],j=["onUpdate:modelValue","onChange"];function A(e,i,a,o,h,s){return r(),l("div",L,[d("div",{class:"scrollable-container",onWheel:i[1]||(i[1]=O((...n)=>s.handleScroll&&s.handleScroll(...n),["prevent"])),ref:"scrollContainer"},[d("table",P,[d("thead",null,[d("tr",null,[d("th",null,[d("button",{class:"lock-column-button",onClick:i[0]||(i[0]=(...n)=>s.toggleColumnsLocked&&s.toggleColumnsLocked(...n)),title:h.isFirstColumnLocked?"Odblokuj szerokość":"Zablokuj szerokość"},[(r(),l("svg",Y,[i[2]||(i[2]=d("rect",{x:"7",y:"11",width:"10",height:"10",rx:"1"},null,-1)),h.isFirstColumnLocked?(r(),l("path",E)):(r(),l("path",V))]))],8,x)]),(r(!0),l(y,null,D(s.daysInMonth,n=>(r(),l("th",{key:n,class:u({"nd-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,n).getDay()]==="Nd","sob-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,n).getDay()]==="Sob","today-column":s.isToday(new Date(a.selectedYear,a.selectedMonth,n))})},N(n),3))),128))])]),d("tbody",null,[(r(!0),l(y,null,D(s.orderedPeople,n=>(r(),l("tr",{key:n.id},[d("td",{class:u({ratownik:n.ratownik,pielegniarka:!n.ratownik})},N(n.name),3),(r(!0),l(y,null,D(s.daysInMonth,t=>(r(),l("td",{key:t,class:u(["editable-cell",{"nd-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,t).getDay()]==="Nd","sob-color":h.daysOfWeek[new Date(a.selectedYear,a.selectedMonth,t).getDay()]==="Sob",today:s.isToday(new Date(a.selectedYear,a.selectedMonth,t))}]),onClick:f=>s.editCell(n.id,t),"aria-label":a.isEditingMode?"Kliknij aby edytować zmianę":"",title:a.isEditingMode?"Kliknij aby edytować zmianę":"",role:"gridcell"},[!a.isEditingMode||!s.isEditing(n.id,t)?(r(),l("span",{key:0,class:u({"imported-cell":s.isImportedCell(n.id,t)})},N(s.getShiftForPersonAndDay(n.id,t)||""),3)):U((r(),l("select",{key:1,"onUpdate:modelValue":f=>h.editedShifts[`${n.id}-${t}`]=f,onChange:f=>s.saveShift(n.id,t)},i[3]||(i[3]=[d("option",{value:""},null,-1),d("option",{value:"D"},"D",-1),d("option",{value:"N"},"N",-1),d("option",{value:"D N"},"D N",-1)]),40,j)),[[_,h.editedShifts[`${n.id}-${t}`]]])],10,B))),128))]))),128))])])],544)])}const W=z(F,[["render",A],["__scopeId","data-v-f5c4b0fb"]]);export{W as default};
