import{d as M}from"./daysOfWeek-C19XqJ9X.js";import{_ as b,a as f,c as z,r as v,o as S,b as g,d as r,F as y,f as u,w as U,n as N,t as D,g as p,v as O}from"./index-CrFS8m9F.js";const _={name:"SpreadsheetView",emits:["update-editing-mode","has-changes","month-days-updated"],props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{editedShifts:{},monthDays:[],localData:{},daysOfWeek:M,madeChanges:!1,scrollContainer:null}},computed:{daysInMonth(){return this.monthDays.map(e=>e.date.getDate())},orderedPeople(){const e=["Milena","Mikołaj","Aleksandra","Joanna","Łukasz","Natalia","Marcin"];return this.people.filter(a=>e.includes(a.name)).sort((a,i)=>e.indexOf(a.name)-e.indexOf(i.name))}},watch:{selectedMonth(){this.generateMonthDays()},selectedYear(){this.generateMonthDays()}},methods:{isEditing(e,a){return this.editedShifts.hasOwnProperty(`${e}-${a}`)},getShiftForPersonAndDay(e,a){const i=this.monthDays.find(d=>d.date.getDate()===a)?.date.toDateString(),s=localStorage.getItem(i);if(s){const d=JSON.parse(s),h=[];return(d.dayShift1===e||d.dayShift2===e)&&h.push("D"),(d.nightShift1===e||d.nightShift2===e)&&h.push("N"),h.join(" ")}return null},editCell(e,a){if(this.isEditingMode){const i=`${e}-${a}`,s=this.getShiftForPersonAndDay(e,a)||"";this.editedShifts[i]=s}},saveShift(e,a){const i=`${e}-${a}`,s=this.editedShifts[i]?.trim().toUpperCase()||"",d=this.getShiftForPersonAndDay(e,a)||"";if(!["D","N","D N",""].includes(s)){f("Zła wartość! Tylko 'D', 'N', lub 'D N' są dozwolone."),this.$nextTick(()=>{this.editedShifts[i]=d});return}const n=this.monthDays.find(l=>l.date.getDate()===a)?.date.toDateString();if(!n||!this.monthDays)return;const t=this.monthDays.find(l=>l.date.toDateString()===n);if(!t)return;if(s===""){t.dayShift1===e&&(t.dayShift1=null,t.dayShift1Name="Not assigned",t.dayShift1UserChanged=!0),t.dayShift2===e&&(t.dayShift2=null,t.dayShift2Name="Not assigned",t.dayShift2UserChanged=!0),t.nightShift1===e&&(t.nightShift1=null,t.nightShift1Name="Not assigned",t.nightShift1UserChanged=!0),t.nightShift2===e&&(t.nightShift2=null,t.nightShift2Name="Not assigned",t.nightShift2UserChanged=!0);const l={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2,dayShift1Name:t.dayShift1Name,dayShift2Name:t.dayShift2Name,nightShift1Name:t.nightShift1Name,nightShift2Name:t.nightShift2Name};this.localData[n]=l,localStorage.setItem(n,JSON.stringify(l)),this.madeChanges=!0,this.$emit("has-changes",this.madeChanges),this.$nextTick(()=>{this.editedShifts[i]=void 0,delete this.editedShifts[i],this.$forceUpdate()});return}const o=this.people.find(l=>l.id===e);if(s.includes("D")){if(o?.ratownik&&[t.dayShift1,t.dayShift2].filter(Boolean).some(c=>this.people.find(m=>m.id===c)?.ratownik&&c!==e)){f("Nie można przypisać dwóch ratowników na zmianę dzienną."),delete this.editedShifts[i];return}if(s==="D"&&d!=="D N"){if(t.dayShift1===e||t.dayShift2===e){f("Ta osoba już ma zmianę dzienną."),delete this.editedShifts[i];return}if(!t.dayShift1)t.dayShift1=e,t.dayShift1Name=o.name,t.dayShift1UserChanged=!0;else if(!t.dayShift2)t.dayShift2=e,t.dayShift2Name=o.name,t.dayShift2UserChanged=!0;else{f("Nie można przypisać więcej niż dwóch osób na zmianę dzienną."),delete this.editedShifts[i];return}}else if(s==="D N"&&!(t.dayShift1===e||t.dayShift2===e))if(!t.dayShift1)t.dayShift1=e,t.dayShift1Name=o.name,t.dayShift1UserChanged=!0;else if(!t.dayShift2)t.dayShift2=e,t.dayShift2Name=o.name,t.dayShift2UserChanged=!0;else{f("Nie można przypisać więcej niż dwóch osób na zmianę dzienną."),delete this.editedShifts[i];return}}if(s.includes("N")){if(o?.ratownik&&[t.nightShift1,t.nightShift2].filter(Boolean).some(c=>this.people.find(m=>m.id===c)?.ratownik&&c!==e)){f("Nie można przypisać dwóch ratowników na zmianę nocną."),delete this.editedShifts[i];return}if(s==="N"&&d!=="D N"){if(t.nightShift1===e||t.nightShift2===e){f("Ta osoba już ma zmianę nocną."),delete this.editedShifts[i];return}if(!t.nightShift1)t.nightShift1=e,t.nightShift1Name=o.name,t.nightShift1UserChanged=!0;else if(!t.nightShift2)t.nightShift2=e,t.nightShift2Name=o.name,t.nightShift2UserChanged=!0;else{f("Nie można przypisać więcej niż dwóch osób na zmianę nocną."),delete this.editedShifts[i];return}}else if(s==="D N"&&!(t.nightShift1===e||t.nightShift2===e))if(!t.nightShift1)t.nightShift1=e,t.nightShift1Name=o.name,t.nightShift1UserChanged=!0;else if(!t.nightShift2)t.nightShift2=e,t.nightShift2Name=o.name,t.nightShift2UserChanged=!0;else{f("Nie można przypisać więcej niż dwóch osób na zmianę nocną."),delete this.editedShifts[i];return}}const w={dayShift1:t.dayShift1,dayShift2:t.dayShift2,nightShift1:t.nightShift1,nightShift2:t.nightShift2};this.localData[n]=w,this.madeChanges=!0,this.$emit("has-changes",this.madeChanges),localStorage.setItem(n,JSON.stringify(w)),delete this.editedShifts[i]},generateMonthDays(){this.resetUserChanges();const e=this.selectedYear,a=this.selectedMonth,i=new Date(e,a+1,0).getDate();this.monthDays=[];for(let s=1;s<=i;s++)this.monthDays.push({date:new Date(e,a,s),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(e){this.madeChanges=e,this.$emit("has-changes",this.madeChanges)},loadFromLocalStorage(){const e=this.selectedYear,a=this.selectedMonth;for(let i=1;i<=31;i++){const s=new Date(e,a,i).toDateString(),d=localStorage.getItem(s);if(d)try{const h=JSON.parse(d),n=this.monthDays.find(t=>t.date.toDateString()===s);n&&(n.dayShift1=h.dayShift1,n.dayShift2=h.dayShift2,n.nightShift1=h.nightShift1,n.nightShift2=h.nightShift2,n.dayShift1Name=h.dayShift1Name||"Not assigned",n.dayShift2Name=h.dayShift2Name||"Not assigned",n.nightShift1Name=h.nightShift1Name||"Not assigned",n.nightShift2Name=h.nightShift2Name||"Not assigned")}catch(h){console.error("Failed to load local data:",h),f("Nie udało się załadować danych lokalnych. Sprawdź konsolę.","red")}}},resolvePersonName(e){const a=this.people.find(i=>i.id===e);return a?{name:a.name,isRatownik:a.ratownik}:{name:void 0,isRatownik:!1}},async checkShiftDataSync(){this.syncedChanges=await z(()=>this.generateMonthDays())},resetSyncedChangesSessionStorage(){this.syncedChanges=v()},handleScroll(e){this.scrollContainer&&(e.preventDefault(),this.scrollContainer.scrollLeft+=e.deltaY)},resetUserChanges(){for(const e in localStorage)if(localStorage.hasOwnProperty(e)){const a=JSON.parse(localStorage.getItem(e)||"{}");(a.dayShift1UserChanged||a.dayShift2UserChanged||a.nightShift1UserChanged||a.nightShift2UserChanged)&&localStorage.removeItem(e)}this.localData={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges),this.editedShifts={}}},mounted(){this.resetUserChanges(),this.generateMonthDays(),this.scrollContainer=this.$refs.scrollContainer}},P={class:"spreadsheet-view"},j={class:"calendar-table"},E=["onClick","aria-label","title"],F={key:0},V=["onUpdate:modelValue","onChange"];function Y(e,a,i,s,d,h){return S(),g("div",P,[r("div",{class:"scrollable-container",onWheel:a[0]||(a[0]=U((...n)=>h.handleScroll&&h.handleScroll(...n),["prevent"])),ref:"scrollContainer"},[r("table",j,[r("thead",null,[r("tr",null,[a[1]||(a[1]=r("th",null,null,-1)),(S(!0),g(y,null,u(h.daysInMonth,n=>(S(),g("th",{key:n,class:N({"nd-color":d.daysOfWeek[new Date(i.selectedYear,i.selectedMonth,n).getDay()]==="Nd","sob-color":d.daysOfWeek[new Date(i.selectedYear,i.selectedMonth,n).getDay()]==="Sob"})},D(n),3))),128))])]),r("tbody",null,[(S(!0),g(y,null,u(h.orderedPeople,n=>(S(),g("tr",{key:n.id},[r("td",{class:N({ratownik:n.ratownik,pielegniarka:!n.ratownik})},D(n.name),3),(S(!0),g(y,null,u(h.daysInMonth,t=>(S(),g("td",{key:t,class:N(["editable-cell",{"nd-color":d.daysOfWeek[new Date(i.selectedYear,i.selectedMonth,t).getDay()]==="Nd","sob-color":d.daysOfWeek[new Date(i.selectedYear,i.selectedMonth,t).getDay()]==="Sob"}]),onClick:o=>h.editCell(n.id,t),"aria-label":i.isEditingMode?"Kliknij aby edytować zmianę":"",title:i.isEditingMode?"Kliknij aby edytować zmianę":"",role:"gridcell"},[!i.isEditingMode||!h.isEditing(n.id,t)?(S(),g("span",F,D(h.getShiftForPersonAndDay(n.id,t)||""),1)):p((S(),g("select",{key:1,"onUpdate:modelValue":o=>d.editedShifts[`${n.id}-${t}`]=o,onChange:o=>h.saveShift(n.id,t)},a[2]||(a[2]=[r("option",{value:""},null,-1),r("option",{value:"D"},"D",-1),r("option",{value:"N"},"N",-1),r("option",{value:"D N"},"D N",-1)]),40,V)),[[O,d.editedShifts[`${n.id}-${t}`]]])],10,E))),128))]))),128))])])],544)])}const B=b(_,[["render",Y],["__scopeId","data-v-b3a236f4"]]);export{B as default};
