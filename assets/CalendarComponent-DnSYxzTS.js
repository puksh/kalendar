import{d as m}from"./daysOfWeek-C19XqJ9X.js";import{N as b,r as C,a as u,c as v,_ as w}from"./utils-Cy8kEWLO.js";import{i as p}from"./index-pKP0Zo3-.js";import{c as h,o as l,e as N,d as r,w as c,F as D,a as M,n as f,t as S}from"./vue-vendor-uYUse1kH.js";const _={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:b},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:m,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1}},methods:{handleDrop(i,e){const a=JSON.parse(localStorage.getItem("draggedPerson"));if(!a)return;const s=this.monthDays.find(d=>d.date.toDateString()===i.toDateString()),o={...s,[e]:a.id};if(o.dayShift1!=null&&o.dayShift2!=null&&o.dayShift1===o.dayShift2||o.nightShift1!=null&&o.nightShift2!=null&&o.nightShift1===o.nightShift2){u("Ta sama osoba na obydwu zmianach.","red");return}const n=a.ratownik;let t=!1;switch(e){case"dayShift1":t=s.dayShift2Ratownik;break;case"dayShift2":t=s.dayShift1Ratownik;break;case"nightShift1":t=s.nightShift2Ratownik;break;case"nightShift2":t=s.nightShift1Ratownik;break}if(n&&t){u("Nie można przypisać dwóch ratowników na jedną zmianę.","red");return}s[e]=a.id,s[`${e}Name`]=a.name,s[`${e}Ratownik`]=a.ratownik,s[`${e}UserChanged`]=!0;const g={dayShift1:s.dayShift1,dayShift2:s.dayShift2,nightShift1:s.nightShift1,nightShift2:s.nightShift2};this.localData[i.toDateString()]=g,localStorage.setItem(i.toDateString(),JSON.stringify(g)),this.madeChanges=!0,this.$emit("has-changes",!0),localStorage.removeItem("draggedPerson")},isDropTarget(i,e){return this.currentDropTarget.date?this.currentDropTarget.date.toDateString()===i.toDateString()&&this.currentDropTarget.shiftType===e:!1},handleClickResetShift(i,e){if(i[e]!==null){i[e]=null,i[e+"Name"]="Usunięto",i[e+"Ratownik"]=null,i[e+"UserChanged"]=!0;const a={dayShift1:i.dayShift1,dayShift2:i.dayShift2,nightShift1:i.nightShift1,nightShift2:i.nightShift2};this.localData[i.date.toDateString()]=a,localStorage.setItem(i.date.toDateString(),JSON.stringify(a)),this.madeChanges=!0,this.$emit("has-changes",!0)}},resolvePersonName(i){const e=this.people.find(a=>a.id===i);return e?{name:e.name,isRatownik:e.ratownik}:{name:void 0,isRatownik:!1}},generateMonthDays(){const i=this.selectedYear,e=this.selectedMonth,a=new Date(i,e+1,0).getDate();this.monthDays=[];for(let s=1;s<=a;s++)this.monthDays.push({date:new Date(i,e,s),dayShift1:null,dayShift2:null,nightShift1:null,nightShift2:null,dayShift1Name:"Not assigned",dayShift2Name:"Not assigned",nightShift1Name:"Not assigned",nightShift2Name:"Not assigned",isCurrentMonth:!0});this.loadFromLocalStorage(),this.$emit("month-days-updated",this.monthDays)},updateChanges(i){this.madeChanges=i,this.$emit("has-changes",i)},emitEditingMode(i){this.$emit("update-editing-mode",i)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await v(()=>this.generateMonthDays())},loadFromLocalStorage(){const i=this.selectedYear,e=this.selectedMonth;for(let a=1;a<=31;a++){const s=new Date(i,e,a).toDateString(),o=localStorage.getItem(s);if(o)try{const n=JSON.parse(o),t=this.monthDays.find(g=>g.date.toDateString()===s);if(t){t.dayShift1=n.dayShift1,t.dayShift2=n.dayShift2,t.nightShift1=n.nightShift1,t.nightShift2=n.nightShift2;const g=this.resolvePersonName(t.dayShift1);t.dayShift1Name=g.name,t.dayShift1Ratownik=g.isRatownik;const d=this.resolvePersonName(t.dayShift2);t.dayShift2Name=d.name,t.dayShift2Ratownik=d.isRatownik;const k=this.resolvePersonName(t.nightShift1);t.nightShift1Name=k.name,t.nightShift1Ratownik=k.isRatownik;const y=this.resolvePersonName(t.nightShift2);t.nightShift2Name=y.name,t.nightShift2Ratownik=y.isRatownik}}catch(n){u("Failed to load local data: "+n,"red")}}},resetSyncedChangesSessionStorage(){this.syncedChanges=C()},resetUserChanges(){for(const i in localStorage)if(!(i==="isEditingMode"||i==="currentPage")&&localStorage.hasOwnProperty(i))try{const e=JSON.parse(localStorage.getItem(i)||"{}");(e.dayShift1UserChanged||e.dayShift2UserChanged||e.nightShift1UserChanged||e.nightShift2UserChanged)&&localStorage.removeItem(i)}catch{continue}this.localData={},this.madeChanges=!1,this.$emit("has-changes",this.madeChanges),this.editedShifts={}},handleScroll(i){this.scrollContainer&&(i.preventDefault(),this.scrollContainer.scrollLeft+=i.deltaY)},scrollToToday(){this.$nextTick(()=>{const i=new Date;if(i.getMonth()===this.selectedMonth&&i.getFullYear()===this.selectedYear){const e=this.monthDays.findIndex(a=>this.isToday(a.date));if(e!==-1&&this.scrollContainer){const a=document.querySelector(".day-cell")?.offsetWidth||0,s=this.scrollContainer.offsetWidth,o=a*e-s/2+a/2;this.scrollContainer.scrollTo({left:Math.max(0,o),behavior:"smooth"})}}})},getDayClass(i){return m[i]==="Nd"?"nd-color":m[i]==="Sob"?"sob-color":"normal-color"},getShiftAriaLabel(i,e){const a=i[e],s=e.includes("day")?"Zmiana dzienna":"Zmiana nocna",o=i[`${e}Name`];return this.isEditingMode?a?`${s}: ${o}. Kliknij aby usunąć zmianę.`:`${s}: Pusta zmiana. Przeciągnij członka zespołu by nadać im zmianę.`:a?`${s}: ${o}`:`${s}: Pusta zmiana.`},getShiftTooltip(i,e){const a=i[e],s=e.includes("day")?"Zmiana dzienna":"Zmiana nocna";return this.isEditingMode?a?`${s}: ${i[`${e}Name`]} (Kliknij by usunąć)`:`Przeciągnij członka zespołu by nadać im - ${s.toLowerCase()}`:a?`${s}: ${i[`${e}Name`]}`:`${s}: Nieprzypisana`},checkMobilePlatform(){const i=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(i.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(i){const e=new Date;return i.getDate()===e.getDate()&&i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()},isHoliday(i){return p(i)}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.scrollToToday(),this.checkMobilePlatform()},watch:{isEditingMode(i){localStorage.setItem("isEditingMode",JSON.stringify(i)),i&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays(),this.scrollToToday()},selectedYear(){this.generateMonthDays()}}},R={key:0,class:"mobile-warning-overlay"},z={class:"mobile-warning"},U={class:"calendar-container"},E={class:"calendar-grid"},P=["onDrop"],W=["title"],T={class:"day-header"},O=["onDrop"],L={class:"day-date"},x=["clickable","onDrop","onClick","aria-label","title"],I={key:0,class:"assigned-person"},j={key:1,class:"assigned-person deleted"},Y={key:2,class:"empty-slot"},A=["clickable","onDrop","onClick","aria-label","title"],F={key:0,class:"assigned-person"},J={key:1,class:"assigned-person deleted"},q={key:2,class:"empty-slot"},H=["onDrop","onClick","aria-label","title"],B={key:0,class:"assigned-person"},Z={key:1,class:"assigned-person deleted"},K={key:2,class:"empty-slot"},V=["clickable","onDrop","onClick","aria-label","title"],G={key:0,class:"assigned-person"},Q={key:1,class:"assigned-person deleted"},X={key:2,class:"empty-slot"};function $(i,e,a,s,o,n){return l(),h(D,null,[o.showMobileWarning?(l(),h("div",R,[r("div",z,[e[7]||(e[7]=r("h3",null,"!! Urządzenie mobilne wykryte !!",-1)),e[8]||(e[8]=r("p",null," Niestety, tryb edycji w widoku kalendarza nie jest obsługiwany na urządzeniach mobilnych. ",-1)),e[9]||(e[9]=r("p",null,"Proszę przejdź do widoku tabeli lub skorzystaj z komputera.",-1)),r("button",{onClick:e[0]||(e[0]=(...t)=>n.handleMobileWarningClose&&n.handleMobileWarningClose(...t)),class:"warning-button"}," Ok ☹ ")])])):N("",!0),r("div",U,[r("section",{class:"scrollable-container",onWheel:e[6]||(e[6]=c((...t)=>n.handleScroll&&n.handleScroll(...t),["prevent"])),ref:"scrollContainer"},[r("div",E,[(l(!0),h(D,null,M(o.monthDays,(t,g)=>(l(),h("div",{key:g,class:f({"today-column":n.isToday(t.date)}),onDragover:e[5]||(e[5]=c(()=>{},["prevent"])),onDrop:d=>n.handleDrop(t.date,"day")},[r("div",null,[r("div",{class:f(["day-cell",{"current-month":t.isCurrentMonth,"nd-color":o.daysOfWeek[t.date.getDay()]==="Nd","sob-color":o.daysOfWeek[t.date.getDay()]==="Sob","holiday-color":n.isHoliday(t.date).isHoliday,today:n.isToday(t.date)}]),title:n.isHoliday(t.date).name||""},[r("div",T,S(o.daysOfWeek[t.date.getDay()]),1),r("div",{class:"shift",onDrop:d=>n.handleDrop(t.date,"day"),onDragover:e[4]||(e[4]=c(()=>{},["prevent"]))},[r("div",L,S(t.date.getDate()),1),r("div",{class:f(["shift-slot day",{ratownik:t.dayShift1Ratownik===!0,pielegniarka:t.dayShift1Ratownik===!1,userChanged:t.dayShift1UserChanged===!0,clickable:a.isEditingMode}]),clickable:a.isEditingMode,onDragover:e[1]||(e[1]=c(()=>{},["prevent"])),onDrop:d=>n.handleDrop(t.date,"dayShift1"),onClick:d=>a.isEditingMode&&n.handleClickResetShift(t,"dayShift1"),"aria-label":n.getShiftAriaLabel(t,"dayShift1"),title:n.getShiftTooltip(t,"dayShift1"),role:"button",tabindex:"0"},[t.dayShift1?(l(),h("div",I,S(t.dayShift1Name),1)):t.dayShift1UserChanged?(l(),h("div",j," Usunięto ")):(l(),h("div",Y,"D"))],42,x),r("div",{class:f(["shift-slot day",{ratownik:t.dayShift2Ratownik===!0,pielegniarka:t.dayShift2Ratownik===!1,userChanged:t.dayShift2UserChanged===!0,clickable:a.isEditingMode}]),clickable:a.isEditingMode,onDrop:d=>n.handleDrop(t.date,"dayShift2"),onClick:d=>a.isEditingMode&&n.handleClickResetShift(t,"dayShift2"),"aria-label":n.getShiftAriaLabel(t,"dayShift2"),title:n.getShiftTooltip(t,"dayShift2"),role:"button",tabindex:"0"},[t.dayShift2?(l(),h("div",F,S(t.dayShift2Name),1)):t.dayShift2UserChanged?(l(),h("div",J," Usunięto ")):(l(),h("div",q,"D"))],42,A),r("div",{class:f(["shift-slot night",{ratownik:t.nightShift1Ratownik===!0,pielegniarka:t.nightShift1Ratownik===!1,userChanged:t.nightShift1UserChanged===!0,clickable:a.isEditingMode}]),onDragover:e[2]||(e[2]=c(()=>{},["prevent"])),onDrop:d=>n.handleDrop(t.date,"nightShift1"),onClick:d=>a.isEditingMode&&n.handleClickResetShift(t,"nightShift1"),"aria-label":n.getShiftAriaLabel(t,"nightShift1"),title:n.getShiftTooltip(t,"nightShift1"),role:"button",tabindex:"0"},[t.nightShift1?(l(),h("div",B,S(t.nightShift1Name),1)):t.nightShift1UserChanged?(l(),h("div",Z," Usunięto ")):(l(),h("div",K,"N"))],42,H),r("div",{class:f(["shift-slot night",{ratownik:t.nightShift2Ratownik===!0,pielegniarka:t.nightShift2Ratownik===!1,userChanged:t.nightShift2UserChanged===!0,clickable:a.isEditingMode}]),clickable:a.isEditingMode,onDragover:e[3]||(e[3]=c(()=>{},["prevent"])),onDrop:d=>n.handleDrop(t.date,"nightShift2"),onClick:d=>a.isEditingMode&&n.handleClickResetShift(t,"nightShift2"),"aria-label":n.getShiftAriaLabel(t,"nightShift2"),title:n.getShiftTooltip(t,"nightShift2"),role:"button",tabindex:"0"},[t.nightShift2?(l(),h("div",G,S(t.nightShift2Name),1)):t.nightShift2UserChanged?(l(),h("div",Q," Usunięto ")):(l(),h("div",X,"N"))],42,V)],40,O)],10,W)])],42,P))),128))])],544)])],64)}const nt=w(_,[["render",$],["__scopeId","data-v-71577c29"]]);export{nt as default};
